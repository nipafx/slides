<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui"><title>Java 21 Deep&#160;Dive</title><link rel="stylesheet" href="../_reveal.js/head/css/reset.css"><link rel="stylesheet" href="../_reveal.js/head/css/reveal.css"><link rel="stylesheet" href="../_reveal.js/head/css/theme/nipa-night.css" id="theme"><!--This CSS is generated by the Asciidoctor reveal.js converter to further integrate AsciiDoc's existing semantic with reveal.js--><style type="text/css">.reveal div.right {
  float: right
}

/* listing block */
.reveal .listingblock.stretch > .content {
  height: 100%
}

.reveal .listingblock.stretch > .content > pre {
  height: 100%
}

.reveal .listingblock.stretch > .content > pre > code {
  height: 100%;
  max-height: 100%
}

/* tables */
table {
  border-collapse: collapse;
  border-spacing: 0
}

table {
  margin-bottom: 1.25em;
  border: solid 1px #dedede
}

table thead tr th, table thead tr td, table tfoot tr th, table tfoot tr td {
  padding: .5em .625em .625em;
  font-size: inherit;
  text-align: left
}

table tr th, table tr td {
  padding: .5625em .625em;
  font-size: inherit
}

table thead tr th, table tfoot tr th, table tbody tr td, table tr td, table tfoot tr td {
  display: table-cell;
  line-height: 1.6
}

td.tableblock > .content {
  margin-bottom: 1.25em
}

td.tableblock > .content > :last-child {
  margin-bottom: -1.25em
}

table.tableblock, th.tableblock, td.tableblock {
  border: 0 solid #dedede
}

table.grid-all > thead > tr > .tableblock, table.grid-all > tbody > tr > .tableblock {
  border-width: 0 1px 1px 0
}

table.grid-all > tfoot > tr > .tableblock {
  border-width: 1px 1px 0 0
}

table.grid-cols > * > tr > .tableblock {
  border-width: 0 1px 0 0
}

table.grid-rows > thead > tr > .tableblock, table.grid-rows > tbody > tr > .tableblock {
  border-width: 0 0 1px
}

table.grid-rows > tfoot > tr > .tableblock {
  border-width: 1px 0 0
}

table.grid-all > * > tr > .tableblock:last-child, table.grid-cols > * > tr > .tableblock:last-child {
  border-right-width: 0
}

table.grid-all > tbody > tr:last-child > .tableblock, table.grid-all > thead:last-child > tr > .tableblock, table.grid-rows > tbody > tr:last-child > .tableblock, table.grid-rows > thead:last-child > tr > .tableblock {
  border-bottom-width: 0
}

table.frame-all {
  border-width: 1px
}

table.frame-sides {
  border-width: 0 1px
}

table.frame-topbot, table.frame-ends {
  border-width: 1px 0
}

.reveal table th.halign-left, .reveal table td.halign-left {
  text-align: left
}

.reveal table th.halign-right, .reveal table td.halign-right {
  text-align: right
}

.reveal table th.halign-center, .reveal table td.halign-center {
  text-align: center
}

.reveal table th.valign-top, .reveal table td.valign-top {
  vertical-align: top
}

.reveal table th.valign-bottom, .reveal table td.valign-bottom {
  vertical-align: bottom
}

.reveal table th.valign-middle, .reveal table td.valign-middle {
  vertical-align: middle
}

table thead th, table tfoot th {
  font-weight: bold
}

tbody tr th {
  display: table-cell;
  line-height: 1.6
}

tbody tr th, tbody tr th p, tfoot tr th, tfoot tr th p {
  font-weight: bold
}

thead {
  display: table-header-group
}

.reveal table.grid-none th, .reveal table.grid-none td {
  border-bottom: 0 !important
}

/* kbd macro */
kbd {
  font-family: "Droid Sans Mono", "DejaVu Sans Mono", monospace;
  display: inline-block;
  color: rgba(0, 0, 0, .8);
  font-size: .65em;
  line-height: 1.45;
  background: #f7f7f7;
  border: 1px solid #ccc;
  -webkit-border-radius: 3px;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 0 rgba(0, 0, 0, .2), 0 0 0 .1em white inset;
  box-shadow: 0 1px 0 rgba(0, 0, 0, .2), 0 0 0 .1em #fff inset;
  margin: 0 .15em;
  padding: .2em .5em;
  vertical-align: middle;
  position: relative;
  top: -.1em;
  white-space: nowrap
}

.keyseq kbd:first-child {
  margin-left: 0
}

.keyseq kbd:last-child {
  margin-right: 0
}

/* callouts */
.conum[data-value] {
  display: inline-block;
  color: #fff !important;
  background: rgba(0, 0, 0, .8);
  -webkit-border-radius: 50%;
  border-radius: 50%;
  text-align: center;
  font-size: .75em;
  width: 1.67em;
  height: 1.67em;
  line-height: 1.67em;
  font-family: "Open Sans", "DejaVu Sans", sans-serif;
  font-style: normal;
  font-weight: bold
}

.conum[data-value] * {
  color: #fff !important
}

.conum[data-value] + b {
  display: none
}

.conum[data-value]:after {
  content: attr(data-value)
}

pre .conum[data-value] {
  position: relative;
  top: -.125em
}

b.conum * {
  color: inherit !important
}

.conum:not([data-value]):empty {
  display: none
}

/* Callout list */
.hdlist > table, .colist > table {
  border: 0;
  background: none
}

.hdlist > table > tbody > tr, .colist > table > tbody > tr {
  background: none
}

td.hdlist1, td.hdlist2 {
  vertical-align: top;
  padding: 0 .625em
}

td.hdlist1 {
  font-weight: bold;
  padding-bottom: 1.25em
}

/* Disabled from Asciidoctor CSS because it caused callout list to go under the
 * source listing when .stretch is applied (see #335)
 * .literalblock+.colist,.listingblock+.colist{margin-top:-.5em} */
.colist td:not([class]):first-child {
  padding: .4em .75em 0;
  line-height: 1;
  vertical-align: top
}

.colist td:not([class]):first-child img {
  max-width: none
}

.colist td:not([class]):last-child {
  padding: .25em 0
}

/* Override Asciidoctor CSS that causes issues with reveal.js features */
.reveal .hljs table {
  border: 0
}

/* Callout list rows would have a bottom border with some reveal.js themes (see #335) */
.reveal .colist > table th, .reveal .colist > table td {
  border-bottom: 0
}

/* Fixes line height with Highlight.js source listing when linenums enabled (see #331) */
.reveal .hljs table thead tr th, .reveal .hljs table tfoot tr th, .reveal .hljs table tbody tr td, .reveal .hljs table tr td, .reveal .hljs table tfoot tr td {
  line-height: inherit
}

/* Columns layout */
.columns .slide-content {
  display: flex;
}

.columns.wrap .slide-content {
  flex-wrap: wrap;
}

.columns.is-vcentered .slide-content {
  align-items: center;
}

.columns .slide-content > .column {
  display: block;
  flex-basis: 0;
  flex-grow: 1;
  flex-shrink: 1;
}

.columns .slide-content > .column > * {
  padding: .75rem;
}

/* See #353 */
.columns.wrap .slide-content > .column {
  flex-basis: auto;
}

.columns .slide-content > .column.is-full {
  flex: none;
  width: 100%;
}

.columns .slide-content > .column.is-four-fifths {
  flex: none;
  width: 80%;
}

.columns .slide-content > .column.is-three-quarters {
  flex: none;
  width: 75%;
}

.columns .slide-content > .column.is-two-thirds {
  flex: none;
  width: 66.6666%;
}

.columns .slide-content > .column.is-three-fifths {
  flex: none;
  width: 60%;
}

.columns .slide-content > .column.is-half {
  flex: none;
  width: 50%;
}

.columns .slide-content > .column.is-two-fifths {
  flex: none;
  width: 40%;
}

.columns .slide-content > .column.is-one-third {
  flex: none;
  width: 33.3333%;
}

.columns .slide-content > .column.is-one-quarter {
  flex: none;
  width: 25%;
}

.columns .slide-content > .column.is-one-fifth {
  flex: none;
  width: 20%;
}

.columns .slide-content > .column.has-text-left {
  text-align: left;
}

.columns .slide-content > .column.has-text-justified {
  text-align: justify;
}

.columns .slide-content > .column.has-text-right {
  text-align: right;
}

.columns .slide-content > .column.has-text-left {
  text-align: left;
}

.columns .slide-content > .column.has-text-justified {
  text-align: justify;
}

.columns .slide-content > .column.has-text-right {
  text-align: right;
}

.text-left {
  text-align: left !important
}

.text-right {
  text-align: right !important
}

.text-center {
  text-align: center !important
}

.text-justify {
  text-align: justify !important
}

.footnotes {
  border-top: 1px solid rgba(0, 0, 0, 0.2);
  padding: 0.5em 0 0 0;
  font-size: 0.65em;
  margin-top: 4em;
}
</style><!--Printing and PDF exports--><script>var link = document.createElement( 'link' );
link.rel = 'stylesheet';
link.type = 'text/css';
link.href = window.location.search.match( /print-pdf/gi ) ? "../_reveal.js/head/css/print/pdf.css" : "../_reveal.js/head/css/print/paper.css";
document.getElementsByTagName( 'head' )[0].appendChild( link );</script><link href="../_reveal.js/head/lib/font/awesome/all.min.css" rel="stylesheet"></head><body><div class="reveal"><div class="slides"><section class="title" data-state="title"><h1>Java 21 Deep&#160;Dive</h1><div class="preamble"><link rel="stylesheet" href="../_highlight.js/head/styles/monokai-sublime.css">
<script src="../_highlight.js/head/highlight.pack.js"></script>
<script>
	window.onload = function() {
		hljs.configure({
			tabReplace: '    ',
			languages: [ 'java' ]
		})
		var codes = document.getElementsByTagName('code');
		for(var i = 0; i < codes.length; i++) {
			hljs.highlightBlock(codes.item(i));
		}
		hljs.initHighlightingOnLoad();
	}
</script>
<style>
.reveal .title h1 {
	font-size: 3em;
}
.reveal .title h2 {
	font-size: 1.75em;
}
</style>
<h2>Better Language, Better Scalability, Better APIs, Better Tools</h2>
<div class="event">
	<div class="participant">
		<a href="https://nipafx.dev/nicolai-parlog" title="Nicolai"><img src="../_images/nipa-face-c9e3bd71.jpg" alt="Photo of Nicolai" class="logo"></a>
		<div class="name">
			<p><a href="https://nipafx.dev/nicolai-parlog" title="About Nicolai">Nicolai Parlog</a></p>
			<p><a href="https://nipafx.dev" title="Nicolai's website">nipafx.dev</a>
				/ <a href="https://twitter.com/nipafx" title="Nicolai on Twitter">@nipafx</a></p>
		</div>
	</div>
	<div class="participant">
		<a href="https://www.jfokus.se/jfokus/" title="Jfokus"><img src="../_images/logo-jfokus-2024-c87ed751.png" alt="Logo of Jfokus" class="logo" style="{host-logo-style}"></a>
		<div class="name">
			<p><a href="https://www.jfokus.se/jfokus/" title="Jfokus website">Jfokus</a></p>
			<p><a href="https://twitter.com/Jfokus" title="Jfokus on Twitter">@Jfokus</a></p>
		</div>
	</div>
	<div class="participant">
		<a href="{guest-url}" title="Ana-Maria Mihalceanu"><img src="../_images/ana-maria-503f03fa.jpg"  alt="Photo of Ana-Maria Mihalceanu" class="logo"></a>
		<div class="name">
			<p><a href="{guest-url}" title="Ana-Maria Mihalceanu online">Ana-Maria Mihalceanu</a></p>
			<p><a href="https://twitter.com/ammbra1508" title="Ana-Maria Mihalceanu on Twitter">@ammbra1508</a></p>
		</div>
	</div>
</div>
<footer>
	<div class="participant">
		<a href="https://nipafx.dev/nicolai-parlog" title="Nicolai"><img src="../_images/nipa-face-c9e3bd71.jpg" alt="Photo of Nicolai" class="logo"></a>
		<div class="name"><p>
			<a href="https://nipafx.dev/nicolai-parlog" title="About Nicolai">Nicolai Parlog</a>
			/ <a href="https://nipafx.dev" title="Nicolai's website">nipafx.dev</a>
			/ <a href="https://twitter.com/nipafx" title="Nicolai on Twitter">@nipafx</a>
		</p></div>
	</div>
	<div class="participant">
		<a href="{guest-url}" title="Ana-Maria Mihalceanu"><img src="../_images/ana-maria-503f03fa.jpg"  alt="Photo of Ana-Maria Mihalceanu" class="logo"></a>
		<div class="name"><p>
			<a href="{guest-url}" title="Ana-Maria Mihalceanu online">Ana-Maria Mihalceanu</a>
			/ <a href="https://twitter.com/ammbra1508" title="Ana-Maria Mihalceanu on Twitter">@ammbra1508</a>
		</p></div>
	</div>
	<div class="participant">
		<a href="https://www.jfokus.se/jfokus/" title="Jfokus"><img src="../_images/logo-jfokus-2024-c87ed751.png" alt="Logo of Jfokus" class="logo" style="{host-logo-style}"></a>
		<div class="name"><p>
			<a href="https://www.jfokus.se/jfokus/" title="Jfokus website">Jfokus</a>
			/ <a href="https://twitter.com/Jfokus" title="Jfokus on Twitter">@Jfokus</a>
		</p></div>
	</div>
</footer>
<!-- Just adding a footer does not work because reveal.js puts it into the slides and we couldn't get it out via CSS. So we move it via JavaScript. -->
<script>
	document.addEventListener('DOMContentLoaded', function () {
		document.body.appendChild(document.querySelector('footer'));
	})
</script></div></section>
<section><section id="_lets_get_started"><h2>Let&#8217;s get started!</h2><div class="slide-content"><div class="ulist"><ul><li><p>this session goes over Java 18-21</p></li><li><p>we can&#8217;t cover all details<br>
‚áù go to <a href="https://youtube.com/@java">youtube.com/@java</a> for more</p></li><li><p>slides at <a href="https://slides.nipafx.dev/java-x">slides.nipafx.dev/java-x</a><br>
(hit "?" to get navigation help)</p></li><li><p>ask questions any time</p></li></ul></div></div></section><section id="_lots_to_talk_about"><h2>Lots to talk about!</h2><div class="slide-content"><div class="paragraph"><p><strong>Part I</strong>:</p></div>
<div class="ulist"><ul><li><p>pattern matching</p></li><li><p>virtual threads</p></li><li><p>string templates</p></li></ul></div></div></section><section id="_lots_to_talk_about_2"><h2>Lots to talk about!</h2><div class="slide-content"><div class="paragraph"><p><strong>Part II</strong>:</p></div>
<div class="ulist"><ul><li><p>on-ramping to Java</p></li><li><p>sequenced collections</p></li><li><p>misc API improvements</p></li><li><p>GC, CDS, UTF-8</p></li></ul></div></div></section><section id="_lots_to_talk_about_3"><h2>Lots to talk about!</h2><div class="slide-content"><div class="paragraph"><p><strong>Part III</strong>:</p></div>
<div class="ulist"><ul><li><p>Source and Classfile Tools</p></li><li><p>Development and Deployment Tools</p></li><li><p>Security Tools</p></li><li><p>Monitoring Tools</p></li></ul></div></div></section><section id="_why_upgrade"><h2>Why upgrade?</h2><div class="slide-content"><div class="paragraph"><p>Costs of running on old versions:</p></div>
<div class="ulist"><ul><li><p>support contract for Java</p></li><li><p>waning support in libraries / frameworks</p></li></ul></div></div></section><section id="_why_upgrade_2"><h2>Why upgrade?</h2><div class="slide-content"><div class="paragraph"><p>Costs of not running on new versions:</p></div>
<div class="ulist"><ul><li><p>lower productivity</p></li><li><p>less observability and performance<br>
(more on that later)</p></li><li><p>less access to talent</p></li><li><p>bigger upgrade costs</p></li></ul></div></div></section><section id="_why_upgrade_3"><h2>Why upgrade?</h2><div class="slide-content"><div class="quoteblock"><blockquote><div class="paragraph"><p>Resistence is futile.</p></div></blockquote></div></div></section><section id="_how_to_upgrade"><h2>How to upgrade?</h2><div class="slide-content"><div class="paragraph"><p>Preparations:</p></div>
<div class="ulist"><ul><li><p>stick to supported APIs</p></li><li><p>stick to standardized behavior</p></li><li><p>stick to well-maintained projects</p></li><li><p>keep dependencies and tools up to date</p></li><li><p>stay ahead of removals (<code>jdeprscan</code>)</p></li><li><p>build on many JDK versions</p></li></ul></div></div></section><section id="_how_to_upgrade_2"><h2>How to upgrade?</h2><div class="slide-content"><div class="paragraph"><p>Prepare by building on multiple JDK versions:</p></div>
<div class="ulist"><ul><li><p>your baseline version</p></li><li><p>every supported version since then</p></li><li><p>latest version</p></li><li><p>EA build of next version</p></li></ul></div></div></section><section id="_how_to_upgrade_3"><h2>How to upgrade?</h2><div class="slide-content"><div class="paragraph"><p>It&#8217;s not necessary to build ‚Ä¶</p></div>
<div class="ulist"><ul><li><p>‚Ä¶ each commit on all versions</p></li><li><p>‚Ä¶ the whole project on all versions</p></li></ul></div>
<div class="paragraph"><p>Build as much as feasible.</p></div></div></section><section id="_what_about_lts"><h2>What about LTS?</h2><div class="slide-content"><div class="paragraph"><p>Within OpenJDK, there is no LTS.</p></div>
<div class="paragraph"><p>‚áù has no impact on features, reliability, etc.</p></div>
<div class="paragraph"><p>It&#8217;s a vendor-centric concept<br>
to offer continuous fixes<br>
(usually for money).</p></div>
<div class="quoteblock"><blockquote><div class="paragraph"><p>You&#8217;re paying not to get new features.</p></div></blockquote></div></div></section><section data-background-color="white" data-background-image="../_images/no-lts-version-a62e3435.png" data-background-size="contain" data-state="empty"></section><section id="_what_about_lts_2"><h2>What about LTS?</h2><div class="slide-content"><div class="imageblock"><a class="image" href="https://www.youtube.com/watch?v=3bfR22iv8Pc"><img src="../_images/inside-java-newscast-52-ad521bae.png" alt="inside java newscast 52"></a></div></div></section></section>
<section><section id="_java_21"><h2>Java 21 üí£üí•</h2><div class="slide-content"><div class="paragraph"><p> <h3>Part I</h3> <table class="toc"> <tr class="toc-current"><td>Pattern Matching</td></tr> <tr class="toc-current"><td style="padding-left: 2em;">A New Dynamic Dispatch</td></tr> <tr><td style="padding-left: 2em;">Data-Oriented Programming</td></tr> <tr><td>Virtual Threads</td></tr> <tr><td>String Templates</td></tr> </table> </p></div></div></section><section id="_a_simple_app"><h2>A simple app</h2><div class="slide-content"><div class="paragraph"><p>Features:</p></div>
<div class="ulist"><ul><li><p>scrapes GitHub projects</p></li><li><p>creates <code>Page</code> instances:</p><div class="ulist"><ul><li><p><code>GitHubIssuePage</code></p></li><li><p><code>GitHubPrPage</code></p></li><li><p><code>ExternalPage</code></p></li><li><p><code>ErrorPage</code></p></li></ul></div></li><li><p>further processes pages</p></li></ul></div></div></section><section id="_a_simple_app_2"><h2>A simple app</h2><div class="slide-content"><div class="paragraph"><p>Features:</p></div>
<div class="ulist"><ul><li><p>display as interactive graph</p></li><li><p>compute graph properties</p></li><li><p>categorize pages by topic</p></li><li><p>analyze mood of interactions</p></li><li><p>process payment for analyses</p></li><li><p>etc.</p></li></ul></div></div></section><section id="_a_simple_architecture"><h2>A simple architecture?</h2><div class="slide-content"><div class="paragraph"><p>How to implement features?</p></div>
<div class="ulist"><ul><li class="fragment"><p>methods on <code>Page</code> üòß</p></li><li class="fragment"><p>visitor pattern üò´</p></li><li class="fragment"><p>pattern matching ü•≥</p></li></ul></div></div></section><section id="_pattern_matching"><h2>Pattern Matching</h2><div class="slide-content"><div class="paragraph"><p>Ingredients:</p></div>
<div class="ulist"><ul><li><p>switch expressions ‚ë≠ (<a href="https://openjdk.org/jeps/361">JEP 361</a>)</p></li><li><p>type pattern matching ‚ëØ (<a href="https://openjdk.org/jeps/394">JEP 394</a>)</p></li><li><p>sealed types ‚ë∞ (<a href="https://openjdk.org/jeps/409">JEP 409</a>)</p></li><li><p>patterns in switch „âë (<a href="https://openjdk.org/jeps/441">JEP 441</a>)</p></li><li><p>unnamed patterns „âí (<a href="https://openjdk.org/jeps/443">JEP 443</a> / <a href="https://openjdk.org/jeps/456">JEP 456</a>)</p></li></ul></div></div></section><section id="_pattern_matching_2"><h2>Pattern Matching</h2><div class="slide-content"><div class="paragraph"><p>Approach:</p></div>
<div class="ulist"><ul><li><p>make <code>Page</code> sealed</p></li><li><p>implement features as methods outside of <code>Page</code></p></li><li><p>accept <code>Page</code> parameters and <code>switch</code> over it</p></li><li><p>avoid <code>default</code> branch for maintainability</p></li></ul></div></div></section><section id="_sealed_page"><h2>Sealed Page</h2><div class="slide-content"><div class="paragraph"><p>Sealed types limit inheritance,<br>
by only allowing specific subtypes.</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">public sealed interface Page
	permits GitHubIssuePage, GitHubPrPage,
			ExternalPage, ErrorPage {
	// ...
}</code></pre></div></div></div></section><section id="_switch_over_page"><h2>Switch over Page</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">public void categorize(Page page) {
	switch (page) {
		case GitHubIssuePage is -&gt; categorizeIssue(is);
		case GitHubPrPage pr -&gt; categorizePr(pr);
		case ExternalPage ext -&gt; categorizeExternal(ext);
		case ErrorPage err -&gt; categorizeError(err);
	}
}</code></pre></div></div></div></section><section id="_maintainability"><h2>Maintainability</h2><div class="slide-content"><div class="paragraph"><p>Unlike an <code>if</code>-<code>else</code>-<code>if</code>-chain,<br>
a pattern <code>switch</code> needs to be exhaustive.</p></div>
<div class="paragraph"><p>Fulfilled by:</p></div>
<div class="ulist"><ul><li><p>switching over a sealed types</p></li><li><p>a <code>case</code> per subtype</p></li><li><p>avoiding the <code>default</code> branch</p></li></ul></div>
<div class="paragraph"><p>‚áù Adding a new subtype causes compile error!</p></div></div></section><section id="_avoiding_default"><h2>Avoiding Default</h2><div class="slide-content"><div class="paragraph"><p>Sometimes you have "defaulty" behavior:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">public void categorize(Page page) {
	switch (page) {
		case GitHubIssuePage is -&gt; categorizeIssue(is);
		case GitHubPrPage pr -&gt; categorizePr(pr);
		default -&gt; { }
	}
}</code></pre></div></div>
<div class="paragraph"><p>But we need to avoid <code>default</code>!</p></div></div></section><section id="_avoiding_default_2"><h2>Avoiding Default</h2><div class="slide-content"><div class="paragraph"><p>Write explicit branches:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">public void categorize(Page page) {
	switch (page) {
		case GitHubIssuePage is -&gt; categorizeIssue(is);
		case GitHubPrPage pr -&gt; categorizePr(pr);
		// duplication üò¢
		case ErrorPage err -&gt; { };
		case ExternalPage ext -&gt; { };
	};
}</code></pre></div></div></div></section><section id="_avoiding_default_3"><h2>Avoiding Default</h2><div class="slide-content"><div class="paragraph"><p>Use <code>_</code> to combine "default branches":</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">public void categorize(Page page) {
	switch (page) {
		case GitHubIssuePage is -&gt; categorizeIssue(is);
		case GitHubPrPage pr -&gt; categorizePr(pr);
		case ErrorPage _, ExternalPage _ -&gt; { };
	};
}</code></pre></div></div>
<div class="paragraph"><p>‚áù Default behavior without <code>default</code> branch.</p></div></div></section><section id="_dynamic_dispatch"><h2>Dynamic dispatch</h2><div class="slide-content"><div class="paragraph"><p>Dynamic dispatch selects the invoked method by type.</p></div>
<div class="paragraph"><p>As language feature:</p></div>
<div class="ulist"><ul><li><p>via inheritance</p></li><li><p>makes method part of API</p></li></ul></div>
<div class="paragraph"><p>What if methods shouldn&#8217;t be part of the API?</p></div></div></section><section id="_dynamic_dispatch_2"><h2>Dynamic dispatch</h2><div class="slide-content"><div class="paragraph"><p>Without methods becoming part of the API.</p></div>
<div class="paragraph"><p>Via visitor pattern:</p></div>
<div class="ulist"><ul><li><p>makes "visitation" part of API</p></li><li><p>cumbersome and indirect</p></li></ul></div>
<div class="paragraph"><p>Via pattern matching (new):</p></div>
<div class="ulist"><ul><li><p>makes "sealed" part of type</p></li><li><p>straight-forward</p></li></ul></div></div></section><section id="_more"><h2>More</h2><div class="slide-content"><div class="paragraph"><p>More on pattern matching:</p></div>
<div class="ulist"><ul><li><p>üìù <a href="https://openjdk.org/projects/amber/design-notes/patterns/pattern-match-object-model">Pattern Matching in the Java Object Model</a></p></li><li><p>üé• <a href="https://www.youtube.com/watch?v=QrwFrm1R8OY">Java 21 Brings Full Pattern Matching</a> (Sep 2023)</p></li><li><p>üßë‚Äçüíª <a href="https://github.com/nipafx/loom-lab">GitHub crawler</a></p></li></ul></div></div></section></section>
<section><section id="_java_21_2"><h2>Java 21 üí£üí•</h2><div class="slide-content"><div class="paragraph"><p> <h3>Part I</h3> <table class="toc"> <tr class="toc-current"><td>Pattern Matching</td></tr> <tr><td style="padding-left: 2em;">A New Dynamic Dispatch</td></tr> <tr class="toc-current"><td style="padding-left: 2em;">Data-Oriented Programming</td></tr> <tr><td>Virtual Threads</td></tr> <tr><td>String Templates</td></tr> </table> </p></div></div></section><section id="_programming_paradigms"><h2>Programming paradigms</h2><div class="slide-content"><div class="paragraph"><p>Paradigms often come with an<br>
"Everything is a &#8230;&#8203;" sentence.</p></div>
<div class="quoteblock"><blockquote><div class="paragraph"><p>The goal of any programming paradigm is to manage complexity.</p></div></blockquote></div>
<div class="ulist"><ul><li><p>complexity comes in many forms</p></li><li><p>not all paradigms handle all forms equally well</p></li></ul></div>
<div class="paragraph"><p>‚áù "It depends"</p></div></div></section><section id="_object_oriented_programming"><h2>Object-oriented programming</h2><div class="slide-content"><div class="quoteblock"><blockquote><div class="paragraph"><p>Everything is an object</p></div></blockquote></div>
<div class="ulist"><ul><li><p>combines state and behavior</p></li><li><p>hinges on encapsulation</p></li><li><p>polymorphism through inheritance</p></li></ul></div>
<div class="paragraph"><p>Works best when defining/upholding boundaries.</p></div>
<aside class="notes"><div class="ulist"><ul><li><p>maintenance boundaries</p></li><li><p>versioning boundaries</p></li><li><p>encapsulation boundaries</p></li><li><p>compilation boundaries</p></li><li><p>compatibility boundaries</p></li><li><p>security boundaries</p></li></ul></div></aside></div></section><section id="_mixed_programming"><h2>Mixed programming</h2><div class="slide-content"><div class="paragraph"><p>Great use cases for OOP:</p></div>
<div class="ulist"><ul><li><p>boundaries between libraries and clients</p></li><li><p>in large programs to enable modular reasoning</p></li></ul></div>
<div class="paragraph"><p>Consider a data-oriented approach for:</p></div>
<div class="ulist"><ul><li><p>smaller (sub)systems</p></li><li><p>focused on data</p></li></ul></div></div></section><section id="_data_oriented_programming"><h2>Data-oriented programming</h2><div class="slide-content"><div class="paragraph"><p>Guiding principles:</p></div>
<div class="ulist"><ul><li><p>model the data, the whole data,<br>
and nothing but the data</p></li><li><p>data is immutable</p></li><li><p>validate at the boundary</p></li><li><p>make illegal states unrepresentable</p></li></ul></div>
<div class="paragraph"><p>From Brian Goetz' seminal article:<br>
<a href="https://www.infoq.com/articles/data-oriented-programming-java/">Data Oriented Programming in Java</a></p></div></div></section><section id="_crawling_github"><h2>Crawling GitHub</h2><div class="slide-content"><div class="paragraph"><p>The app we just looked at:</p></div>
<div class="ulist"><ul><li><p>is small</p></li><li><p>focusses on data (<code>Page</code>)</p></li><li><p>separates operations from types</p></li></ul></div>
<div class="paragraph"><p>‚áù Perfect for data-oriented programming!</p></div></div></section><section id="_applying_dop"><h2>Applying DOP</h2><div class="slide-content"><div class="quoteblock"><blockquote><div class="paragraph"><p>Model the data, the whole data,<br>
and nothing but the data.</p></div></blockquote></div>
<div class="paragraph"><p>There are four kinds of pages:</p></div>
<div class="ulist"><ul><li><p>error page</p></li><li><p>external page</p></li><li><p>GitHub issue page</p></li><li><p>GitHub PR page</p></li></ul></div>
<div class="paragraph"><p>‚áù Use four records to model them!</p></div></div></section><section id="_modeling_the_data"><h2>Modeling the data</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">public record ErrorPage(
	URI url, Exception ex) { }

public record ExternalPage(
	URI url, String content) { }

public record GitHubIssuePage(
	URI url, String content,
	int issueNumber, Set&lt;Page&gt; links) { }

public record GitHubPrPage(
	URI url, String content,
	int prNumber, Set&lt;Page&gt; links) { }</code></pre></div></div></div></section><section id="_applying_dop_2"><h2>Applying DOP</h2><div class="slide-content"><div class="quoteblock"><blockquote><div class="paragraph"><p>Model the data, the whole data,<br>
and nothing but the data.</p></div></blockquote></div>
<div class="paragraph"><p>There are additional relations between them:</p></div>
<div class="ulist"><ul><li><p>a page (load) is either successful or not</p></li><li><p>a successful page is either external or GitHub</p></li><li><p>a GitHub page is either for a PR or an issue</p></li></ul></div>
<div class="paragraph"><p>‚áù Use sealed types to model the alternatives!</p></div></div></section><section id="_modeling_alternatives"><h2>Modeling alternatives</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">public sealed interface Page
		permits ErrorPage, SuccessfulPage {
	URI url();
}

public sealed interface SuccessfulPage
		extends Page permits ExternalPage, GitHubPage {
	String content();
}

public sealed interface GitHubPage
		extends SuccessfulPage
		permits GitHubIssuePage, GitHubPrPage {
	Set&lt;Page&gt; links();
	default Stream&lt;Page&gt; subtree() { ... }
}</code></pre></div></div></div></section><section data-background-color="white" data-background-image="../_images/github-crawler-types-3c131fff.png" data-background-size="contain" data-state="empty"></section><section id="_algebraic_data_types"><h2>Algebraic data types</h2><div class="slide-content"><div class="ulist"><ul><li><p>records are <em>product types</em></p></li><li><p>sealed types are <em>sum types</em></p></li></ul></div>
<div class="quoteblock"><blockquote><div class="paragraph"><p>This simple combination of mechanisms&#8201;&#8212;&#8201;aggregation and choice&#8201;&#8212;&#8201;is deceptively powerful</p></div></blockquote></div></div></section><section id="_applying_dop_3"><h2>Applying DOP</h2><div class="slide-content"><div class="quoteblock"><blockquote><div class="paragraph"><p>Make illegal states unrepresentable.</p></div></blockquote></div>
<div class="paragraph"><p>Many are already, e.g.:</p></div>
<div class="ulist"><ul><li><p>with <code>error</code> and with <code>content</code></p></li><li><p>with <code>issueNumber</code> and <code>prNumber</code></p></li><li><p>with <code>isseNumber</code> or <code>prNumber</code> but no <code>links</code></p></li></ul></div></div></section><section id="_validation"><h2>Validation</h2><div class="slide-content"><div class="quoteblock"><blockquote><div class="paragraph"><p>Validate at the boundary.</p></div></blockquote></div>
<div class="paragraph"><p>‚áù Reject other illegal states in constructors.</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">record ExternalPage(URI url, String content) {
	// compact constructor
	ExternalPage {
		Objects.requireNonNull(url);
		Objects.requireNonNull(content);
		if (content.isBlank())
			throw new IllegalArgumentException();
	}
}</code></pre></div></div></div></section><section id="_applying_dop_4"><h2>Applying DOP</h2><div class="slide-content"><div class="quoteblock"><blockquote><div class="paragraph"><p>Data is immutable.</p></div></blockquote></div>
<div class="paragraph"><p>Records are shallowly immutable,<br>
but field types may not be.</p></div>
<div class="paragraph"><p>‚áù Fix that during construction.</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">// compact constructor
GitHubPrPage {
	// [...]
	links = Set.copyOf(links);
}</code></pre></div></div></div></section><section id="_where_are_we"><h2>Where are we?</h2><div class="slide-content"><div class="ulist"><ul><li><p>page "type" is explicit in Java&#8217;s type</p></li><li><p>only legal combination of data are possible</p></li><li><p>API is self-documenting</p></li><li><p>code is trivial to test</p></li></ul></div>
<div class="paragraph"><p>But where did the operations go?</p></div></div></section><section id="_operations_on_data"><h2>Operations on data</h2><div class="slide-content"><div class="quoteblock"><blockquote><div class="paragraph"><p>Model the data, the whole data,<br>
and nothing but the data.</p></div></blockquote></div>
<div class="paragraph"><p>‚áù Methods should be limited to derived quantities.</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">public record GitHubIssuePage(
		URI url, String content,
		int issueNumber, Set&lt;Page&gt; links) {

	public String toPrettyString() {
		return "üêà ISSUE #" + issueNumber;
	}

}</code></pre></div></div></div></section><section id="_operations_on_data_2"><h2>Operations on data</h2><div class="slide-content"><div class="paragraph"><p>Other operations must be defined elsewhere:</p></div>
<div class="ulist"><ul><li><p>methods in other subsystems</p></li><li><p>use pattern matching over sealed types<br>
for polymorphic operations</p></li><li><p>avoid default branch</p></li><li><p>use record patterns to access data</p></li></ul></div>
<div class="paragraph"><p>‚áù This is just pattern matching.</p></div></div></section><section id="_operations_on_data_3"><h2>Operations on data</h2><div class="slide-content"><div class="paragraph"><p>If <code>toPrettyString</code> is defined outside of <code>Page</code>:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">private static String toPrettyString(Page page) {
	return switch (page) {
		case ErrorPage(var url, _)
			-&gt; "üí• ERROR: " + url.getHost();
		case ExternalPage(var url, _)
			-&gt; "üí§ EXTERNAL: " + url.getHost();
		case GitHubIssuePage(_, _, int issueNumber, _)
			-&gt; "üêà ISSUE #" + issueNumber;
		case GitHubPrPage(_, _, int prNumber, _)
			-&gt; "üêô PR #" + prNumber;
	};
}</code></pre></div></div></div></section><section id="_functional_programming"><h2>Functional programming?!</h2><div class="slide-content"><div class="ulist"><ul><li><p>immutable data structures</p></li><li><p>methods (functions?) that operate on them</p></li></ul></div>
<div class="paragraph"><p>Isn&#8217;t this just functional programming?!</p></div>
<div class="paragraph fragment"><p>Kind of.</p></div></div></section><section id="_dop_vs_fp"><h2>DOP vs FP</h2><div class="slide-content"><div class="paragraph"><p><strong>Functional programming:</strong></p></div>
<div class="quoteblock"><blockquote><div class="paragraph"><p>Everything is a function</p></div></blockquote></div>
<div class="paragraph"><p>‚áù Focus on creating and composing functions.</p></div>
<hr>
<div class="paragraph"><p><strong>Data-oriented programming:</strong></p></div>
<div class="quoteblock"><blockquote><div class="paragraph"><p>Model data as data.</p></div></blockquote></div>
<div class="paragraph"><p>‚áù Focus on correctly modeling the data.</p></div></div></section><section id="_dop_vs_oop"><h2>DOP vs OOP</h2><div class="slide-content"><div class="paragraph"><p><strong>OOP is not dead (again):</strong></p></div>
<div class="ulist"><ul><li><p>valuable for complex entities or rich libraries</p></li><li><p>use whenever encapsulation is needed</p></li><li><p>still a good default on high level</p></li></ul></div>
<div class="paragraph"><p><strong>DOP&#8201;&#8212;&#8201; consider when:</strong></p></div>
<div class="ulist"><ul><li><p>mainly handling outside data</p></li><li><p>working with simple or ad-hoc data</p></li><li><p>data and behavior should be separated</p></li></ul></div></div></section><section id="_data_oriented_programming_2"><h2>Data-oriented programming</h2><div class="slide-content"><div class="paragraph"><p>Use Java&#8217;s strong typing to model data as data:</p></div>
<div class="ulist"><ul><li><p>use classes to represent data, particularly:</p><div class="ulist"><ul><li><p>data as data with records</p></li><li><p>alternatives with sealed classes</p></li></ul></div></li><li><p>use methods (separately) to model behavior, particularly:</p><div class="ulist"><ul><li><p>exhaustive <code>switch</code> without <code>default</code></p></li><li><p>pattern matching to destructure polymorphic data</p></li></ul></div></li></ul></div></div></section><section id="_guiding_principles"><h2>Guiding principles</h2><div class="slide-content"><div class="ulist"><ul><li><p>model the data, the whole data,<br>
and nothing but the data</p></li><li><p>data is immutable</p></li><li><p>validate at the boundary</p></li><li><p>make illegal states unrepresentable</p></li></ul></div>
<div class="paragraph"><p><a href="https://www.infoq.com/articles/data-oriented-programming-java/">Data Oriented Programming in Java</a></p></div></div></section><section id="_more_2"><h2>More</h2><div class="slide-content"><div class="paragraph"><p>More on data-oriented programming:</p></div>
<div class="ulist"><ul><li><p>üìù <a href="https://www.infoq.com/articles/data-oriented-programming-java/">Data Oriented Programming in Java</a> (Brian Goetz)</p></li><li><p>üé• <a href="https://www.youtube.com/watch?v=QrwFrm1R8OY">Java 21 Brings Full Pattern Matching</a> (Sep 2023)</p></li><li><p>üé• <a href="https://www.youtube.com/watch?v=5qYJYGvVLg8">Data-Oriented Programming</a> (Jul 2022)</p></li><li><p>üßë‚Äçüíª <a href="https://github.com/nipafx/loom-lab">GitHub crawler</a></p></li></ul></div></div></section></section>
<section><section id="_java_21_3"><h2>Java 21 üí£üí•</h2><div class="slide-content"><div class="paragraph"><p> <h3>Part I</h3> <table class="toc"> <tr><td>Pattern Matching</td></tr> <tr class="toc-current"><td>Virtual Threads</td></tr> <tr class="toc-current"><td style="padding-left: 2em;">Unlimited Threads</td></tr> <tr><td style="padding-left: 2em;">Under The Hood</td></tr> <tr><td>String Templates</td></tr> </table> </p></div></div></section><section id="_a_simple_web_request"><h2>A simple web request</h2><div class="slide-content"><div class="paragraph"><p>Imagine a hypothetical HTTP request:</p></div>
<div class="olist arabic"><ol class="arabic"><li><p>interpret request</p></li><li><p>query database (<em>blocks</em>)</p></li><li><p>process data for response</p></li></ol></div>
<div class="paragraph"><p>Resource utilization:</p></div>
<div class="ulist"><ul><li><p>good for 1. and 3.</p></li><li><p>really bad for 2.</p></li></ul></div>
<div class="paragraph"><p>How to implement that request?</p></div></div></section><section id="_synchronous"><h2>Synchronous</h2><div class="slide-content"><div class="paragraph"><p>Align application&#8217;s unit of concurrency (request) <br>
with Java&#8217;s unit of concurrency (thread):</p></div>
<div class="ulist"><ul><li><p>use thread per request</p></li><li><p>simple to write, debug, profile</p></li><li><p>blocks threads on certain calls</p></li><li><p>limited number of <em>platform</em> threads<br>
‚áù bad resource utilization<br>
‚áù low throughput</p></li></ul></div>
<aside class="notes"><div class="ulist"><ul><li><p>common CPU load: 5-30%</p></li></ul></div></aside></div></section><section id="_asynchronous"><h2>Asynchronous</h2><div class="slide-content"><div class="paragraph"><p>Only use threads for actual computations:</p></div>
<div class="ulist"><ul><li><p>use non-blocking APIs (futures / reactive streams)</p></li><li><p>harder to write, challenging to debug/profile</p></li><li><p>incompatible with synchronous code</p></li><li><p>shares platform threads<br>
‚áù great resource utilization<br>
‚áù high throughput</p></li></ul></div></div></section><section id="_conflict"><h2>Conflict!</h2><div class="slide-content"><div class="paragraph"><p>There&#8217;s a conflict between:</p></div>
<div class="ulist"><ul><li><p>simplicity</p></li><li><p>throughput</p></li></ul></div></div></section><section id="_nota_bene"><h2>Nota bene</h2><div class="slide-content"><div class="paragraph"><p>There are other conflicts:</p></div>
<div class="ulist"><ul><li><p><em>design vs performance</em> (‚áù Valhalla)</p></li><li><p><em>explicitness vs succinctness</em> (‚áù Amber)</p></li><li><p><em>flexibility vs safety</em> (‚áù Panama)</p></li><li><p><em>dynamism vs performance</em> (‚áù Leyden)</p></li></ul></div></div></section><section id="_enter_virtual_threads"><h2>Enter virtual threads!</h2><div class="slide-content"><div class="paragraph"><p>A <em>virtual</em> thread:</p></div>
<div class="ulist"><ul><li><p>is a regular <code>Thread</code></p></li><li><p>low memory footprint ([k]bytes)</p></li><li><p>small switching cost</p></li><li><p>scheduled by the Java runtime</p></li><li><p>requires no OS thread when waiting</p></li></ul></div></div></section><section id="_virtual_things"><h2>Virtual things</h2><div class="slide-content"><div class="paragraph"><p><strong>Virtual memory:</strong></p></div>
<div class="ulist"><ul><li><p>maps large virtual address space<br>
to limited physical memory</p></li><li><p>gives illusion of plentiful memory</p></li></ul></div>
<div class="paragraph"><p><strong>Virtual threads:</strong></p></div>
<div class="ulist"><ul><li><p>map large number of virtual threads<br>
to a small number of OS threads</p></li><li><p>give the illusion of plentiful threads</p></li></ul></div></div></section><section id="_virtual_things_2"><h2>Virtual things</h2><div class="slide-content"><div class="paragraph"><p>Programs rarely care about virtual vs physical memory.</p></div>
<div class="paragraph"><p>Programs need rarely care about virtual vs platform thread.</p></div>
<div class="paragraph"><p>Instead:</p></div>
<div class="ulist"><ul><li><p>write straightforward (blocking) code</p></li><li><p>runtime shares available OS threads</p></li><li><p>reduces the cost of blocking to near zero</p></li></ul></div></div></section><section data-background-color="white" data-background-image="../_images/one-million-96b61ed0.jpg" data-background-size="cover" data-state="empty"></section><section id="_example"><h2>Example</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">try (var executor = Executors
		.newVirtualThreadPerTaskExecutor()) {
	for (int i = 0; i &lt; 1_000_000; i++) {
		var number = i;
		executor.submit(() -&gt; {
			Thread.sleep(Duration.ofSeconds(1));
			return number;
		});
	}
} // executor.close() is called implicitly, and waits</code></pre></div></div></div></section><section id="_effects"><h2>Effects</h2><div class="slide-content"><div class="paragraph"><p>Virtual threads:</p></div>
<div class="ulist"><ul><li><p>remove "number of threads" as bottleneck</p></li><li><p>match app&#8217;s unit of concurrency to Java&#8217;s</p></li></ul></div>
<div class="paragraph"><p>‚áù <em>simplicity &amp;&amp; throughput</em></p></div></div></section><section id="_performance"><h2>Performance</h2><div class="slide-content"><div class="paragraph"><p>Virtual threads aren&#8217;t "faster threads":</p></div>
<div class="ulist"><ul><li><p>same number of CPU cycles</p></li><li><p>each task takes the same time (same <em>latency</em>)</p></li></ul></div>
<div class="paragraph fragment"><p>So why bother?</p></div></div></section><section id="_parallelism_vs_concurrency"><h2>Parallelism vs concurrency</h2><div class="slide-content"><table class="tableblock frame-all grid-all" style="width:100%"><colgroup><col style="width:33.3333%"><col style="width:33.3333%"><col style="width:33.3334%"></colgroup><thead><tr><th class="tableblock halign-left valign-top"></th><th class="tableblock halign-left valign-top">Parallelism</th><th class="tableblock halign-left valign-top">Concurrency</th></tr><tbody><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Task origin</strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">solution</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">problem</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Control</strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">developer</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">environment</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Resource use</strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">coordinated</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">competitive</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Metric</strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">latency</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">throughput</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Abstraction</strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">CPU cores</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">tasks</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong># of threads</strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock"># of cores</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"># of tasks</p></td></tr></table></div></section><section id="_performance_2"><h2>Performance</h2><div class="slide-content"><div class="paragraph"><p>When workload is not CPU-bound:</p></div>
<div class="ulist"><ul><li><p>start waiting as early as possible</p></li><li><p>for as many tasks as possible</p></li></ul></div>
<div class="paragraph"><p>‚áù Virtual threads increase <em>throughput</em>:</p></div>
<div class="ulist"><ul><li><p>when workload is not CPU-bound</p></li><li><p>when number of concurrent tasks is high</p></li></ul></div>
<aside class="notes"><div class="ulist"><ul><li><p>maximize progress other systems can make.</p></li><li><p>"high": more than a few thousand</p></li></ul></div></aside></div></section><section id="_server_how_to"><h2>Server how-to</h2><div class="slide-content"><div class="paragraph"><p>For servers:</p></div>
<div class="ulist"><ul><li><p>request handling threads are started by web framework</p></li><li><p>frameworks will offer (easy) configuration options</p></li></ul></div>
<div class="paragraph"><p>We&#8217;re getting there.</p></div></div></section><section id="_spring_boot"><h2>Spring Boot</h2><div class="slide-content"><div class="paragraph"><p>Set property on 3.2 (Nov 2023):</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code>spring.threads.virtual.enabled=true</code></pre></div></div>
<div class="paragraph"><p>(<a href="https://quarkus.io/guides/resteasy-reactive-virtual-threads">Source</a>)</p></div></div></section><section id="_quarkus"><h2>Quarkus</h2><div class="slide-content"><div class="paragraph"><p>Annotate request handling method on 3.?:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">@GET
@Path("api")
@RunOnVirtualThread
public String handle() {
	// ...
}</code></pre></div></div>
<div class="paragraph"><p>(<a href="https://quarkus.io/guides/resteasy-reactive-virtual-threads">Source</a>)</p></div></div></section><section id="_helidon"><h2>Helidon</h2><div class="slide-content"><div class="paragraph"><p>Just works on 4.0 (currently RC1).</p></div>
<div class="paragraph"><p>(<a href="https://helidon.io/nima">Source</a>)</p></div></div></section><section id="_more_3"><h2>More</h2><div class="slide-content"><div class="ulist"><ul><li><p>üìù <a href="https://openjdk.org/jeps/444">JEP 444</a></p></li><li><p>üìù <a href="https://inside.java/2021/11/30/on-parallelism-and-concurrency/">On Parallelism and Concurrency</a></p></li><li><p>üé• <a href="https://www.youtube.com/watch?v=5E0LU85EnTI">Java 21 new feature: Virtual Threads</a> (Sep 2023)</p></li></ul></div></div></section><section id="_virtual_threads"><h2>Virtual threads</h2><div class="slide-content"><div class="quoteblock"><blockquote><div class="paragraph"><p>Go forth and multiply (your threads)</p></div></blockquote></div></div></section></section>
<section><section id="_java_21_4"><h2>Java 21 üí£üí•</h2><div class="slide-content"><div class="paragraph"><p> <h3>Part I</h3> <table class="toc"> <tr><td>Pattern Matching</td></tr> <tr class="toc-current"><td>Virtual Threads</td></tr> <tr><td style="padding-left: 2em;">Unlimited Threads</td></tr> <tr class="toc-current"><td style="padding-left: 2em;">Under The Hood</td></tr> <tr><td>String Templates</td></tr> </table> </p></div></div></section><section id="_preparing_your_code"><h2>Preparing your code</h2><div class="slide-content"><div class="paragraph"><p>Virtual threads:</p></div>
<div class="ulist"><ul><li><p>always work correctly</p></li><li><p>may not scale perfectly</p></li></ul></div>
<div class="paragraph"><p>Code changes can improve scalability<br>
(and maintainability, debuggability, observability).</p></div></div></section><section id="_avoid_thread_pools"><h2>Avoid thread pools</h2><div class="slide-content"><div class="paragraph"><p>Only pool expensive resources<br>
but virtual threads are cheap.</p></div>
<div class="paragraph"><p>‚áù Replace thread pools (for concurrency),<br>
  with virtual threads plus, e.g., semaphores.</p></div></div></section><section id="_with_thread_pools"><h2>With thread pools</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">// limits concurrent queries but pools üëéüèæ
private static final ExecutorService DB_POOL =
	Executors.newFixedThreadPool(16);

public &lt;T&gt; Future&lt;T&gt; queryDatabase(Callable&lt;T&gt; query) {
	return DB_POOL.submit(query);
}</code></pre></div></div></div></section><section id="_with_semaphore"><h2>With semaphore</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">// limits concurrent queries without pool üëçüèæ
private static final Semaphore DB_SEMAPHORE =
	new Semaphore(16);

public &lt;T&gt; T queryDatabase(Callable&lt;T&gt; query)
		throws Exception {
	DB_SEMAPHORE.acquire();
	try {
		return query.call();
	} finally {
		DB_SEMAPHORE.release();
	}
}</code></pre></div></div></div></section><section id="_caveats"><h2>Caveats</h2><div class="slide-content"><div class="paragraph"><p>To understand virtual thread caveats<br>
we need to understand how they work.</p></div>
<div class="paragraph"><p>(Also, it&#8217;s very interesting.)</p></div></div></section><section id="_under_the_hood"><h2>Under the hood</h2><div class="slide-content"><div class="paragraph"><p>The Java runtime manages virtual threads:</p></div>
<div class="ulist"><ul><li class="fragment"><p>runs them on a pool of <em>carrier threads</em><br></p></li><li class="fragment"><p>on blocking call:</p><div class="ulist"><ul><li class="fragment"><p>internally calls non-blocking operation</p></li><li class="fragment"><p><strong><em>unmounts</em> from carrier thread!</strong></p></li></ul></div></li><li class="fragment"><p>when call returns:<br></p><div class="ulist"><ul><li class="fragment"><p><em>mounts</em> to (other) carrier thread</p></li><li class="fragment"><p>continues</p></li></ul></div></li></ul></div>
<aside class="notes"><div class="ulist"><ul><li><p>dedicated <code>ForkJoinPool</code> in FIFO mode</p></li></ul></div></aside></div></section><section id="_the_simple_web_request"><h2>The simple web request</h2><div class="slide-content"><div class="paragraph"><p>Remember the hypothetical request:</p></div>
<div class="olist arabic"><ol class="arabic"><li><p>interpret request</p></li><li><p>query database (<em>blocks</em>)</p></li><li><p>process data for response</p></li></ol></div>
<div class="paragraph"><p>In a virtual thread:</p></div>
<div class="ulist"><ul><li class="fragment"><p>runtime submits task to carrier thread pool</p></li><li class="fragment"><p>when 2. blocks, virtual thread unmounts</p></li><li class="fragment"><p>runtime hands carrier thread back to pool</p></li><li class="fragment"><p>when 2. unblocks, runtime resubmits task</p></li><li class="fragment"><p>virtual thread mounts and continues with 3.</p></li></ul></div></div></section><section id="_compatibility"><h2>Compatibility</h2><div class="slide-content"><div class="paragraph"><p>Virtual threads work correctly with everything:</p></div>
<div class="ulist"><ul><li><p>all blocking operations</p></li><li><p><code>synchronized</code></p></li><li><p><code>Thread</code>, <code>currentThread</code>, etc.</p></li><li><p>thread interruption</p></li><li><p>thread-locals</p></li><li><p>native code</p></li></ul></div>
<div class="paragraph"><p>But not all scale perfectly.</p></div></div></section><section id="_caveat_1_capture"><h2>Caveat #1: capture</h2><div class="slide-content"><div class="paragraph"><p>Despite lots of internal rework
(e.g. JEPs <a href="https://openjdk.org/jeps/353">353</a>, <a href="https://openjdk.org/jeps/373">373</a>)<br>
not all blocking operations unmount.</p></div>
<div class="paragraph"><p>Some <em>capture</em> platform thread:</p></div>
<div class="ulist"><ul><li><p><code>Object::wait</code></p></li><li><p>file I/O (‚áù <em>io_uring</em>)</p></li></ul></div>
<div class="paragraph"><p>‚áù Compensated by temporarily growing carrier pool.</p></div>
<div class="paragraph"><p>‚ö†Ô∏è Problematic when capturing operations dominate.</p></div></div></section><section id="_caveat_2_pinning"><h2>Caveat #2: pinning</h2><div class="slide-content"><div class="paragraph"><p>Some operations <em>pin</em> (operations don&#8217;t unmount):</p></div>
<div class="ulist"><ul><li><p>native method call (JNI)</p></li><li><p>foreign function call (FFM)</p></li><li><p><code>synchronized</code> block (for now)</p></li></ul></div>
<div class="paragraph"><p>‚áù No compensation</p></div>
<div class="paragraph"><p>‚ö†Ô∏è Problematic when:</p></div>
<div class="ulist"><ul><li><p>pinning is frequent</p></li><li><p>contains blocking operations</p></li></ul></div></div></section><section id="_avoid_long_running_pins"><h2>Avoid long-running pins</h2><div class="slide-content"><div class="paragraph"><p>If possible:</p></div>
<div class="ulist"><ul><li><p>avoid pinning operations</p></li><li><p>remove blocking operations<br>
from pinning code sections.</p></li></ul></div></div></section><section id="_with_synchronization"><h2>With synchronization</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">// guarantees sequential access, but pins (for now) üëéüèæ
public synchronized String accessResource() {
	return access();
}</code></pre></div></div></div></section><section id="_with_lock"><h2>With lock</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">// guarantees sequential access without pinning üëçüèæ
private static final ReentrantLock LOCK =
	new ReentrantLock();

public String accessResource() {
	// lock guarantees sequential access
	LOCK.lock();
	try {
		return access();
	} finally {
		LOCK.unlock();
	}
}</code></pre></div></div></div></section><section id="_caveat_3_thread_locals"><h2>Caveat #3: thread-locals</h2><div class="slide-content"><div class="paragraph"><p>Thread-locals can hinder scalability:</p></div>
<div class="ulist"><ul><li><p>can be inherited</p></li><li><p>to keep them thread-local,<br>
values are copied</p></li><li><p>can occupy lots of memory</p></li></ul></div>
<div class="paragraph"><p>(There are also API shortcomings.)</p></div>
<div class="paragraph"><p>‚áù Refactor to scoped values (<a href="https://openjdk.org/jeps/446">JEP 446</a>).</p></div></div></section><section id="_with_thread_local"><h2>With thread-local</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">// copies value for each inheriting thread üëéüèæ
static final ThreadLocal&lt;Principal&gt; PRINCIPAL =
	new ThreadLocal&lt;&gt;();

public void serve(Request request, Response response) {
	var level = request.isAdmin() ? ADMIN : GUEST;
	var principal = new Principal(level);
	PRINCIPAL.set(principal);
	Application.handle(request, response);
}</code></pre></div></div></div></section><section id="_with_scoped_value"><h2>With scoped value</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">// immutable, so no copies needed üëçüèæ
static final ScopedValue&lt;Principal&gt; PRINCIPAL =
	new ScopedValue&lt;&gt;();

public void serve(Request request, Response response) {
	var level = request.isAdmin() ? ADMIN : GUEST;
	var principal = new Principal(level);
	ScopedValue
		.where(PRINCIPAL, principal)
		.run(() -&gt; Application
			.handle(request, response));
}</code></pre></div></div></div></section><section id="_preparing_your_code_2"><h2>Preparing your code</h2><div class="slide-content"><div class="paragraph"><p>Most importantly:</p></div>
<div class="olist arabic"><ol class="arabic"><li><p>replace thread pools with semaphores</p></li></ol></div>
<div class="paragraph"><p>Also helpful:</p></div>
<div class="olist arabic"><ol class="arabic" start="2"><li><p>remove long-running I/O from pinned sections</p></li><li><p>replace thread-locals with scoped values</p></li><li><p>replace <code>synchronized</code> with locks</p></li></ol></div></div></section></section>
<section><section id="_java_21_5"><h2>Java 21 üí£üí•</h2><div class="slide-content"><div class="paragraph"><p> <h3>Part I</h3> <table class="toc"> <tr><td>Pattern Matching</td></tr> <tr><td>Virtual Threads</td></tr> <tr class="toc-current"><td>String Templates</td></tr> </table> </p></div></div></section><section id="_string_composition"><h2>String composition</h2><div class="slide-content"><div class="paragraph"><p>Composing strings in Java is cumbersome:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">String property = "last_name";
String value = "Doe";

// concatenation
String query =
	"SELECT * FROM Person p WHERE p."
		+ property + " = '" + value + "'";
// formatting
String query =
	"SELECT * FROM Person p WHERE p.%s = '%s'"
		.formatted(property, value);</code></pre></div></div>
<div class="paragraph fragment"><p>Comes with free SQL injection! üò≥</p></div></div></section><section id="_string_interpolation"><h2>String interpolation</h2><div class="slide-content"><div class="paragraph"><p>Why not?</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">// (fictional syntax!)
String query =
	"SELECT * FROM Person p "
		+ "WHERE p.\{property} = '\{value}'";</code></pre></div></div>
<div class="paragraph fragment"><p>Also comes with free SQL injection! üò≥</p></div></div></section><section id="_string_interpolation_2"><h2>String interpolation</h2><div class="slide-content"><div class="paragraph"><p>SQL injections aren&#8217;t the only concern.</p></div>
<div class="paragraph"><p>These also need validation and sanitization:</p></div>
<div class="ulist"><ul><li><p>HTML/XML</p></li><li><p>JSON</p></li><li><p>YAML</p></li><li><p>&#8230;&#8203;</p></li></ul></div>
<div class="paragraph"><p>All follow format-specific rules.</p></div></div></section><section id="_string_templates"><h2>String templates</h2><div class="slide-content"><div class="paragraph"><p><em>[Preview in Java 21 and 22&#8201;&#8212;&#8201;<a href="https://openjdk.org/jeps/430">JEP 430</a>, <a href="https://openjdk.org/jeps/459">JEP 459</a>]</em></p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">String query = STR."""
	SELECT * FROM Person p
	WHERE p.\{property} = '\{value}'
	""";</code></pre></div></div>
<div class="paragraph"><p><em>Template expression</em> ingredients:</p></div>
<div class="ulist"><ul><li><p><em>template</em> with embedded expressions<br>
~&gt; <code>StringTemplate</code></p></li><li><p><em>template processor</em> (e.g. <code>STR</code>):<br>
transforms <code>StringTemplate</code> into <code>String</code>*</p></li></ul></div></div></section><section id="_template_procesor_str"><h2>Template procesor STR</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">String form = STR."""
	Desc     Unit   Qty   Amount
	\{desc} $\{price} \{qty} $\{price * qty}

	Subtotal  $\{price * qty}
	Tax       $\{price * qty * tax}
	Total     $\{price * qty * (1.0 + tax)}
	""";</code></pre></div></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code>Desc     Unit   Qty   Amount
hammer   $7.88  3     $23.64

Subtotal  $23.64
Tax       $3.546
Total     $27.186</code></pre></div></div></div></section><section id="_template_processor_fmt"><h2>Template processor FMT</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">String form = FMT."""
	Desc        Unit      Qty   Amount
	%-10s\{desc} $%5.2f\{price} %5d\{qty} $%5.2f\{price * qty}

	Subtotal  $%5.2f\{price * qty}
	Tax       $%5.2f\{price * qty * tax}
	Total     $%5.2f\{price * qty * (1.0 + tax)}
	""";</code></pre></div></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code>Desc        Unit      Qty   Amount
hammer      $ 7.88      3   $23.64

Subtotal  $23.64
Tax       $ 3.55
Total     $27.19</code></pre></div></div></div></section><section id="_why_strings"><h2>Why strings?</h2><div class="slide-content"><div class="paragraph"><p>Often, strings are just exchange format, e.g.:</p></div>
<div class="ulist"><ul><li><p>start with: <code>String</code> + values</p></li><li><p>validate / sanitize (i.e. parse)</p></li><li><p><em>dumb down to:</em> <code>String</code>  ü§î</p></li><li><p>parse to: <code>JSONObject</code>, <code>Statement</code>, ‚Ä¶</p></li></ul></div>
<div class="paragraph"><p>Why the detour?</p></div></div></section><section id="_custom_templating"><h2>Custom templating</h2><div class="slide-content"><div class="paragraph"><p><code>STR</code> is a singleton instance of<br>
a <code>Processor</code> implementation:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">public interface Processor&lt;RESULT, EX&gt; {
	RESULT process(StringTemplate s) throws EX;
}</code></pre></div></div>
<div class="paragraph"><p><code>RESULT</code> can be of any type!</p></div></div></section><section id="_custom_templating_2"><h2>Custom templating</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">// prevents SQL injections
Statement query = SQL."""
	SELECT * FROM Person p
	WHERE p.\{property} = '\{value}'
	""";

// validates &amp; escapes JSON
JSONObject doc = JSON."""
	{
		"name": "\{name}",
		"year": "\{bday.getYear()}"
	}
	""";</code></pre></div></div></div></section><section id="_summary"><h2>Summary</h2><div class="slide-content"><div class="paragraph"><p>String templates:</p></div>
<div class="ulist"><ul><li><p>simplify string concatenation</p></li><li><p>enable domain-specific processing</p></li><li><p>incentivize the "right way"</p></li></ul></div></div></section></section>
<section id="_break"><h2>Break</h2><div class="slide-content"><div class="paragraph"><p>We&#8217;ll see you back here in 15 minutes with <strong>Part II</strong>:</p></div>
<div class="ulist"><ul><li><p>on-ramping to Java</p></li><li><p>sequenced collections</p></li><li><p>misc API improvements</p></li><li><p>GC, CDS, UTF-8</p></li></ul></div></div></section>
<section><section id="_java_21_6"><h2>Java 21 üí£üí•</h2><div class="slide-content"><div class="paragraph"><p> <h3>Part II</h3> <table class="toc"> <tr class="toc-current"><td>On-Ramp</td></tr> <tr><td>Sequenced Collections</td></tr> <tr><td>Misc. API Improvements</td></tr> <tr><td>Generational ZGC</td></tr> <tr><td>Class-Data Sharing</td></tr> <tr><td>UTF-8 by Default</td></tr> </table> </p></div></div></section><section id="_starting_with_java"><h2>Starting (with) Java</h2><div class="slide-content"><div class="paragraph"><p>Java 21 makes life easier<br>
for new (Java) developers.</p></div></div></section><section id="_why_do_we_care"><h2>Why do we care?</h2><div class="slide-content"><div class="paragraph"><p>We all know Java, IDEs, build tools, etc.</p></div>
<div class="ulist"><ul><li class="fragment"><p>do we all?</p></li><li class="fragment"><p>what about your kids?</p></li><li class="fragment"><p>what about students?</p></li><li class="fragment"><p>what about the frontend dev?</p></li><li class="fragment"><p>what about ML/AI folks?</p></li></ul></div>
<div class="paragraph fragment"><p>Java needs to be approachable!<br>
Java needs an on-ramp for new (Java) developers!</p></div></div></section><section id="_running_java"><h2>Running Java</h2><div class="slide-content"><div class="paragraph"><p>To write and run a simple Java program, you need:</p></div>
<div class="ulist"><ul><li class="fragment"><p>a JDK</p></li><li class="fragment"><p>an editor (IDE?)</p></li><li class="fragment"><p><code>javac</code> (build tool? IDE?)</p></li><li class="fragment"><p><code>java</code> (IDE?)</p></li><li class="fragment"><p>some Java code</p></li></ul></div></div></section><section id="_writing_java"><h2>Writing Java</h2><div class="slide-content"><div class="paragraph"><p>Minimal Java code:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">public class Main {
	public static void main(String[] args) {
		System.out.println("Hello, World!");
	}
}</code></pre></div></div>
<div class="ulist"><ul><li class="fragment"><p>visibility</p></li><li class="fragment"><p>classes &amp; methods</p></li><li class="fragment"><p>static vs instance</p></li><li class="fragment"><p>returns &amp; parameters</p></li><li class="fragment"><p>statements &amp; arguments</p></li></ul></div></div></section><section id="_approachability"><h2>Approachability</h2><div class="slide-content"><div class="paragraph"><p>That&#8217;s <em>a lot</em> of tools and concepts!</p></div>
<div class="paragraph"><p>Java is great for large-scale development:</p></div>
<div class="ulist"><ul><li><p>detailed toolchain</p></li><li><p>refined programming model</p></li></ul></div>
<div class="paragraph"><p>This make it less approachable.</p></div>
<div class="paragraph fragment"><p>Let&#8217;s change that!</p></div></div></section><section id="_jshell"><h2>jshell</h2><div class="slide-content"><div class="paragraph"><p>Java 9 added <code>jshell</code>:</p></div>
<div class="ulist"><ul><li><p><strong>all you need</strong>:</p><div class="ulist"><ul><li><p>tools: JDK, <code>jshell</code></p></li><li><p>concepts: statements &amp; arguments</p></li></ul></div></li><li><p><strong>but</strong>:</p><div class="ulist"><ul><li><p>not great for beginners (IMO)</p></li><li><p>no progression</p></li></ul></div></li></ul></div>
<div class="paragraph"><p>More is needed.</p></div></div></section><section id="_single_file_execution"><h2>Single-file execution</h2><div class="slide-content"><div class="paragraph"><p>Java 11 added single-file execution (<a href="https://openjdk.org/jeps/330">JEP 330</a>):</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code>java Prog.java</code></pre></div></div>
<div class="ulist"><ul><li><p><strong>removed</strong>: <code>javac</code></p></li><li><p><strong>but</strong>: no progression</p></li></ul></div>
<div class="paragraph"><p>Much better for beginners,<br>
but just a section of an on-ramp.</p></div></div></section><section id="_on_ramp"><h2>On-Ramp</h2><div class="slide-content"><div class="paragraph"><p>Expand single-file execution in two directions:</p></div>
<div class="ulist"><ul><li><p><strong>simplify code</strong>: reduce required Java concepts</p></li><li><p><strong>ease progression</strong>: run multiple files with <code>java</code></p></li></ul></div></div></section><section id="_simpler_code"><h2>Simpler code</h2><div class="slide-content"><div class="paragraph"><p>Remove requirement of:</p></div>
<div class="ulist"><ul><li class="fragment"><p><code>String[] args</code> parameter</p></li><li class="fragment"><p><code>main</code> being static</p></li><li class="fragment"><p><code>main</code> being public</p></li><li class="fragment"><p>the class itself</p></li></ul></div>
<div class="listingblock fragment"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">// all the code in Prog.java
void main() {
	System.out.println("Hello, World!");
}</code></pre></div></div>
<div class="paragraph fragment"><p><em>[Preview in Java 21&#8201;&#8212;&#8201;<a href="https://openjdk.org/jeps/445">JEP 445</a>]</em></p></div></div></section><section id="_running_multiple_files"><h2>Running multiple files</h2><div class="slide-content"><div class="paragraph"><p>Say you have a folder:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code>MyFirstJava
 ‚îú‚îÄ Prog.java
 ‚îú‚îÄ Helper.java
 ‚îî‚îÄ Lib
     ‚îî‚îÄ library.jar</code></pre></div></div>
<div class="paragraph"><p>Run with:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code>java -cp 'Lib/*' Prog.java</code></pre></div></div>
<div class="paragraph fragment"><p><em>[Preview in Java 22&#8201;&#8212;&#8201;<a href="https://openjdk.org/jeps/458">JEP 458</a>]</em></p></div></div></section><section id="_progression"><h2>Progression</h2><div class="slide-content"><div class="paragraph"><p>Natural progression:</p></div>
<div class="ulist"><ul><li class="fragment"><p>start with <code>main()</code></p></li><li class="fragment"><p>need arguments? ‚áù add <code>String[] args</code></p></li><li class="fragment"><p>need to organize code? ‚áù add methods</p></li><li class="fragment"><p>need shared state? ‚áù add fields</p></li><li class="fragment"><p>need more functionality? ‚áù explore JDK APIs</p></li><li class="fragment"><p>even more? ‚áù explore simple libraries</p></li><li class="fragment"><p>need more structure? ‚áù split into multiple files</p></li><li class="fragment"><p>even more ‚áù use visibility &amp; packages</p></li></ul></div>
<div class="paragraph fragment"><p>Doesn&#8217;t even have to be that order!</p></div></div></section><section id="_summary_2"><h2>Summary</h2><div class="slide-content"><div class="paragraph"><p>Java&#8217;s strengths for large-scale development<br>
make it less approachable:</p></div>
<div class="ulist"><ul><li><p>detailed toolchain</p></li><li><p>refined programming model</p></li></ul></div>
<div class="paragraph"><p>There are new features that:</p></div>
<div class="ulist"><ul><li><p>make it easier to start</p></li><li><p>allow gradual progression</p></li><li><p>entice the future dev generation</p></li></ul></div></div></section><section id="_more_4"><h2>More</h2><div class="slide-content"><div class="ulist"><ul><li><p>üìù <a href="https://openjdk.org/jeps/445">JEP 445</a> for a simpler <code>main</code></p></li><li><p>üìù <a href="https://openjdk.org/jeps/458">JEP 458</a> for launching multiple source file</p></li><li><p>üé• <a href="https://www.youtube.com/watch?v=P9JPUbG5npI">Script Java Easily in 21 and Beyond</a> (May 2023)</p></li></ul></div></div></section></section>
<section><section id="_java_21_7"><h2>Java 21 üí£üí•</h2><div class="slide-content"><div class="paragraph"><p> <h3>Part II</h3> <table class="toc"> <tr><td>On-Ramp</td></tr> <tr class="toc-current"><td>Sequenced Collections</td></tr> <tr><td>Misc. API Improvements</td></tr> <tr><td>Generational ZGC</td></tr> <tr><td>Class-Data Sharing</td></tr> <tr><td>UTF-8 by Default</td></tr> </table> </p></div></div></section><section id="_order"><h2>Order</h2><div class="slide-content"><div class="paragraph"><p>Collections with order and indexed access:</p></div>
<div class="ulist"><ul><li><p><code>List</code></p></li></ul></div>
<div class="paragraph"><p>Collections with order <em>without</em> indexed access:</p></div>
<div class="ulist"><ul><li><p><code>SortedSet</code> (sort order)</p></li><li><p><code>Deque</code> (insertion order)</p></li><li><p><code>LinkedHashSet</code> (insertion order)</p></li><li><p>and more</p></li></ul></div></div></section><section id="_sequence"><h2>Sequence</h2><div class="slide-content"><div class="paragraph"><p>New interfaces capture the concept of order:</p></div>
<div class="ulist"><ul><li><p><code>SequencedCollection</code></p></li><li><p><code>SequencedSet</code></p></li><li><p><code>SequencedMap</code></p></li></ul></div>
<div class="paragraph"><p>Use as parameter or return type<br>
and enjoy new methods.</p></div></div></section><section id="_get_first"><h2>Get first</h2><div class="slide-content"><div class="paragraph"><p>Getting the first element:</p></div>
<div class="ulist"><ul><li><p><code>list.get(0)</code></p></li><li><p><code>sortedSet.first()</code></p></li><li><p><code>deque.getFirst()</code></p></li><li><p><code>linkedHashSet.iterator().next()</code></p></li></ul></div>
<div class="paragraph"><p>Now for all:</p></div>
<div class="paragraph"><p><code>sequencedCollection.getFirst()</code></p></div></div></section><section id="_remove_last"><h2>Remove last</h2><div class="slide-content"><div class="paragraph"><p>Removing the last element:</p></div>
<div class="ulist"><ul><li><p><code>list.remove(list.size() - 1)</code></p></li><li><p><code>sortedSet.remove(sortedSet.last())</code></p></li><li><p><code>deque.removeLast()</code></p></li><li><p><code>linkedHashSet.ü§∑üèæ‚Äç‚ôÇÔ∏è()</code></p></li></ul></div>
<div class="paragraph"><p>Now for all:</p></div>
<div class="paragraph"><p><code>sequencedCollection.removeLast()</code></p></div></div></section><section id="_reverse_order"><h2>Reverse order</h2><div class="slide-content"><div class="paragraph"><p>Reversing order:</p></div>
<div class="ulist"><ul><li><p><code>list.listIterator()</code> ‚áù <code>ListIterator</code></p></li><li><p><code>navigableSet.descendingSet()</code> ‚áù <code>NavigableSet</code> (view)</p></li><li><p><code>deque.descendingIterator()</code> ‚áù <code>Iterator</code></p></li><li><p><code>linkedHashSet.ü§∑üèæ‚Äç‚ôÇÔ∏è()</code></p></li></ul></div>
<div class="paragraph"><p>Now for all:</p></div>
<div class="paragraph"><p><code>sequencedCollection.reversed()</code></p></div></div></section><section id="_reversed_collection"><h2>Reversed collection</h2><div class="slide-content"><div class="paragraph"><p><code>sequencedCollection.reversed()</code> returns<br>
a <code>SequencedCollection</code> view:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">for (E element : list.reversed())
	// ...

sortedSet
	.reversed().stream()
	//...

deque.reversed().toArray();</code></pre></div></div></div></section><section id="_reversed_view"><h2>Reversed view</h2><div class="slide-content"><div class="paragraph"><p><code>sequencedCollection.reversed()</code> returns<br>
a <code>SequencedCollection</code> view:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">var letters = new ArrayList&lt;&gt;(List.of("A", "B", "C"));
	// ‚áù letters = ["A", "B", "C"]
letters.reversed().removeFirst();
	// ‚áù letters = ["A", "B"]</code></pre></div></div></div></section><section id="_new_operations"><h2>New operations</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">void addFirst(E);
void addLast(E);
E getFirst();
E getLast();
E removeFirst();
E removeLast();

SequencedCollection&lt;E&gt; reversed();</code></pre></div></div>
<div class="paragraph"><p>(Analoguous for maps.)</p></div></div></section><section id="_new_ops_vs_sort_order"><h2>New ops vs sort order</h2><div class="slide-content"><div class="paragraph"><p>What happens when <code>addFirst|Last</code> is used<br>
on a sorted data structure?</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">SortedSet&lt;String&gt; letters = new TreeSet&lt;&gt;(
	List.of("B", "A", "C"));
	// ‚áù letters = ["A", "B", "C"]
letters.addLast("D");</code></pre></div></div>
<div class="paragraph"><p>Options:</p></div>
<div class="ulist"><ul><li class="fragment"><p>works always ‚áù breaks <code>SortedSet</code> contract</p></li><li class="fragment"><p>works if value fits ‚áù hard to predict</p></li><li class="fragment"><p>works never ‚áù <code>UnsupportedOperationException</code></p></li></ul></div></div></section><section id="_using_types"><h2>Using types</h2><div class="slide-content"><div class="paragraph"><p>Use the most general type that:</p></div>
<div class="ulist"><ul><li><p>has the API you need/support</p></li><li><p>plays the role you need/support</p></li></ul></div>
<div class="paragraph"><p>For collections, that&#8217;s often: <code>Collection</code><br>
(less often: <code>List</code>, <code>Set</code>).</p></div>
<div class="paragraph"><p>‚áù Consider new types!</p></div></div></section><section data-background-color="white" data-background-image="../_images/sequenced-collections-hierarchy-e9455079.png" data-background-size="contain" data-state="empty"></section><section id="_more_5"><h2>More</h2><div class="slide-content"><div class="ulist"><ul><li><p>üìù <a href="https://openjdk.org/jeps/431">JEP 431</a>: Sequenced Collections</p></li><li><p>üé• <a href="https://www.youtube.com/watch?v=9G_0el3RWPE">Java 21&#8217;s New (Sequenced) Collections</a> (Mar 2023)</p></li></ul></div></div></section></section>
<section><section id="_java_21_8"><h2>Java 21 üí£üí•</h2><div class="slide-content"><div class="paragraph"><p> <h3>Part II</h3> <table class="toc"> <tr><td>On-Ramp</td></tr> <tr><td>Sequenced Collections</td></tr> <tr class="toc-current"><td>Misc. API Improvements</td></tr> <tr><td>Generational ZGC</td></tr> <tr><td>Class-Data Sharing</td></tr> <tr><td>UTF-8 by Default</td></tr> </table> </p></div></div></section><section id="_collections"><h2>Collections</h2><div class="slide-content"><div class="paragraph"><p>How do you create an <code>ArrayList</code> that<br>
can store 50 elements without resizing?</p></div>
<div class="listingblock fragment" data-fragment-index="1"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">new ArrayList&lt;&gt;(50);</code></pre></div></div>
<div class="paragraph fragment" data-fragment-index="2"><p>How do you create a <code>HashMap</code> that<br>
can store 50 pairs without resizing?</p></div>
<div class="listingblock fragment" data-fragment-index="3"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">new HashMap&lt;&gt;(64, 0.8f);
new HashMap&lt;&gt;(128);</code></pre></div></div>
<div class="paragraph fragment" data-fragment-index="3"><p>ü§î</p></div></div></section><section id="_collections_2"><h2>Collections</h2><div class="slide-content"><div class="paragraph"><p>Right-sizing hashing data structures:</p></div>
<div class="ulist"><ul><li><p><code>HashMap.newHashMap(int numMappings)</code></p></li><li><p><code>HashSet.newHashSet(int numElements)</code></p></li><li><p><code>LinkedHashMap.newLinkedHashMap(int numMappings)</code></p></li><li><p><code>LinkedHashSet.newLinkedHashSet(int numElements)</code></p></li></ul></div></div></section><section id="_math"><h2>Math</h2><div class="slide-content"><div class="paragraph"><p>Lots of new methods on <code>Math</code>:</p></div>
<div class="ulist"><ul><li><p>for <code>int</code>/<code>long</code> division with different modes for:</p><div class="ulist"><ul><li><p>rounding</p></li><li><p>overflow handling</p></li></ul></div></li><li><p>for ceiling modulus (<code>5 ‚åà%‚åâ 3 = -1</code>)</p></li><li><p>for clamping</p></li></ul></div></div></section><section id="_strings_and_builders"><h2>Strings and builders</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">"String".indexOf(
	String str, int beginIndex, int endIndex)</code></pre></div></div>
<div class="paragraph"><p>On <code>StringBuilder</code> and <code>StringBuffer</code>:</p></div>
<div class="ulist"><ul><li><p><code>repeat(int codePoint, int count)</code></p></li><li><p><code>repeat(CharSequence cs, int count)</code></p></li></ul></div></div></section><section id="_5"><h2>üí£üí•</h2><div class="slide-content"><div class="paragraph"><p>On <code>Character</code> (all <code>static</code>):</p></div>
<div class="ulist"><ul><li><p><code>isEmoji(int codePoint)</code></p></li><li><p><code>isEmojiPresentation(int codePoint)</code></p></li><li><p><code>isEmojiModifier(int codePoint)</code></p></li><li><p><code>isEmojiModifierBase(int codePoint)</code></p></li><li><p><code>isEmojiComponent(int codePoint)</code></p></li></ul></div></div></section><section id="_localizing_datetimes"><h2>Localizing DateTimes</h2><div class="slide-content"><div class="paragraph"><p>Options for formatting dates/times with <code>DateTimeFormatter</code>:</p></div>
<div class="ulist"><ul><li><p>with a fixed pattern: <code>ofPattern</code></p></li><li><p>with a localized style: <code>ofLocalizedDate</code><br>
(<code>FULL</code>, <code>LONG</code>, <code>MEDIUM</code>, <code>SHORT</code>)</p></li></ul></div>
<div class="paragraph"><p>What about a localized result with custom elements?</p></div>
<div class="paragraph"><p>‚áù <code>DateTimeFormatter.ofLocalizedPattern</code></p></div></div></section><section id="_localized_patterns"><h2>Localized patterns</h2><div class="slide-content"><div class="paragraph"><p><code>DateTimeFormatter.ofLocalizedPattern</code>:</p></div>
<div class="ulist"><ul><li><p>you include what you want to show up<br>
(e.g. year + month with <code>"yMM"</code>)</p></li><li><p>result will depend on locale<br>
(e.g. <code>"10/2023"</code> in USA)</p></li></ul></div></div></section><section id="_pattern_comparison"><h2>Pattern comparison:</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">var now = ZonedDateTime.now();
for (var locale : List.of(
		Locale.of("en", "US"),
		Locale.of("be", "BE"),
		Locale.of("vi", "VN"))) {
	Locale.setDefault(locale);

	var custom = DateTimeFormatter
		.ofPattern("y-MM-dd");
	var local = DateTimeFormatter
		.ofLocalizedDate(FormatStyle.SHORT);
	var customLocal = DateTimeFormatter
		.ofLocalizedPattern("yMM");

	// pretty print
}</code></pre></div></div></div></section><section id="_pattern_comparison_2"><h2>Pattern comparison</h2><div class="slide-content"><table class="tableblock frame-all grid-all" style="width:100%"><colgroup><col style="width:15.7894%"><col style="width:26.3157%"><col style="width:26.3157%"><col style="width:31.5792%"></colgroup><thead><tr><th class="tableblock halign-left valign-top">locale</th><th class="tableblock halign-left valign-top">custom</th><th class="tableblock halign-left valign-top">local</th><th class="tableblock halign-left valign-top">both</th></tr><tbody><tr><td class="tableblock halign-left valign-top"><p class="tableblock">en_US</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>2023-10-02</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>10/2/23</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>10/2023</code></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">be_BE</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>2023-10-02</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>2.10.23</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>10.2023</code></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">vi_VN</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>2023-10-02</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>02/10/2023</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>th√°ng 10, 2023</code></p></td></tr></table></div></section><section id="_localized_patterns_2"><h2>Localized patterns</h2><div class="slide-content"><div class="paragraph"><p>Analogue methods were added to <code>DateTimeFormatterBuilder</code>:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">DateTimeFormatterBuilder appendLocalized(
	String requestedTemplate);

static String getLocalizedDateTimePattern(
	String requestedTemplate,
	Chronology chrono, Locale locale)</code></pre></div></div></div></section><section id="_more_autocloseable"><h2>More AutoCloseable</h2><div class="slide-content"><div class="paragraph"><p>These types now implemnet <code>AutoCloseable</code>:</p></div>
<div class="ulist"><ul><li><p><code>HttpClient</code></p></li><li><p><code>ExecutorService</code></p></li><li><p><code>ForkJoinPool</code></p></li></ul></div></div></section><section id="_a_better_future"><h2>A better future</h2><div class="slide-content"><div class="paragraph"><p>Additions to <code>Future&lt;T&gt;</code>:</p></div>
<div class="ulist"><ul><li><p><code>T resultNow()</code></p></li><li><p><code>Throwable exceptionNow</code></p></li><li><p><code>State state()</code></p></li></ul></div>
<div class="paragraph"><p>New:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">enum State {
	RUNNING, SUCCESS, FAILED, CANCELLED
}</code></pre></div></div></div></section><section id="_more_6"><h2>More</h2><div class="slide-content"><div class="paragraph"><p>There are many more additions like this.</p></div>
<div class="paragraph"><p>Find a few more in<br>
üé• <a href="https://www.youtube.com/watch?v=4mPd2eL0wYQ">Java 21 API New Features</a> (Sep 2023)</p></div></div></section></section>
<section><section id="_java_21_9"><h2>Java 21 üí£üí•</h2><div class="slide-content"><div class="paragraph"><p> <h3>Part II</h3> <table class="toc"> <tr><td>On-Ramp</td></tr> <tr><td>Sequenced Collections</td></tr> <tr><td>Misc. API Improvements</td></tr> <tr class="toc-current"><td>Generational ZGC</td></tr> <tr><td>Class-Data Sharing</td></tr> <tr><td>UTF-8 by Default</td></tr> </table> </p></div></div></section><section id="_generational_zgc"><h2>Generational ZGC</h2><div class="slide-content"><div class="paragraph"><p>Compared to other GCs, ZGC:</p></div>
<div class="ulist"><ul><li><p>optimizes for ultra-low pause times</p></li><li><p>can have higher memory footprint or higher CPU usage</p></li></ul></div>
<div class="paragraph"><p>In Java 21, ZGC becomes <em>generational</em>.</p></div></div></section><section id="_generational_hypothesis"><h2>Generational Hypothesis</h2><div class="slide-content"><div class="ulist"><ul><li><p>most objects die young</p></li><li><p>those who don&#8217;t, grow (very) old</p></li></ul></div>
<div class="paragraph"><p>GCs can make use of this by tracking<br>
<em>young</em> and <em>old generations</em>.</p></div>
<div class="paragraph"><p>ZGC didn&#8217;t do this, but can do it now with:<br>
<code>-XX:+UseZGC -XX:+ZGenerational</code></p></div></div></section><section id="_some_benchmarks"><h2>Some Benchmarks</h2><div class="slide-content"><div class="paragraph"><p>A Cassandra 4 benchmark of ZGC vs GenZGC showed:</p></div>
<div class="ulist"><ul><li><p>4x throughput with a fixed heap or</p></li><li><p>1/4x heap size with stable throughput</p></li></ul></div>
<div class="paragraph"><p>(Probably not representative but very promising.)</p></div></div></section><section id="_more_7"><h2>More</h2><div class="slide-content"><div class="ulist"><ul><li><p>üìù <a href="https://openjdk.org/jeps/439">JEP 439</a>: Generational ZGC</p></li><li><p>üé• <a href="https://www.youtube.com/watch?v=YyXjC68l8mw">Generational ZGC and Beyond</a> (Aug 2023)</p></li><li><p>üé• <a href="https://www.youtube.com/watch?v=U2Sx5lU0KM8">Java&#8217;s Highly Scalable Low-Latency GC: ZGC</a> (Mar 2023)</p></li></ul></div></div></section></section>
<section><section id="_java_21_10"><h2>Java 21 üí£üí•</h2><div class="slide-content"><div class="paragraph"><p> <h3>Part II</h3> <table class="toc"> <tr><td>On-Ramp</td></tr> <tr><td>Sequenced Collections</td></tr> <tr><td>Misc. API Improvements</td></tr> <tr><td>Generational ZGC</td></tr> <tr class="toc-current"><td>Class-Data Sharing</td></tr> <tr><td>UTF-8 by Default</td></tr> </table> </p></div></div></section><section id="_class_data_sharing"><h2>Class-Data Sharing</h2><div class="slide-content"><div class="paragraph"><p>Use CDS to shave off 10-25% of your boot times.</p></div>
<div class="paragraph"><p>Recent improvements:</p></div>
<div class="ulist"><ul><li><p>default CDS archives ‚ë´ (<a href="https://openjdk.org/jeps/341">JEP 341</a>)</p></li><li><p>dynamic CDS archives ‚ë¨ (<a href="https://openjdk.org/jeps/350">JEP 350</a>)</p></li><li><p>auto-generated CDS ‚ë≤ (<a href="https://bugs.openjdk.org/browse/JDK-8261455">JDK-8261455</a>)</p></li></ul></div>
<div class="paragraph"><p>And more to come from <a href="https://openjdk.org/projects/leyden">Project Leyden</a>.</p></div></div></section><section id="_more_8"><h2>More</h2><div class="slide-content"><div class="ulist"><ul><li><p>üé• <a href="https://www.youtube.com/watch?v=vvlQv1Dh-HU">Java&#8217;s Startup Booster: CDS</a></p></li></ul></div></div></section></section>
<section><section id="_java_21_11"><h2>Java 21 üí£üí•</h2><div class="slide-content"><div class="paragraph"><p> <h3>Part II</h3> <table class="toc"> <tr><td>On-Ramp</td></tr> <tr><td>Sequenced Collections</td></tr> <tr><td>Misc. API Improvements</td></tr> <tr><td>Generational ZGC</td></tr> <tr><td>Class-Data Sharing</td></tr> <tr class="toc-current"><td>UTF-8 by Default</td></tr> </table> </p></div></div></section><section id="_utf_8_by_default"><h2>UTF-8 by Default</h2><div class="slide-content"><div class="paragraph"><p><em>[Since Java 18&#8201;&#8212;&#8201;<a href="https://openjdk.org/jeps/400">JEP 400</a>]</em></p></div>
<div class="paragraph"><p>All Java APIs use UTF-8 as default charset.</p></div>
<div class="paragraph"><p>This change concerns projects that:</p></div>
<div class="ulist"><ul><li><p>run on Windows</p></li><li><p>use non UTF-8 encoded files</p></li><li><p>do not pass a charset to APIs</p></li></ul></div>
<div class="paragraph"><p>In that case, you need to update code!</p></div></div></section><section id="_more_9"><h2>More</h2><div class="slide-content"><div class="ulist"><ul><li><p>üìù <a href="https://openjdk.org/jeps/400">JEP 400</a></p></li><li><p>üé• <a href="https://www.youtube.com/watch?v=5jIkRqBuSBs&amp;list=PLX8CzqL3ArzVHAHWowaXwYFlLk78D8RvL&amp;index=2&amp;t=625s">How to Upgrade to Java 21</a></p></li></ul></div></div></section></section>
<section><section id="_deprecations" data-background-image="../_images/surprise-237f802c.gif" data-background-size="cover"><h2>Deprecations</h2><div class="slide-content"></div></section><section id="_cleaning_house"><h2>Cleaning house</h2><div class="slide-content"><div class="paragraph"><p>Already removed:</p></div>
<div class="ulist"><ul><li><p>RMI activation ‚ë∞ (<a href="https://openjdk.org/jeps/407">JEP 407</a>)</p></li><li><p>Nashorn ‚ëÆ (<a href="https://openjdk.org/jeps/372">JEP 372</a>)</p></li><li><p>concurrent mark sweep GC ‚ë≠ (<a href="https://openjdk.org/jeps/363">JEP 363</a>)</p></li></ul></div></div></section><section id="_cleaning_house_2"><h2>Cleaning house</h2><div class="slide-content"><div class="paragraph"><p>Deprecations (for removal):</p></div>
<div class="ulist"><ul><li><p>allowed-by-default dynamic agents „âë (<a href="https://openjdk.org/jeps/451">JEP 451</a>)</p></li><li><p>Windows 32-bit x86 port „âë (<a href="https://openjdk.org/jeps/449">JEP 449</a>)</p></li><li><p>finalization ‚ë± (<a href="https://openjdk.org/jeps/421">JEP 421</a>)</p></li><li><p>security manager ‚ë∞ (<a href="https://openjdk.org/jeps/411">JEP 411</a>)</p></li><li><p>applet API ‚ë∞ (<a href="https://openjdk.org/jeps/398">JEP 398</a>)</p></li><li><p>primitive wrapper constructors ‚ëØ (<a href="https://openjdk.org/jeps/390">JEP 390</a>)</p></li><li><p>biased locking ‚ëÆ (<a href="https://openjdk.org/jeps/374">JEP 374</a>)</p></li></ul></div></div></section><section id="_agents"><h2>Agents</h2><div class="slide-content"><div class="paragraph"><p>What it is:</p></div>
<div class="ulist"><ul><li><p>a component that transforms byte code</p></li><li><p>uses <code>java.lang.instrument</code> or JVM TI</p></li><li><p>launches with JVM or attaches later ("dynamic")</p></li></ul></div></div></section><section id="_dynamic_agents"><h2>Dynamic agents</h2><div class="slide-content"><div class="paragraph"><p>What you need to know:</p></div>
<div class="ulist"><ul><li><p>all mechanisms for agents remain intact</p></li><li><p>nothing changed yet</p></li><li><p>in the future, dynamic attach will be<br>
disabled by default</p></li><li><p>enable with <code>-XX:+EnableDynamicAgentLoading</code></p></li></ul></div></div></section><section id="_dynamic_agents_2"><h2>Dynamic agents</h2><div class="slide-content"><div class="paragraph"><p>What you need to do:</p></div>
<div class="ulist"><ul><li><p>run your app with <code>-XX:-EnableDynamicAgentLoading</code></p></li><li><p>observe closely</p></li><li><p>investigate necessity of dynamic agents</p></li></ul></div></div></section><section id="_finalization"><h2>Finalization</h2><div class="slide-content"><div class="paragraph"><p>What it is:</p></div>
<div class="ulist"><ul><li><p><code>finalize()</code> methods</p></li><li><p>a JLS/GC machinery for them</p></li></ul></div></div></section><section id="_finalization_2"><h2>Finalization</h2><div class="slide-content"><div class="paragraph"><p>What you need to know:</p></div>
<div class="ulist"><ul><li><p>you can disable with <code>--finalization=disabled</code></p></li><li><p>in a future release, <code>disabled</code> will be the default</p></li><li><p>in a later release, finalization will be removed</p></li></ul></div></div></section><section id="_finalization_3"><h2>Finalization</h2><div class="slide-content"><div class="paragraph"><p>What you need to do:</p></div>
<div class="ulist"><ul><li><p>search for <code>finalize()</code> in your code and<br>
replace with <code>try</code>-with-resources or <code>Cleaner</code> API</p></li><li><p>search for <code>finalize()</code> in your dependencies and<br>
help remove them</p></li><li><p>run your app with <code>--finalization=disabled</code> and<br>
closely monitor resource behavior (e.g. file handles)</p></li></ul></div></div></section><section id="_security_manager"><h2>Security Manager</h2><div class="slide-content"><div class="paragraph"><p>What it is:</p></div>
<div class="ulist"><ul><li><p>a system of checks and permissions</p></li><li><p>intended to safeguard security-relevant<br>
code sections</p></li><li><p>embodied by <code>SecurityManager</code></p></li></ul></div></div></section><section id="_security_manager_2"><h2>Security Manager</h2><div class="slide-content"><div class="paragraph"><p>What you need to know:</p></div>
<div class="ulist"><ul><li><p>barely used but maintenance-intensive</p></li><li><p>already disallowed by default</p></li><li><p>enable with <code>java.security.manager=allow</code></p></li><li><p>in a future release, it will be removed</p></li></ul></div></div></section><section id="_security_manager_3"><h2>Security Manager</h2><div class="slide-content"><div class="paragraph"><p>What you need to do:</p></div>
<div class="ulist"><ul><li><p>observe your app with default settings<br>
(‚áù security manager disallowed)</p></li><li><p>if used, move away from security manager</p></li></ul></div></div></section><section id="_primitive_constructors"><h2>Primitive constructors</h2><div class="slide-content"><div class="paragraph"><p>What it is:</p></div>
<div class="ulist"><ul><li><p><code>new Integer(42)</code></p></li><li><p><code>new Double(42)</code></p></li><li><p>etc.</p></li></ul></div></div></section><section id="_primitive_constructors_2"><h2>Primitive constructors</h2><div class="slide-content"><div class="paragraph"><p>What you need to know:</p></div>
<div class="ulist"><ul><li><p>Valhalla wants to turn them into value types</p></li><li><p>those have no identity</p></li><li><p>identity-based operations need to be removed</p></li></ul></div></div></section><section id="_primitive_constructors_3"><h2>Primitive constructors</h2><div class="slide-content"><div class="paragraph"><p>What you need to do:</p></div>
<div class="ulist"><ul><li><p><code>Integer.valueOf(42)</code></p></li><li><p><code>Double.valueOf(42)</code></p></li><li><p>etc.</p></li></ul></div></div></section><section id="_more_10"><h2>More</h2><div class="slide-content"><div class="ulist"><ul><li><p>üìù all the aforementioned JEPs</p></li><li><p>üé• <a href="https://www.youtube.com/watch?v=3HnH6G_zcP0">Future Java - Prepare Your Codebase Now!</a></p></li><li><p>üé• <a href="https://www.youtube.com/watch?v=5jIkRqBuSBs">How to Upgrade to Java 21</a></p></li></ul></div></div></section></section>
<section id="_break_2"><h2>Break</h2><div class="slide-content"><div class="paragraph"><p>We&#8217;ll see you back here in 15 minutes with <strong>Part III</strong>:</p></div>
<div class="ulist"><ul><li><p>Source and Classfile Tools</p></li><li><p>Development and Deployment Tools</p></li><li><p>Security Tools</p></li><li><p>Monitoring Tools</p></li></ul></div></div></section>
<section><section id="_java_21_12"><h2>Java 21 üí£üí•</h2><div class="slide-content"><div class="paragraph"><p> <table class="toc"> <tr class="toc-current"><td>Source and Classfile Tools</td></tr> <tr><td>Development and Deployment Tools</td></tr> <tr><td>Security Tools</td></tr> <tr><td>Monitoring Tools</td></tr> </table> </p></div></div></section><section id="_fundamental_tools_of_the_jdk"><h2>Fundamental tools of the JDK</h2><div class="slide-content"><div class="paragraph"><p>The tools you use to create and build Java programs.</p></div></div></section><section data-background-color="white" data-background-image="../_images/compile-launch-3c738c53.png" data-background-size="contain" data-state="empty"></section><section id="_standard_compiler_optimizations"><h2>Standard compiler optimizations</h2><div class="slide-content"><div class="ulist"><ul><li class="fragment"><p>Literal constants are folded.</p></li><li class="fragment"><p>String concatenation is folded.</p></li><li class="fragment"><p>Constant fields are inlined.</p></li><li class="fragment"><p>Dead code branches are eliminated.</p></li></ul></div>
<div class="paragraph fragment"><p>These do not require any flag and are part<br>
of the compiler specification before JDK 17.</p></div></div></section><section id="_string_concatenation_strategy"><h2>String concatenation strategy</h2><div class="slide-content"><div class="paragraph"><p>Before JDK 19</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">public class Example {
    public static void main(String[] args) {
        StringBuilder sb = new StringBuilder("foo");
        System.err.println("" + sb + sb.append("bar"));
    }
}</code></pre></div></div>
<div class="listingblock fragment"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">// prints foobarfoobar</code></pre></div></div></div></section><section id="_string_concatenation_strategy_2"><h2>String concatenation strategy</h2><div class="slide-content"><div class="paragraph"><p>After JDK 19, string concatenation evaluates each argument and eagerly converts it to a string, in left-to-right order.</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">public class Example {
    public static void main(String[] args) {
        StringBuilder sb = new StringBuilder("foo");
        System.err.println("" + sb + sb.append("bar"));
    }
}</code></pre></div></div>
<div class="listingblock fragment"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">// prints foofoobar</code></pre></div></div>
<div class="paragraph fragment"><p><em>[Indy String Concat Changes Order of Operations&#8201;&#8212;&#8201;<a href="https://bugs.openjdk.org/browse/JDK-8273914">JDK-8273914</a>]</em></p></div></div></section><section id="_warnings_on_lossy_conversions"><h2>Warnings on lossy conversions</h2><div class="slide-content"><div class="paragraph"><p>Evaluation error when compiling:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">public class Example {
    public static void main(String[] args) {
        long value = 5L;
		long b = value + 0.1 * 3L;
    }
}</code></pre></div></div>
<div class="listingblock fragment"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">// incompatible types: possible lossy conversion
// from double to long</code></pre></div></div></div></section><section id="_warnings_on_lossy_conversions_2"><h2>Warnings on lossy conversions</h2><div class="slide-content"><div class="paragraph"><p>Before JDK 20, no error is produced when compiling:</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">public class Example {
    public static void main(String[] args) {
        long b = 5L;
		long b += 0.1 * 3L;
    }
}</code></pre></div></div>
<aside class="notes"><div class="ulist"><ul><li><p>But when the same computation is done with an "+=" operator (or also with similar operators, like "-="), then this error does not occur.</p></li></ul></div></aside></div></section><section id="_warnings_on_lossy_conversions_3"><h2>Warnings on lossy conversions</h2><div class="slide-content"><div class="paragraph"><p>After JDK 20, get a warning when compiling:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code>javac Example.java -Xlint:all

Example.java:4: warning:
[lossy-conversions] implicit cast from double
to long in compound assignment is possibly lossy
     b += 0.1 * 3L;
               ^
 1 warning</code></pre></div></div>
<div class="paragraph fragment"><p><em>[Warn compound assignment is possibly lossy &#8201;&#8212;&#8201;<a href="https://bugs.openjdk.org/browse/JDK-8244681">JDK-8244681</a>]</em></p></div>
<aside class="notes"><div class="ulist"><ul><li><p>As of JDK 20, running <code>javac</code> with option <code>all</code> to enable all the warnings, flags such situations with a warning about type casts in compound assignments with possible lossy conversions</p></li></ul></div></aside></div></section><section id="_warnings_about_possible_this_escapes"><h2>Warnings about possible this escapes</h2><div class="slide-content"><div class="paragraph"><p><strong>DO NOT call overridable methods from a constructor!</strong></p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">public class LintExample {
	public LintExample() {
		System.out.println(this.hashCode());
	}

	public static void main(String[] args) {
		new LintExample();
	}
}</code></pre></div></div></div></section><section id="_warnings_about_possible_this_escapes_2"><h2>Warnings about possible this escapes</h2><div class="slide-content"><div class="paragraph"><p>Before JDK 21,  <code>LintExample.java</code> compiles successfully</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">javac LintExample.java -Xlint:all</code></pre></div></div></div></section><section id="_warnings_about_possible_this_escapes_3"><h2>Warnings about possible this escapes</h2><div class="slide-content"><div class="paragraph"><p>After JDK 21,  the compiler has a new <code>-Xlint:this-escape</code> key:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code>javac LintExample.java -Xlint:[all|this-escape]

LintExample.java 3: warning:
[this-escape] possible 'this' escape before subclass
is fully initialized
    System.out.println(this.hashCode());                                      									^
 1 warning</code></pre></div></div>
<div class="paragraph fragment"><p><em>[New lint check key &#8201;&#8212;&#8201;<a href="https://bugs.openjdk.org/browse/JDK-8015831">JDK-8015831</a>]</em></p></div></div></section><section id="_generate_great_api_documentation" data-background-image="../_images/manual-eed23e21.png" data-background-size="cover"><h2>Generate great API documentation</h2></section><section id="_goals_for_api_documentation"><h2>Goals for API documentation</h2><div class="slide-content"><div class="ulist"><ul><li><p>Helps with product maintenance.</p></li><li><p>Technical users can understand your APIs goals.</p></li><li><p>Can increase awareness/adoption of your software.</p></li><li><p>Third-party developers get started quickly by trying out API examples.</p></li></ul></div></div></section><section id="_words_may_come_easy_yet_examples_require_extra_care"><h2>Words may come easy, yet examples require extra care.</h2></section><section id="_inserting_fragments_of_source_code_in_documentation"><h2>Inserting fragments of source code in documentation</h2><div class="slide-content"><div class="ulist"><ul><li><p>Wrap code examples inside <code>&lt;pre&gt;</code> and <code>{@code &#8230;&#8203;}</code></p></li><li><p>Automatically escape special characters with <code>{@code &#8230;&#8203;}</code></p></li><li><p>Little control over indentation</p></li><li><p>No code highlighting</p></li></ul></div>
<aside class="notes"><div class="ulist"><ul><li><p>Prior to JDK 18, you could include formatted multiple line fragments of source code in documentation using <code>&lt;pre&gt;</code> and <code>{@code &#8230;&#8203;}</code>.</p></li></ul></div></aside></div></section><section data-background-color="white" data-background-image="../_images/pre-code-example-b435cdb9.png" data-background-size="contain" data-background-transition="none" data-state="empty"></section><section data-background-color="white" data-background-image="../_images/pre-code-example-outline-94af3d1b.png" data-background-size="contain" data-background-transition="none" data-state="empty"></section><section data-background-color="white" data-background-image="../_images/pre-code-javadoc-output-8df57846.png" data-background-size="contain" data-background-transition="none" data-state="empty"></section><section id="_simplify_inclusion_of_code_examples"><h2>Simplify inclusion of code examples</h2><div class="slide-content"><div class="ulist"><ul><li><p><a href="https://openjdk.org/jeps/413">JEP 413</a> introduced <code>{@snippet &#8230;&#8203;}</code> tag in JDK 18.</p></li><li><p>A better presentation of the code examples via regions.</p></li><li><p>Control code via <code>@highlight, @replace, @link</code> tags and regions.</p></li></ul></div></div></section><section data-background-color="white" data-background-image="../_images/snippet-example-outline-17bba021.png" data-background-size="contain" data-background-transition="none" data-state="empty"></section><section data-background-color="white" data-background-image="../_images/snippet-region-example-outline-8cf4c123.png" data-background-size="contain" data-background-transition="none" data-state="empty"></section><section data-background-color="white" data-background-image="../_images/snippet-javadoc-output-b1adcb96.png" data-background-size="contain" data-background-transition="none" data-state="empty"></section><section id="_simplify_inclusion_of_code_examples_2"><h2>Simplify inclusion of code examples</h2><div class="slide-content"><div class="ulist"><ul><li><p><a href="https://openjdk.org/jeps/413">JEP 413</a> introduced <code>{@snippet &#8230;&#8203;}</code> tag in JDK 18.</p></li><li><p>A better presentation of the code examples via regions.</p></li><li><p>Control code via <code>@highlight,@replace,@link</code> tags and regions.</p></li><li><p>The tag accepts separate files that hold snippet content.</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code>$ javadoc # other options..
    --snippet-path ./src/xml User.java</code></pre></div></div></div></section><section data-background-color="white" data-background-image="../_images/external-snippet-example-13e42cca.png" data-background-size="contain" data-background-transition="none" data-state="empty"></section><section data-background-color="white" data-background-image="../_images/external-snippet-example-outline-175ce784.png" data-background-size="contain" data-background-transition="none" data-state="empty"></section><section id="_benefit_of_interactive_documentation"><h2>Benefit of interactive documentation</h2><div class="slide-content"><div class="paragraph"><p>Configure the <code>--add-script &lt;file&gt;</code>  option of javadoc</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlight"><code>cat interact.js
alert("Get ready to move your fingers!");</code></pre></div></div>
<div class="listingblock fragment"><div class="content"><pre class="highlight"><code>javadoc -d docs # other options..........
	--add-script interact.js User.java</code></pre></div></div>
<div class="paragraph fragment"><p>Use the option to add multiple scripts in your generated documentation.</p></div>
<aside class="notes"><div class="ulist"><ul><li><p>When using <code>--add-script &lt;file&gt;</code> the specified file will be copied to the generated documentation
and a <code>&lt;script&gt;</code> element is added to every generated HTML page (except the pages that serve only to redirect to other pages).</p></li></ul></div></aside></div></section><section id="_more_11"><h2>More</h2><div class="slide-content"><div class="ulist"><ul><li><p><a href="https://dev.java/learn/jvm/tools/core/">Core JDK tools</a> tutorials</p></li><li><p><a href="https://bugs.openjdk.org/browse/JDK-8275786">JDK-8275786</a> about adding scripts to generated documentation</p></li><li><p><a href="https://openjdk.org/jeps/413">JEP 413</a> about code snippets in documentation</p></li><li><p><a href="https://docs.oracle.com/en/java/javase/21/javadoc/programmers-guide-snippets.html">Programmer&#8217;s Guide to Snippets</a></p></li></ul></div></div></section></section>
<section><section id="_java_21_13"><h2>Java 21 üí£üí•</h2><div class="slide-content"><div class="paragraph"><p> <table class="toc"> <tr><td>Source and Classfile Tools</td></tr> <tr class="toc-current"><td>Development and Deployment Tools</td></tr> <tr><td>Security Tools</td></tr> <tr><td>Monitoring Tools</td></tr> </table> </p></div></div></section><section id="_fast_prototyping_java_code_with_jshell"><h2>Fast prototyping Java code with jshell</h2><div class="slide-content"><div class="ulist"><ul><li class="fragment"><p>Quickly try, debug and learn Java and its APIs.</p></li><li class="fragment"><p>Experiment with Java by bypassing the compile stage.</p></li><li class="fragment"><p>Get immediate feedback on your code.</p></li><li class="fragment"><p>Exposes a programmatic API</p></li></ul></div>
<aside class="notes"><div class="ulist"><ul><li><p>You can enter program elements one at a time, immediately see the result, and make adjustments as needed.</p></li></ul></div></aside></div></section><section id="_highlighting_deprecated_elements_variables_and_keywords"><h2>Highlighting deprecated elements, variables and keywords</h2><div class="slide-content"><div class="listingblock fragment"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">jshell&gt; var check = new Boolean("true");
|  Warning:
|  Boolean(java.lang.String) in java.lang.Boolean
|  has been deprecated and marked for removal
|  var check = new Boolean("true");
|              ^-----------------^
check ==&gt; true</code></pre></div></div>
<div class="paragraph fragment"><p><em>[jshell outlines deprecated elements&#8201;&#8212;&#8201;<a href="https://bugs.openjdk.org/browse/JDK-8274148">JDK-8274148</a>]</em></p></div></div></section><section id="_jdk_tool_access_in_jshell"><h2>JDK tool access in jshell</h2><div class="slide-content"><div class="ulist"><ul><li class="fragment"><p><code>jshell</code> supports loading scripts.</p></li><li class="fragment"><p>Scripts can be local files or one of the predefined scripts.</p></li><li class="fragment"><p>Scripts may hold any valid code snippets or <code>jshell</code> commands.</p></li></ul></div></div></section><section id="_predefined_jshell_scripts"><h2>Predefined jshell scripts</h2><div class="slide-content"><table class="tableblock frame-all grid-all" style="width:100%"><colgroup><col style="width:25%"><col style="width:75%"></colgroup><thead><tr><th class="tableblock halign-left valign-top">Script</th><th class="tableblock halign-left valign-top">Description</th></tr><tbody><tr><th class="tableblock halign-left valign-top"><p class="tableblock header">DEFAULT</p></th><td class="tableblock halign-left valign-top"><p class="tableblock">Loads the default entries, which are commonly used as imports.</p></td></tr><tr><th class="tableblock halign-left valign-top"><p class="tableblock header">JAVASE</p></th><td class="tableblock halign-left valign-top"><p class="tableblock">Imports all Java SE packages.</p></td></tr><tr><th class="tableblock halign-left valign-top"><p class="tableblock header">PRINTING</p></th><td class="tableblock halign-left valign-top"><p class="tableblock">Defines <code>print,println,</code> and <code>printf</code> as <code>jshell</code> methods for use within the tool.</p></td></tr><tr><th class="tableblock halign-left valign-top"><p class="tableblock header">TOOLING</p></th><td class="tableblock halign-left valign-top"><p class="tableblock">Defines <code>javac, jar</code>, and other methods for running JDK tools within <code>jshell</code>.</p></td></tr></table>
<aside class="notes"><div class="ulist"><ul><li><p>The JShell tool for interactive exploration of Java code has been enhanced with a new predefined script, TOOLING.</p></li></ul></div></aside></div></section><section id="_loading_tooling_script"><h2>Loading TOOLING script</h2><div class="slide-content"><div class="ulist"><ul><li><p>When you start jshell</p></li></ul></div>
<div class="listingblock fragment"><div class="content"><pre class="highlight"><code>jshell TOOLING</code></pre></div></div>
<div class="ulist"><ul><li class="fragment"><p>Inside a <code>jshell</code> session</p></li></ul></div>
<div class="listingblock fragment"><div class="content"><pre class="highlight"><code>jshell&gt; /open TOOLING</code></pre></div></div>
<div class="paragraph fragment"><p><em>[JDK tools in jshell&#8201;&#8212;&#8201;<a href="https://bugs.openjdk.org/browse/JDK-8306560">JDK-8306560</a>]</em></p></div>
<aside class="notes"><div class="ulist"><ul><li><p>But when the same computation is done with an "+=" operator (or also with similar operators, like "-="), then this error does not occur.</p></li></ul></div></aside></div></section><section id="_using_the_tooling_script"><h2>Using the TOOLING script</h2><div class="slide-content"><div class="ulist"><ul><li class="fragment"><p>Check available tools</p><div class="listingblock"><div class="content"><pre class="highlight"><code>jshell&gt; tools()</code></pre></div></div></li><li class="fragment"><p>Execute a tool command in a <code>jshell</code> session</p><div class="listingblock"><div class="content"><pre class="highlight"><code>jshell&gt; run("javac", "-version")
jshell&gt; javac("-version")

javac 21</code></pre></div></div></li></ul></div></div></section><section id="_what_tool_would_you_use_for_local_prototyping_testing_or_debugging_a_client_server_setup"><h2>What tool would you use for local prototyping, testing or debugging a client-server setup?</h2><div class="slide-content"><div class="paragraph fragment"><p><em>[Introducing jwebserver&#8201;&#8212;&#8201;<a href="https://openjdk.org/jeps/408">JEP 408</a>]</em></p></div></div></section><section id="_use_cases_for_jwebserver"><h2>Use cases for jwebserver</h2><div class="slide-content"><div class="paragraph"><p>Web development testing, to simulate locally a client-server setup.</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code>jwebserver

Binding to loopback by default.
For all interfaces use "-b 0.0.0.0" or "-b ::".
Serving /cwd and subdirectories on 127.0.0.1 port 8000
URL: http://127.0.0.1:8000/</code></pre></div></div></div></section><section id="_use_cases_for_jwebserver_2"><h2>Use cases for jwebserver</h2><div class="slide-content"><div class="paragraph"><p>Web-service prototyping or application testing.</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code>jwebserver -d api -p 9000

Binding to loopback by default.
For all interfaces use "-b 0.0.0.0" or "-b ::".
Serving /api and subdirectories on 127.0.0.1 port 9000
URL http://127.0.0.1:9000/
127.0.0.1 - - [01/Feb/2024:14:27:26 +0100]
"GET /activity.json HTTP/1.1" 200 -</code></pre></div></div>
<aside class="notes"><div class="ulist"><ul><li><p>Web-service or application testing, where you use static files as API stubs in a directory structure to mirror RESTful URLs and contain dummy data.</p></li></ul></div></aside></div></section><section id="_use_cases_for_jwebserver_3"><h2>Use cases for jwebserver</h2><div class="slide-content"><div class="paragraph"><p>Search a directory on a remote server from your local machine.</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code>jwebserver -b 0.0.0.0

Serving /work and subdirectories
on 0.0.0.0 (all interfaces) port 8000
URL http://192.168.178.41:8000/</code></pre></div></div>
<aside class="notes"><div class="ulist"><ul><li><p>Informal browsing and sharing of files across systems to, e.g., search a directory on a remote server from your local machine.</p></li></ul></div></aside></div></section><section id="_working_with_the_simple_web_server_api"><h2>Working with the Simple Web Server API</h2><div class="slide-content"><div class="paragraph"><p>The <code>SimpleFileServer</code> class supports the creation of:</p></div>
<div class="ulist"><ul><li><p>file server</p></li><li><p>file handler</p></li><li><p>an output filter</p></li></ul></div>
<div class="paragraph fragment"><p><em>[Working with the Simple Web Server&#8201;&#8212;&#8201;<a href="https://inside.java/2021/12/06/working-with-the-simple-web-server">inside.java article</a>]</em></p></div>
<aside class="notes"><div class="ulist"><ul><li><p>While the command-line tool is useful, you can use the Simple Web Server (i.e., server, handler, and filter) with existing code via its API.</p></li></ul></div></aside></div></section><section id="_distributing_modular_applications"><h2>Distributing modular applications</h2><div class="slide-content"><div class="paragraph"><p>Let&#8217;s assume the following project structure:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code>src/main/java
‚îú‚îÄ‚îÄ module-info.java
    ‚îî‚îÄ‚îÄ example
        ‚îî‚îÄ‚îÄ HelloWorldFX.java

cat src/main/java/module-info.java
module hellofx {
	requires javafx.controls;
	requires jdk.httpserver;
	exports example;
}</code></pre></div></div>
<aside class="notes"><div class="ulist"><ul><li><p>Generate file with <code>.jmod</code> extension that encapsulate a set of compiled Java classes, resources and other related files.</p></li></ul></div></aside></div></section><section id="_make_performant_module_files"><h2>Make performant module files</h2><div class="slide-content"><div class="paragraph"><p><code>jmod</code> creates module files that encapsulate a set of<br>
compiled Java classes, resources and other related files.</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlight"><code>jmod create --class-path mods/helloworldfx \
    --main-class org.example.HelloWorldFX \
    --module-version 1.0.0 \
    --compress zip-9 hellofx.jmod</code></pre></div></div></div></section><section id="_specify_a_modules_compression_level"><h2>Specify a module&#8217;s compression level</h2><div class="slide-content"><div class="paragraph"><p>Use <code>--compress</code> command line option:</p></div>
<div class="ulist"><ul><li><p>accepts values between <code>zip-[0-9]</code></p></li><li><p><code>zip-0</code> provides no compression,</p></li><li><p><code>zip-9</code> provides the best compression</p></li><li><p>the default compression value is <code>zip-6</code></p></li></ul></div>
<div class="paragraph fragment"><p><em>[jmod --compress option&#8201;&#8212;&#8201;<a href="https://bugs.openjdk.org/browse/JDK-8293499">JDK-8293499</a>]</em></p></div></div></section><section id="_why_does_that_matter"><h2>Why does that matter?</h2><div class="slide-content"><div class="paragraph"><p>You can further create an optimal application image.</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlight"><code>jlink --launcher hello=hellofx/example.HelloWorldFX \
    --module-path $PATH_TO_JMODS:/hellofx.jmod \
    --add-modules hellofx \
    --output my-app</code></pre></div></div></div></section><section id="_packaging_java_applications" data-background-image="../_images/stun-021929fc.gif" data-background-size="cover"><h2>Packaging Java Applications</h2></section><section id="_intro_to_jpackage"><h2>Intro to jpackage</h2><div class="slide-content"><div class="ulist"><ul><li><p>Packages self-contained Java applications.</p></li><li><p>Prior JDK19, installing a jpackaged app was system-wide.</p></li><li><p>For modular applications, <code>jpackage</code> will automatically run <code>jlink</code> and generate a runtime with the modules needed.</p></li></ul></div>
<aside class="notes"><div class="ulist"><ul><li><p>Until JDK 19, installation of a jpackaged application was system-wide because startup parameters were stored in the system-wide installation location.</p></li></ul></div></aside></div></section><section id="_using_jpackage"><h2>Using jpackage</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlight"><code>jpackage --input target/ --name JDemoApp \
    --type app-image --main-jar JDemoApp.jar \
    --main-class JDemoApp</code></pre></div></div>
<div class="listingblock fragment"><div class="content"><pre class="highlight"><code>JDemoApp.app/
  Contents/
    Info.plist
    MacOS/               // Application launchers
      JDemoApp
    Resources/           // Icons, etc.
    app/
      JDemoApp.cfg     // Config info, done by jpackage
      JDemoApp.jar     // copied from --input directory
    runtime/           // Java runtime image</code></pre></div></div></div></section><section id="_installation_of_a_jpackaged_application_after_jdk_19"><h2>Installation of a jpackaged application after JDK 19</h2><div class="slide-content"><div class="paragraph"><p>Application launcher will search for <code>.cfg</code> in user-specific folders.</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-shell" data-lang="shell">Linux
    ~/.local/${PACKAGE_NAME}
    ~/.${PACKAGE_NAME}
macOS
    ~/Library/Application Support/${PACKAGE_NAME}
Windows
    %LocalAppData%\%PACKAGE_NAME%
    %AppData%\%PACKAGE_NAME%

# ${PACKAGE_NAME} and %PACKAGE_NAME%
# refer to jpackaged application name.</code></pre></div></div></div></section><section id="_installation_of_a_jpackaged_application_after_jdk_19_2"><h2>Installation of a jpackaged application after JDK 19</h2><div class="slide-content"><div class="paragraph"><p>Application launcher will look up the <code>.cfg</code> file:</p></div>
<div class="ulist"><ul><li class="fragment"><p>In user-specific directories,</p></li><li class="fragment"><p>From the installation directory if <code>.cfg</code> file is not found,</p></li><li class="fragment"><p>From the application image directory if the application launcher is executed from application image.</p></li></ul></div></div></section><section id="_more_12"><h2>More</h2><div class="slide-content"><div class="ulist"><ul><li><p>Build a Java source browser with <a href="https://inside.java/2022/11/21/jshell-java-source-browser/">jshell API</a></p></li><li><p>Christian Stein&#8217;s article on <a href="https://sormuras.github.io/blog/2023-03-09-jshell-tooling">jshell tooling</a></p></li><li><p>Tutorial on <a href="https://dev.java/learn/jvm/tool/jwebserver/">jwebserver</a></p></li><li><p>jwebserver „âë <a href="https://openjdk.org/jeps/408">JEP 408</a></p></li><li><p>Julia Boes' article on <a href="https://inside.java/2021/12/06/working-with-the-simple-web-server/">jwebserver API examples</a></p></li><li><p>Tutorial on <a href="https://dev.java/learn/jvm/tool/jpackage/">jpackage</a></p></li><li><p>How to package a JavaFX application with <a href="https://inside.java/2023/11/14/package-javafx-native-exec/">jpakckage</a></p></li></ul></div></div></section></section>
<section><section id="_java_21_14"><h2>Java 21 üí£üí•</h2><div class="slide-content"><div class="paragraph"><p> <table class="toc"> <tr><td>Source and Classfile Tools</td></tr> <tr><td>Development and Deployment Tools</td></tr> <tr class="toc-current"><td>Security Tools</td></tr> <tr><td>Monitoring Tools</td></tr> </table> </p></div></div></section><section id="_new_version_option"><h2>New version option</h2><div class="slide-content"><div class="paragraph"><p>Since JDK 18, you can check the version of <code>keytool</code> and  <code>jarsigner</code>.</p></div>
<div class="listingblock fragment"><div class="content"><pre class="highlight"><code>keytool -version &amp; jarsigner -version

[1] 83711
jarsigner 21
keytool 21</code></pre></div></div>
<div class="paragraph fragment"><p><em>[Add -version option to keytool and jarsigner&#8201;&#8212;&#8201;<a href="https://bugs.openjdk.org/browse/JDK-8272163">JDK-8272163</a>]</em></p></div></div></section><section id="_updated_options_for_keytool"><h2>Updated Options for keytool</h2><div class="slide-content"><div class="paragraph"><p>As of JDK 21, <code>keytool</code> warns you when using weak password-based encryption algorithms via:</p></div>
<div class="ulist"><ul><li><p><code>-genseckey</code> option</p></li><li><p><code>-importpass</code> option</p></li></ul></div>
<div class="paragraph fragment"><p><em>[keytool should warn about weak PBE algorithms-- <a href="https://bugs.openjdk.org/browse/JDK-8286907">JDK-8286907</a>]</em></p></div></div></section><section id="_detecting_weak_password_based_encryption_algorithms"><h2>Detecting weak password-based encryption algorithms</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlight"><code class="language-shell" data-lang="shell">keytool -genseckey -alias secret -keypass changeit \
    -keyalg RC4 -keysize 128 -keystore example.p12 \
    -storepass changeit -storetype PKCS12 -v</code></pre></div></div>
<div class="listingblock fragment"><div class="content"><pre class="highlight"><code>Generated 128-bit ARCFOUR secret key
[Storing example.p12]
Warning:
The generated secret key uses the ARCFOUR algorithm
which is considered a security risk.</code></pre></div></div>
<aside class="notes"><div class="ulist"><ul><li><p>This enhancement takes into account the value you specify in the <code>-keyalg</code> option and issues a warning in case you attempt to use weak algorithm.</p></li></ul></div></aside></div></section><section id="_updated_options_for_jarsigner"><h2>Updated Options for jarsigner</h2><div class="slide-content"><div class="ulist"><ul><li><p>Removed in JDK 21: <code>-altsigner</code> and <code>-altsignerpath</code></p></li><li><p>As of JDK 19, specify the classpath for providers<br>
via <code>‚ÄìproviderPath</code>.</p></li></ul></div>
<aside class="notes"><div class="ulist"><ul><li><p>The jarsigner options -altsigner and -altsignerpath have been removed, along with the underlying ContentSigner API in the com.sun.jarsigner package.
The mechanism was deprecated in JDK 9 and marked for removal in JDK 15.</p></li><li><p>If you need to specify the class path of an alternate keystore implementation, you can now add it via <code>-providerPath</code> option</p></li></ul></div></aside></div></section><section id="_loading_external_keystore_implementations"><h2>Loading external keystore implementations</h2><div class="slide-content"><div class="listingblock fragment"><div class="content"><pre class="highlight"><code>jarsigner -keystore keystore -storetype CUSTOMKS \
  -providerPath /path/to/test.myks \
  -providerClass my.custom.AnotherProvider \
  signed.jar mykey</code></pre></div></div>
<div class="paragraph fragment"><p><em>[Add -providerPath option to jarsigner&#8201;&#8212;&#8201;<a href="https://bugs.openjdk.org/browse/JDK-8281175">JDK-8281175</a>]</em></p></div></div></section><section id="_more_13"><h2>More</h2><div class="slide-content"><div class="ulist"><ul><li><p><a href="https://dev.java/learn/jvm/tool/security/">Security Tools</a> tutorials</p></li><li><p><a href="https://www.youtube.com/embed/nFJBVuaIsRg">Java 21 Tool enhancements</a> Better Across the Board</p></li><li><p><a href="https://dev.java/learn/security/monitor/">Monitoring Java Application Security with JDK tools and JFR Events</a></p></li></ul></div></div></section></section>
<section><section id="_java_21_15"><h2>Java 21 üí£üí•</h2><div class="slide-content"><div class="paragraph"><p> <table class="toc"> <tr><td>Source and Classfile Tools</td></tr> <tr><td>Development and Deployment Tools</td></tr> <tr><td>Security Tools</td></tr> <tr class="toc-current"><td>Monitoring Tools</td></tr> </table> </p></div></div></section><section id="_monitoring_java_applications"><h2>Monitoring Java applications</h2><div class="slide-content"><table class="tableblock frame-all grid-all" style="width:100%"><colgroup><col style="width:40%"><col style="width:60%"></colgroup><thead><tr><th class="tableblock halign-left valign-top">Technology</th><th class="tableblock halign-left valign-top">Goal</th></tr><tbody><tr><th class="tableblock halign-left valign-top"><p class="tableblock header">JDK Flight Recorder (JFR)</p></th><td class="tableblock halign-left valign-top"><p class="tableblock">Collects diagnostic and profiling data about a running Java application.</p></td></tr><tr><th class="tableblock halign-left valign-top"><p class="tableblock header">JFR Event Streaming API</p></th><td class="tableblock halign-left valign-top"><p class="tableblock">API for the continuous consumption of JFR data on disk.</p></td></tr><tr><th class="tableblock halign-left valign-top"><p class="tableblock header">JDK Mission Control (JMC)</p></th><td class="tableblock halign-left valign-top"><p class="tableblock">A set of tools for managing, monitoring, profiling, and troubleshooting Java applications.</p></td></tr></table>
<aside class="notes"><div class="ulist"><ul><li><p>JDK Mission Control (JMC) is a set of tools for continuously collecting low level and detailed Java runtime information.</p></li></ul></div></aside></div></section><section id="_new_jfr_view_command"><h2>New jfr view command</h2><div class="slide-content"><div class="ulist"><ul><li><p>Start JFR a recording via <code>-XX:StartFlightRecording</code> or <code>jcmd</code>.</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code>java -XX:StartFlightRecording -jar imaging.jar</code></pre></div></div>
<div class="ulist"><ul><li class="fragment"><p>Use the PID or jar name in the command</p></li></ul></div>
<div class="admonitionblock note fragment"><table><tr><td class="icon"><div class="title">Note</div></td><td class="content">Use <code>jps</code> JDK tool to list all running Java processes.</td></tr></table></div>
<div class="paragraph fragment"><p><em>[JFR view command&#8201;&#8212;&#8201;<a href="https://bugs.openjdk.org/browse/JDK-8306704">JDK-8306704</a>]</em></p></div></div></section><section data-background-color="white" data-background-image="../_images/hot-methods-cdc91f6e.png" data-background-size="contain" data-state="empty"></section><section data-background-color="white" data-background-image="../_images/allocation-class-75a86a45.png" data-background-size="contain" data-state="empty"></section><section id="_jdk_flight_recorder_event_for_finalization"><h2>JDK Flight Recorder event for finalization</h2><div class="slide-content"><div class="paragraph"><p><code>jdk.FinalizerStatistics</code></p></div>
<div class="ulist"><ul><li><p>Identifies classes at runtime that use finalizers.</p></li><li><p>Enabled by default in <code>default.jfc</code> and <code>profile.jfc</code>.</p></li><li><p>No event is sent if <code>java --finalization=disabled</code>.</p></li></ul></div>
<div class="paragraph fragment"><p><em>[A finalization JFR event&#8201;&#8212;&#8201;<a href="https://bugs.openjdk.org/browse/JDK-8266936">JDK-8266936</a>]</em></p></div></div></section><section id="_jdk_flight_recorder_event_for_finalization_2"><h2>JDK Flight Recorder event for finalization</h2><div class="slide-content"><div class="paragraph"><p>Disable via</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code>jfr configure jdk.FinalizerStatistics#enabled=false</code></pre></div></div>
<div class="listingblock fragment"><div class="content"><pre class="highlight"><code># or on launch
java -XX:StartFlightRecording:settings=none,
+jdk.FinalizerStatistics#enabled=false</code></pre></div></div>
<aside class="notes"><div class="ulist"><ul><li><p>A new JDK Flight Recorder Event, <code>jdk.FinalizerStatistics</code>, identifies classes at runtime that use finalizers. The event is enabled by default in the JDK (in the <code>default.jfc</code> and <code>profile.jfc</code> JFR configuration files). The event includes: the class that overrides <code>finalize()</code>, that class&#8217;s <code>CodeSource</code>, the number of times the class&#8217;s finalizer has run, and the number of objects still on the heap (not yet finalized)</p></li></ul></div></aside></div></section><section id="_recording_initial_security_properties_with_jfr"><h2>Recording initial security properties with JFR</h2><div class="slide-content"><div class="paragraph"><p><code>jdk.InitialSecurityProperty</code> cryptographic event</p></div>
<div class="ulist"><ul><li><p>Enabled by default in <code>default.jfc</code> and <code>profile.jfc</code>.</p></li><li><p>Captures details of initial security properties when loaded via the <code>java.security.Security</code> class.</p></li></ul></div>
<aside class="notes"><div class="ulist"><ul><li><p>Enabled by default, records details of initial security properties when loaded via the <code>java.security.Security</code> class.</p></li></ul></div></aside></div></section><section id="_recording_initial_security_properties_with_jfr_2"><h2>Recording initial security properties with JFR</h2><div class="slide-content"><div class="paragraph"><p>Disable via</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code>jfr configure jdk.InitialSecurityProperty#enabled=false</code></pre></div></div>
<div class="listingblock fragment"><div class="content"><pre class="highlight"><code># or on launch
java -XX:StartFlightRecording:settings=none,
+jdk.InitialSecurityProperty#enabled=false</code></pre></div></div></div></section><section id="_recording_details_about_security_provider_instance_requests"><h2>Recording details about security provider instance requests</h2><div class="slide-content"><div class="paragraph"><p><code>jdk.SecurityProviderService</code></p></div>
<div class="ulist"><ul><li><p>Disabled by default in <code>default.jfc</code> and <code>profile.jfc</code>.</p></li><li><p>Records details about <code>java.security.Provider.getService(String type, String algorithm)</code> calls.</p></li></ul></div></div></section><section id="_recording_details_about_security_provider_instance_requests_2"><h2>Recording details about security provider instance requests</h2><div class="slide-content"><div class="paragraph"><p>Enable via</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code>jfr configure jdk.SecurityProviderService#enabled=true</code></pre></div></div>
<div class="listingblock fragment"><div class="content"><pre class="highlight"><code># or on launch
java -XX:StartFlightRecording:settings=none,
+jdk.SecurityProviderService#enabled=true</code></pre></div></div></div></section><section id="_performance_analysis_and_monitoring"><h2>Performance analysis and monitoring</h2><div class="slide-content"><div class="ulist"><ul><li><p>Rendering large graphs is possible with smart pruning.</p></li><li><p>Aggregate Flame graph and Stack trace via <strong>Samples</strong>.</p></li><li><p>Dependency view presents aggregation of events using hierarchical edge bundling.</p></li></ul></div>
<aside class="notes"><div class="ulist"><ul><li><p>Rendering large graphs is also possible with smart pruning. You can focus on the most impactful nodes (nodes are data points, for example, method calls). And in the Max Nodes drop-down, select the target number of nodes; the visualization will render maximum of that many nodes.</p></li><li><p>Furthermore, you can aggregate the Flame graph and Stack trace by selecting the requiredattribute. In the Samples drop-down, select either Allocation Size, Sample Weight or TLAB Size.</p></li><li><p>The chord diagram show packages arranged radially around a circle, with arcs connecting the data points to indicate dependencies.</p></li></ul></div></aside></div></section><section data-background-color="white" data-background-image="../_images/smart-pruning-7b7d0a0e.png" data-background-size="contain" data-state="empty"></section><section data-background-color="white" data-background-image="../_images/aggregate-e9669866.png" data-background-size="contain" data-state="empty"></section><section data-background-color="white" data-background-image="../_images/chord-acf9ec7c.png" data-background-size="contain" data-state="empty"></section><section id="_more_14"><h2>More</h2><div class="slide-content"><div class="ulist"><ul><li><p><a href="https://dev.java/learn/jvm/jfr/">JDK Flight Recorder</a> tutorials</p></li><li><p><a href="https://inside.java/2023/05/14/stackwalker-02/">Stack Walker ep 2</a> on JFR</p></li><li><p><a href="https://inside.java/2023/06/04/sip079/">JDK Mission Control 8.3</a> Sip of Java</p></li><li><p><a href="https://inside.java/2023/11/27/sip090/">Finding CPU Load with JFR</a> Sip of Java</p></li></ul></div></div></section></section>
<section id="_high_quality_from_the_source" data-background-image="../_shared/../_images/question-mark-9644fc1f.jpg" data-background-size="cover"><h2>High quality from the source</h2><div class="slide-content">
<div style="display: flex; height: 100%;">
  <div style=" display: inline-block;text-align: center;">
        <img src="../_images/dev-java-239cde42.png">
        <figcaption>Dev.java</figcaption>
    </div>
  <div style=" display: inline-block;text-align: center;">
        <img src="../_images/inside-java-efb749e1.png">
        <figcaption>Inside.java</figcaption>
    </div>
  <div style=" display: inline-block;text-align: center;">
        <img src="../_images/youtube-java-b9d56abe.png">
        <figcaption>youtube.com/java</figcaption>
    </div>
</div></div></section>
<section id="_image_credits"><h2>Image Credits</h2><div class="slide-content"><div class="ulist"><ul><li><p><a href="https://unsplash.com/photos/NTYYL9Eb9y8">modern colors</a>:
<a href="https://unsplash.com/@pawel_czerwinski">Pawel Czerwinski</a>,
<a href="https://unsplash.com/license">Unsplash license</a></p></li><li><p><a href="https://www.flickr.com/photos/21496790@N06/5065834411">question-mark</a>:
<a href="http://milosevicmilos.com/">Milos Milosevic</a>,
<a href="https://creativecommons.org/licenses/by/2.0/">CC-BY 2.0</a></p></li><li><p>all other images are copyrighted</p></li></ul></div></div></section></div></div><script src="../_reveal.js/head/js/reveal.js"></script><script>Array.prototype.slice.call(document.querySelectorAll('.slides section')).forEach(function(slide) {
  if (slide.getAttribute('data-background-color')) return;
  // user needs to explicitly say he wants CSS color to override otherwise we might break custom css or theme (#226)
  if (!(slide.classList.contains('canvas') || slide.classList.contains('background'))) return;
  var bgColor = getComputedStyle(slide).backgroundColor;
  if (bgColor !== 'rgba(0, 0, 0, 0)' && bgColor !== 'transparent') {
    slide.setAttribute('data-background-color', bgColor);
    slide.style.backgroundColor = 'transparent';
  }
});

// More info about config & dependencies:
// - https://github.com/hakimel/reveal.js#configuration
// - https://github.com/hakimel/reveal.js#dependencies
Reveal.initialize({
  // Display presentation control arrows
  controls: false,
  // Help the user learn the controls by providing hints, for example by
  // bouncing the down arrow when they first encounter a vertical slide
  controlsTutorial: true,
  // Determines where controls appear, "edges" or "bottom-right"
  controlsLayout: 'bottom-right',
  // Visibility rule for backwards navigation arrows; "faded", "hidden"
  // or "visible"
  controlsBackArrows: 'faded',
  // Display a presentation progress bar
  progress: false,
  // Display the page number of the current slide
  slideNumber: false,
  // Control which views the slide number displays on
  showSlideNumber: 'all',
  // Add the current slide number to the URL hash so that reloading the
  // page/copying the URL will return you to the same slide
  hash: false,
  // Push each slide change to the browser history. Implies `hash: true`
  history: true,
  // Enable keyboard shortcuts for navigation
  keyboard: true,
  // Enable the slide overview mode
  overview: true,
  // Disables the default reveal.js slide layout so that you can use custom CSS layout
  disableLayout: false,
  // Vertical centering of slides
  center: true,
  // Enables touch navigation on devices with touch input
  touch: true,
  // Loop the presentation
  loop: false,
  // Change the presentation direction to be RTL
  rtl: false,
  // See https://github.com/hakimel/reveal.js/#navigation-mode
  navigationMode: 'default',
  // Randomizes the order of slides each time the presentation loads
  shuffle: false,
  // Turns fragments on and off globally
  fragments: true,
  // Flags whether to include the current fragment in the URL,
  // so that reloading brings you to the same fragment position
  fragmentInURL: false,
  // Flags if the presentation is running in an embedded mode,
  // i.e. contained within a limited portion of the screen
  embedded: false,
  // Flags if we should show a help overlay when the questionmark
  // key is pressed
  help: true,
  // Flags if speaker notes should be visible to all viewers
  showNotes: false,
  // Global override for autolaying embedded media (video/audio/iframe)
  // - null: Media will only autoplay if data-autoplay is present
  // - true: All media will autoplay, regardless of individual setting
  // - false: No media will autoplay, regardless of individual setting
  autoPlayMedia: null,
  // Global override for preloading lazy-loaded iframes
  // - null: Iframes with data-src AND data-preload will be loaded when within
  //   the viewDistance, iframes with only data-src will be loaded when visible
  // - true: All iframes with data-src will be loaded when within the viewDistance
  // - false: All iframes with data-src will be loaded only when visible
  preloadIframes: null,
  // Number of milliseconds between automatically proceeding to the
  // next slide, disabled when set to 0, this value can be overwritten
  // by using a data-autoslide attribute on your slides
  autoSlide: 0,
  // Stop auto-sliding after user input
  autoSlideStoppable: true,
  // Use this method for navigation when auto-sliding
  autoSlideMethod: Reveal.navigateNext,
  // Specify the average time in seconds that you think you will spend
  // presenting each slide. This is used to show a pacing timer in the
  // speaker view
  defaultTiming: 120,
  // Specify the total time in seconds that is available to
  // present.  If this is set to a nonzero value, the pacing
  // timer will work out the time available for each slide,
  // instead of using the defaultTiming value
  totalTime: 2700,
  // Specify the minimum amount of time you want to allot to
  // each slide, if using the totalTime calculation method.  If
  // the automated time allocation causes slide pacing to fall
  // below this threshold, then you will see an alert in the
  // speaker notes window
  minimumTimePerSlide: 0,
  // Enable slide navigation via mouse wheel
  mouseWheel: false,
  // Hide cursor if inactive
  hideInactiveCursor: true,
  // Time before the cursor is hidden (in ms)
  hideCursorTime: 5000,
  // Hides the address bar on mobile devices
  hideAddressBar: true,
  // Opens links in an iframe preview overlay
  // Add `data-preview-link` and `data-preview-link="false"` to customise each link
  // individually
  previewLinks: false,
  // Transition style (e.g., none, fade, slide, convex, concave, zoom)
  transition: 'fade',
  // Transition speed (e.g., default, fast, slow)
  transitionSpeed: 'default',
  // Transition style for full page slide backgrounds (e.g., none, fade, slide, convex, concave, zoom)
  backgroundTransition: 'fade',
  // Number of slides away from the current that are visible
  viewDistance: 3,
  // Number of slides away from the current that are visible on mobile
  // devices. It is advisable to set this to a lower number than
  // viewDistance in order to save resources.
  mobileViewDistance: 3,
  // Parallax background image (e.g., "'https://s3.amazonaws.com/hakim-static/reveal-js/reveal-parallax-1.jpg'")
  parallaxBackgroundImage: '../_images/modern-colors-7b910e27.jpg',
  // Parallax background size in CSS syntax (e.g., "2100px 900px")
  parallaxBackgroundSize: '4500px 3000px',
  // Number of pixels to move the parallax background per slide
  // - Calculated automatically unless specified
  // - Set to 0 to disable movement along an axis
  parallaxBackgroundHorizontal: null,
  parallaxBackgroundVertical: null,
  // The display mode that will be used to show slides
  display: 'block',

  // The "normal" size of the presentation, aspect ratio will be preserved
  // when the presentation is scaled to fit different resolutions. Can be
  // specified using percentage units.
  width: 960,
  height: 700,

  // Factor of the display size that should remain empty around the content
  margin: 0.1,

  // Bounds for smallest/largest possible scale to apply to content
  minScale: 0.2,
  maxScale: 1.5,

  // PDF Export Options
  // Put each fragment on a separate page
  pdfSeparateFragments: true,
  // For slides that do not fit on a page, max number of pages
  pdfMaxPagesPerSlide: 1,

  // Optional libraries used to extend on reveal.js
  dependencies: [
      { src: '../_reveal.js/head/plugin/zoom-js/zoom.js', async: true },
      { src: '../_reveal.js/head/plugin/notes/notes.js', async: true }
  ],

  

});</script><script>var dom = {};
dom.slides = document.querySelector('.reveal .slides');

function getRemainingHeight(element, slideElement, height) {
  height = height || 0;
  if (element) {
    var newHeight, oldHeight = element.style.height;
    // Change the .stretch element height to 0 in order find the height of all
    // the other elements
    element.style.height = '0px';
    // In Overview mode, the parent (.slide) height is set of 700px.
    // Restore it temporarily to its natural height.
    slideElement.style.height = 'auto';
    newHeight = height - slideElement.offsetHeight;
    // Restore the old height, just in case
    element.style.height = oldHeight + 'px';
    // Clear the parent (.slide) height. .removeProperty works in IE9+
    slideElement.style.removeProperty('height');
    return newHeight;
  }
  return height;
}

function layoutSlideContents(width, height) {
  // Handle sizing of elements with the 'stretch' class
  toArray(dom.slides.querySelectorAll('section .stretch')).forEach(function (element) {
    // Determine how much vertical space we can use
    var limit = 5; // hard limit
    var parent = element.parentNode;
    while (parent.nodeName !== 'SECTION' && limit > 0) {
      parent = parent.parentNode;
      limit--;
    }
    if (limit === 0) {
      // unable to find parent, aborting!
      return;
    }
    var remainingHeight = getRemainingHeight(element, parent, height);
    // Consider the aspect ratio of media elements
    if (/(img|video)/gi.test(element.nodeName)) {
      var nw = element.naturalWidth || element.videoWidth, nh = element.naturalHeight || element.videoHeight;
      var es = Math.min(width / nw, remainingHeight / nh);
      element.style.width = (nw * es) + 'px';
      element.style.height = (nh * es) + 'px';
    } else {
      element.style.width = width + 'px';
      element.style.height = remainingHeight + 'px';
    }
  });
}

function toArray(o) {
  return Array.prototype.slice.call(o);
}

Reveal.addEventListener('slidechanged', function () {
  layoutSlideContents(960, 700)
});
Reveal.addEventListener('ready', function () {
  layoutSlideContents(960, 700)
});
Reveal.addEventListener('resize', function () {
  layoutSlideContents(960, 700)
});</script></body></html>