<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui"><title>Java Next!</title><link rel="stylesheet" href="../_reveal.js/head/css/reset.css"><link rel="stylesheet" href="../_reveal.js/head/css/reveal.css"><link rel="stylesheet" href="../_reveal.js/head/css/theme/nipa-night.css" id="theme"><!--This CSS is generated by the Asciidoctor reveal.js converter to further integrate AsciiDoc's existing semantic with reveal.js--><style type="text/css">.reveal div.right {
  float: right
}

/* listing block */
.reveal .listingblock.stretch > .content {
  height: 100%
}

.reveal .listingblock.stretch > .content > pre {
  height: 100%
}

.reveal .listingblock.stretch > .content > pre > code {
  height: 100%;
  max-height: 100%
}

/* tables */
table {
  border-collapse: collapse;
  border-spacing: 0
}

table {
  margin-bottom: 1.25em;
  border: solid 1px #dedede
}

table thead tr th, table thead tr td, table tfoot tr th, table tfoot tr td {
  padding: .5em .625em .625em;
  font-size: inherit;
  text-align: left
}

table tr th, table tr td {
  padding: .5625em .625em;
  font-size: inherit
}

table thead tr th, table tfoot tr th, table tbody tr td, table tr td, table tfoot tr td {
  display: table-cell;
  line-height: 1.6
}

td.tableblock > .content {
  margin-bottom: 1.25em
}

td.tableblock > .content > :last-child {
  margin-bottom: -1.25em
}

table.tableblock, th.tableblock, td.tableblock {
  border: 0 solid #dedede
}

table.grid-all > thead > tr > .tableblock, table.grid-all > tbody > tr > .tableblock {
  border-width: 0 1px 1px 0
}

table.grid-all > tfoot > tr > .tableblock {
  border-width: 1px 1px 0 0
}

table.grid-cols > * > tr > .tableblock {
  border-width: 0 1px 0 0
}

table.grid-rows > thead > tr > .tableblock, table.grid-rows > tbody > tr > .tableblock {
  border-width: 0 0 1px
}

table.grid-rows > tfoot > tr > .tableblock {
  border-width: 1px 0 0
}

table.grid-all > * > tr > .tableblock:last-child, table.grid-cols > * > tr > .tableblock:last-child {
  border-right-width: 0
}

table.grid-all > tbody > tr:last-child > .tableblock, table.grid-all > thead:last-child > tr > .tableblock, table.grid-rows > tbody > tr:last-child > .tableblock, table.grid-rows > thead:last-child > tr > .tableblock {
  border-bottom-width: 0
}

table.frame-all {
  border-width: 1px
}

table.frame-sides {
  border-width: 0 1px
}

table.frame-topbot, table.frame-ends {
  border-width: 1px 0
}

.reveal table th.halign-left, .reveal table td.halign-left {
  text-align: left
}

.reveal table th.halign-right, .reveal table td.halign-right {
  text-align: right
}

.reveal table th.halign-center, .reveal table td.halign-center {
  text-align: center
}

.reveal table th.valign-top, .reveal table td.valign-top {
  vertical-align: top
}

.reveal table th.valign-bottom, .reveal table td.valign-bottom {
  vertical-align: bottom
}

.reveal table th.valign-middle, .reveal table td.valign-middle {
  vertical-align: middle
}

table thead th, table tfoot th {
  font-weight: bold
}

tbody tr th {
  display: table-cell;
  line-height: 1.6
}

tbody tr th, tbody tr th p, tfoot tr th, tfoot tr th p {
  font-weight: bold
}

thead {
  display: table-header-group
}

.reveal table.grid-none th, .reveal table.grid-none td {
  border-bottom: 0 !important
}

/* kbd macro */
kbd {
  font-family: "Droid Sans Mono", "DejaVu Sans Mono", monospace;
  display: inline-block;
  color: rgba(0, 0, 0, .8);
  font-size: .65em;
  line-height: 1.45;
  background: #f7f7f7;
  border: 1px solid #ccc;
  -webkit-border-radius: 3px;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 0 rgba(0, 0, 0, .2), 0 0 0 .1em white inset;
  box-shadow: 0 1px 0 rgba(0, 0, 0, .2), 0 0 0 .1em #fff inset;
  margin: 0 .15em;
  padding: .2em .5em;
  vertical-align: middle;
  position: relative;
  top: -.1em;
  white-space: nowrap
}

.keyseq kbd:first-child {
  margin-left: 0
}

.keyseq kbd:last-child {
  margin-right: 0
}

/* callouts */
.conum[data-value] {
  display: inline-block;
  color: #fff !important;
  background: rgba(0, 0, 0, .8);
  -webkit-border-radius: 50%;
  border-radius: 50%;
  text-align: center;
  font-size: .75em;
  width: 1.67em;
  height: 1.67em;
  line-height: 1.67em;
  font-family: "Open Sans", "DejaVu Sans", sans-serif;
  font-style: normal;
  font-weight: bold
}

.conum[data-value] * {
  color: #fff !important
}

.conum[data-value] + b {
  display: none
}

.conum[data-value]:after {
  content: attr(data-value)
}

pre .conum[data-value] {
  position: relative;
  top: -.125em
}

b.conum * {
  color: inherit !important
}

.conum:not([data-value]):empty {
  display: none
}

/* Callout list */
.hdlist > table, .colist > table {
  border: 0;
  background: none
}

.hdlist > table > tbody > tr, .colist > table > tbody > tr {
  background: none
}

td.hdlist1, td.hdlist2 {
  vertical-align: top;
  padding: 0 .625em
}

td.hdlist1 {
  font-weight: bold;
  padding-bottom: 1.25em
}

/* Disabled from Asciidoctor CSS because it caused callout list to go under the
 * source listing when .stretch is applied (see #335)
 * .literalblock+.colist,.listingblock+.colist{margin-top:-.5em} */
.colist td:not([class]):first-child {
  padding: .4em .75em 0;
  line-height: 1;
  vertical-align: top
}

.colist td:not([class]):first-child img {
  max-width: none
}

.colist td:not([class]):last-child {
  padding: .25em 0
}

/* Override Asciidoctor CSS that causes issues with reveal.js features */
.reveal .hljs table {
  border: 0
}

/* Callout list rows would have a bottom border with some reveal.js themes (see #335) */
.reveal .colist > table th, .reveal .colist > table td {
  border-bottom: 0
}

/* Fixes line height with Highlight.js source listing when linenums enabled (see #331) */
.reveal .hljs table thead tr th, .reveal .hljs table tfoot tr th, .reveal .hljs table tbody tr td, .reveal .hljs table tr td, .reveal .hljs table tfoot tr td {
  line-height: inherit
}

/* Columns layout */
.columns .slide-content {
  display: flex;
}

.columns.wrap .slide-content {
  flex-wrap: wrap;
}

.columns.is-vcentered .slide-content {
  align-items: center;
}

.columns .slide-content > .column {
  display: block;
  flex-basis: 0;
  flex-grow: 1;
  flex-shrink: 1;
}

.columns .slide-content > .column > * {
  padding: .75rem;
}

/* See #353 */
.columns.wrap .slide-content > .column {
  flex-basis: auto;
}

.columns .slide-content > .column.is-full {
  flex: none;
  width: 100%;
}

.columns .slide-content > .column.is-four-fifths {
  flex: none;
  width: 80%;
}

.columns .slide-content > .column.is-three-quarters {
  flex: none;
  width: 75%;
}

.columns .slide-content > .column.is-two-thirds {
  flex: none;
  width: 66.6666%;
}

.columns .slide-content > .column.is-three-fifths {
  flex: none;
  width: 60%;
}

.columns .slide-content > .column.is-half {
  flex: none;
  width: 50%;
}

.columns .slide-content > .column.is-two-fifths {
  flex: none;
  width: 40%;
}

.columns .slide-content > .column.is-one-third {
  flex: none;
  width: 33.3333%;
}

.columns .slide-content > .column.is-one-quarter {
  flex: none;
  width: 25%;
}

.columns .slide-content > .column.is-one-fifth {
  flex: none;
  width: 20%;
}

.columns .slide-content > .column.has-text-left {
  text-align: left;
}

.columns .slide-content > .column.has-text-justified {
  text-align: justify;
}

.columns .slide-content > .column.has-text-right {
  text-align: right;
}

.columns .slide-content > .column.has-text-left {
  text-align: left;
}

.columns .slide-content > .column.has-text-justified {
  text-align: justify;
}

.columns .slide-content > .column.has-text-right {
  text-align: right;
}

.text-left {
  text-align: left !important
}

.text-right {
  text-align: right !important
}

.text-center {
  text-align: center !important
}

.text-justify {
  text-align: justify !important
}

.footnotes {
  border-top: 1px solid rgba(0, 0, 0, 0.2);
  padding: 0.5em 0 0 0;
  font-size: 0.65em;
  margin-top: 4em;
}
</style><!--Printing and PDF exports--><script>var link = document.createElement( 'link' );
link.rel = 'stylesheet';
link.type = 'text/css';
link.href = window.location.search.match( /print-pdf/gi ) ? "../_reveal.js/head/css/print/pdf.css" : "../_reveal.js/head/css/print/paper.css";
document.getElementsByTagName( 'head' )[0].appendChild( link );</script><link href="../_reveal.js/head/lib/font/awesome/all.min.css" rel="stylesheet"></head><body><div class="reveal"><div class="slides"><section class="title" data-state="title"><h1>Java Next!</h1><div class="preamble"><link rel="stylesheet" href="../_highlight.js/head/styles/monokai-sublime.css">
<script src="../_highlight.js/head/highlight.pack.js"></script>
<script>
	window.onload = function() {
		hljs.configure({
			tabReplace: '    ',
			languages: [ 'java' ]
		})
		var codes = document.getElementsByTagName('code');
		for(var i = 0; i < codes.length; i++) {
			hljs.highlightBlock(codes.item(i));
		}
		hljs.initHighlightingOnLoad();
	}
</script>
<style>
.reveal .title h2 {
	font-size: 1.5em;
}
</style>
<h2>Amber to Valhalla, Loom to Leyden, Babylon to Panama</h2>
<div class="event">
	<div class="participant">
		<a href="https://nipafx.dev/nicolai-parlog" title="Nicolai"><img src="../_images/nipa-face-c9e3bd71.jpg" alt="Photo of Nicolai" class="logo"></a>
		<div class="name">
			<p><a href="https://nipafx.dev/nicolai-parlog" title="About Nicolai">Nicolai Parlog</a></p>
			<p><a href="https://nipafx.dev" title="Nicolai's website">nipafx.dev</a>
				/ <a href="https://twitter.com/nipafx" title="Nicolai on Twitter">@nipafx</a></p>
		</div>
	</div>
	<div class="participant">
		<a href="https://www.meetup.com/jforum-stockholm/" title="Jforum"><img src="../_images/logo-jforum-b1c6f227.jpg" alt="Logo of Jforum" class="logo" style="{host-logo-style}"></a>
		<div class="name">
			<p><a href="https://www.meetup.com/jforum-stockholm/" title="Jforum website">Jforum</a></p>
			<p><a href="https://x.com/hashtag/Jforum" title="Jforum on Twitter">#jforum</a></p>
		</div>
	</div>
	<div class="participant">
		<a href="https://www.oracle.com/java/" title="Java @ Oracle"><img src="../_images/logo-oracle-05a92737.png" alt="Oracle logo" class="logo"></a>
		<div class="name">
			<p>Developer Advocate</a></p>
			<p>Java Team at Oracle</p>
		</div>
	</div>
</div>
<footer>
	<div class="participant">
		<a href="https://nipafx.dev/nicolai-parlog" title="Nicolai"><img src="../_images/nipa-face-c9e3bd71.jpg" alt="Photo of Nicolai" class="logo"></a>
		<a href="https://www.oracle.com/java/"><img src="../_images/logo-oracle-05a92737.png" class="logo"></a>
		<div class="name"><p>
			<a href="https://nipafx.dev/nicolai-parlog" title="About Nicolai">Nicolai Parlog</a>
			/ <a href="https://nipafx.dev" title="Nicolai's website">nipafx.dev</a>
			/ <a href="https://twitter.com/nipafx" title="Nicolai on Twitter">@nipafx</a>
		</p></div>
	</div>
	<div class="participant">
		<a href="https://www.meetup.com/jforum-stockholm/" title="Jforum"><img src="../_images/logo-jforum-b1c6f227.jpg" alt="Logo of Jforum" class="logo" style="{host-logo-style}"></a>
		<div class="name"><p>
			<a href="https://www.meetup.com/jforum-stockholm/" title="Jforum website">Jforum</a>
			/ <a href="https://x.com/hashtag/Jforum" title="Jforum on Twitter">#jforum</a>
		</p></div>
	</div>
</footer>
<!-- Just adding a footer does not work because reveal.js puts it into the slides and we couldn't get it out via CSS. So we move it via JavaScript. -->
<script>
	document.addEventListener('DOMContentLoaded', function () {
		document.body.appendChild(document.querySelector('footer'));
	})
</script></div></section>
<section id="_lots_to_talk_about"><h2>Lots to talk about!</h2><div class="slide-content"><table class="toc">
	<tr><td>Project Panama</td></tr>
	<tr><td>Project Loom</td></tr>
	<tr><td>Project Leyden</td></tr>
	<tr><td>Project Valhalla</td></tr>
	<tr><td>Project Babylon</td></tr>
	<tr><td>Project Amber</td></tr>
</table>
<div class="paragraph"><p>Slides at <a href="https://slides.nipafx.dev/java-next">slides.nipafx.dev/java-next</a>.</p></div></div></section>
<section><section id="_project_panama" data-background-image="../_images/panama-canal-aaf5b191.jpg" data-background-size="cover"><h2>Project Panama</h2><div class="slide-content"><div class="quoteblock"><blockquote><div class="paragraph"><p>Interconnecting JVM and native code</p></div></blockquote></div><div class="paragraph"><p>Profile:</p></div><div class="ulist"><ul><li><p><a href="https://openjdk.org/projects/panama/">project</a> /
<a href="https://mail.openjdk.org/mailman/listinfo/panama-dev">mailing list</a></p></li><li><p>launched July 2014</p></li><li><p>led by Maurizio Cimadamore</p></li></ul></div></div></section><section id="_subprojects"><h2>Subprojects</h2><div class="slide-content"><div class="ulist"><ul><li><p>vector API</p></li><li><p>foreign memory API</p></li><li><p>foreign function API</p></li></ul></div></div></section><section id="_vectorization"><h2>Vectorization</h2><div class="slide-content"><div class="paragraph"><p>Given two <code>float</code> arrays <code>a</code> and <code>b</code>,<br>
compute <code>c = - (a² + b²)</code>:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">// a, b, c have same length
void compute(float[] a, float[] b, float[] c) {
	for (int i = 0; i &lt; a.length; i++) {
		// c = -(a² + b²)
		c[i] = (a[i] * a[i] + b[i] * b[i]) * -1.0f;
	}
}</code></pre></div></div></div></section><section id="_auto_vectorization"><h2>Auto-vectorization</h2><div class="slide-content"><div class="paragraph"><p>Vectorization - modern CPUs:</p></div>
<div class="ulist"><ul><li><p>have multi-word registers (e.g. 512 bit)</p></li><li><p>can store several numbers (e.g. 16 <code>float</code>​s)</p></li><li><p>can execute several computations at once</p></li></ul></div>
<div class="paragraph"><p>⇝ <em>single instruction, multiple data</em> (SIMD)</p></div>
<div class="paragraph"><p>Just-in-time compiler tries to vectorize loops.<br>
⇝ <em>Auto-vectorization</em></p></div>
<div class="paragraph"><p>Works but isn&#8217;t reliable.</p></div></div></section><section id="_vector_api"><h2>Vector API</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">static final VectorSpecies&lt;Float&gt; VS =
	FloatVector.SPECIES_PREFERRED;

// a, b, c length is multiple of vector length
void compute(float[] a, float[] b, float[] c) {
	int upperBound = VS.loopBound(a.length);
	for (int i = 0; i &lt; upperBound; i += VS.length()) {
		var va = FloatVector.fromArray(VS, a, i);
		var vb = FloatVector.fromArray(VS, b, i);
		// c = -(a² + b²)
		var vc = va.mul(va)
			.add(vb.mul(vb))
			.neg();
		vc.intoArray(c, i);
	}
}</code></pre></div></div></div></section><section id="_vector_api_2"><h2>Vector API</h2><div class="slide-content"><div class="paragraph"><p>Properties:</p></div>
<div class="ulist"><ul><li><p>clear and concise API (given the requirements)</p></li><li><p>platform agnostic</p></li><li><p>reliable run-time compilation and performance</p></li><li><p>graceful degradation</p></li></ul></div></div></section><section id="_foreign_memory"><h2>Foreign memory</h2><div class="slide-content"><div class="paragraph"><p>Storing data off-heap is tough:</p></div>
<div class="ulist"><ul><li><p><code>ByteBuffer</code> is limited (2GB) and inefficient</p></li><li><p><code>Unsafe</code> is&#8230;&#8203; unsafe and not supported</p></li></ul></div></div></section><section id="_foreign_memory_api"><h2>Foreign-memory API</h2><div class="slide-content"><div class="paragraph"><p>Safe and performant foreign-memory API:</p></div>
<div class="ulist"><ul><li><p>control (de)allocation:<br>
<code>Arena</code>, <code>MemorySegment</code>, <code>SegmentAllocator</code></p></li><li><p>to access/manipulate: <code>MemoryLayout</code>, <code>VarHandle</code></p></li></ul></div></div></section><section id="_foreign_functions"><h2>Foreign functions</h2><div class="slide-content"><div class="paragraph"><p>JNI isn&#8217;t ideal:</p></div>
<div class="ulist"><ul><li><p>involves several tedious artifacts (header file, impl, &#8230;&#8203;)</p></li><li><p>can only interoperate with languages that align<br>
with OS/architecture the JVM was built for</p></li><li><p>doesn&#8217;t reconcile Java/C type systems</p></li></ul></div></div></section><section id="_foreign_function_api"><h2>Foreign-function API</h2><div class="slide-content"><div class="paragraph"><p>Streamlined tooling/API for foreign functions<br>
based on method handles:</p></div>
<div class="ulist"><ul><li><p><code>jextract</code>: generates method handles from header file</p></li><li><p>classes to call foreign functions<br>
<code>Linker</code>, <code>FunctionDescriptor</code>, <code>SymbolLookup</code></p></li></ul></div></div></section><section id="_project_panama_2"><h2>Project Panama</h2><div class="slide-content"><div class="ulist"><ul><li><p>connects Java with the native world</p></li><li><p>offers safe, detailed, and performant APIs</p></li></ul></div></div></section><section id="_timeline"><h2>Timeline</h2><div class="slide-content"><div class="paragraph"><p>JDK 21:</p></div>
<div class="ulist"><ul><li><p>foreign APIs in 3rd preview (<a href="https://openjdk.org/jeps/442">JEP 442</a>)</p></li><li><p>vector API in 6th incubation (<a href="https://openjdk.org/jeps/448">JEP 448</a>)</p></li></ul></div>
<div class="paragraph"><p>JDK 22:</p></div>
<div class="ulist"><ul><li><p>foreign APIs finalize (<a href="https://openjdk.org/jeps/454">JEP 454</a>)</p></li></ul></div>
<div class="paragraph"><p>JDK 24:</p></div>
<div class="ulist"><ul><li><p>vector API in 9th incubation (<a href="https://openjdk.org/jeps/489">JEP 489</a>),<br>
still waiting for Valhalla&#8217;s value types</p></li></ul></div></div></section><section id="_timeline_2"><h2>Timeline</h2><div class="slide-content"><div class="paragraph"><p>Current work:</p></div>
<div class="ulist"><ul><li><p>improve memory access performance</p></li><li><p>reduce startup/warmup cost</p></li><li><p>refine record mappers</p></li><li><p>improve <code>jextract</code></p></li></ul></div></div></section><section id="_deeper_dives"><h2>Deeper Dives</h2><div class="slide-content"><div class="paragraph"><p>Vector API:</p></div>
<div class="ulist"><ul><li><p>📝 <a href="https://openjdk.org/jeps/489">JEP 489: Vector API (Ninth Incubator)</a></p></li><li><p>🎥 <a href="https://www.youtube.com/watch?v=42My8Yfzwbg">Fast Java Code with the Vector API</a> (Mar 2023)</p></li><li><p>🎥 <a href="https://www.youtube.com/watch?v=1JeoNr6-pZw&amp;list=PLX8CzqL3ArzWe2uQhE-TeAayRtjvBNyNn&amp;index=8">The Vector API in JDK 17</a> (Sep 2021)</p></li><li><p>📝 <a href="https://www.morling.dev/blog/fizzbuzz-simd-style/">FizzBuzz – SIMD Style!</a> (Mar 2021)</p></li></ul></div></div></section><section id="_deeper_dives_2"><h2>Deeper Dives</h2><div class="slide-content"><div class="paragraph"><p>Foreign APIs:</p></div>
<div class="ulist"><ul><li><p>📝 design documents</p><div class="ulist"><ul><li><p><a href="https://github.com/openjdk/panama-foreign/blob/foreign-jextract/doc/panama_memaccess.md">State of foreign memory support</a></p></li><li><p><a href="https://github.com/openjdk/panama-foreign/blob/foreign-jextract/doc/panama_ffi.md">State of foreign function support</a></p></li><li><p><a href="https://github.com/openjdk/panama-foreign/blob/foreign-jextract/doc/panama_jextract.md">Using the jextract tool</a></p></li></ul></div></li><li><p>🎥 <a href="https://www.youtube.com/watch?v=r4dNRVWYaZI">Panama Update with Maurizio Cimadamore</a> (Jul 2019)</p></li><li><p>🎥 <a href="https://archive.fosdem.org/2020/schedule/event/bytebuffers/">ByteBuffers are dead, long live ByteBuffers!</a> (Feb 2020)</p></li><li><p>🎥 <a href="https://www.youtube.com/watch?v=B8k9QGvPxC0">The State of Project Panama with Maurizio Cimadamore</a> (Jun 2021)</p></li></ul></div></div></section></section>
<section><section id="_project_loom" data-background-image="../_images/loom-1469faf8.jpg" data-background-size="cover"><h2>Project Loom</h2><div class="slide-content"><div class="quoteblock"><blockquote><div class="paragraph"><p>JVM features and APIs for supporting easy-to-use, high-throughput, lightweight concurrency and new programming models</p></div></blockquote></div><div class="paragraph"><p>Profile:</p></div><div class="ulist"><ul><li><p><a href="https://openjdk.org/projects/loom/">project</a> /
<a href="https://wiki.openjdk.org/display/loom/Main">wiki</a> /
<a href="http://mail.openjdk.org/mailman/listinfo/loom-dev">mailing list</a></p></li><li><p>launched January 2018</p></li><li><p>led by Ron Pressler</p></li></ul></div></div></section><section id="_motivation"><h2>Motivation</h2><div class="slide-content"><div class="paragraph"><p>An application with many blocking operations<br>
had two options:</p></div>
<div class="ulist"><ul><li><p>block platform (OS) threads until task completion:</p><div class="ulist"><ul><li><p>simple-to-use programming paradigm</p></li><li><p>can limit throughput</p></li></ul></div></li><li><p>use asnychronous programming</p><div class="ulist"><ul><li><p>harder to write and harder still to debug</p></li><li><p>allows higher throughput</p></li></ul></div></li></ul></div></div></section><section id="_motivation_2"><h2>Motivation</h2><div class="slide-content"><div class="paragraph"><p>Resolve the conflict between:</p></div>
<div class="ulist"><ul><li><p>simplicity</p></li><li><p>throughput</p></li></ul></div></div></section><section id="_enter_virtual_threads"><h2>Enter virtual threads!</h2><div class="slide-content"><div class="paragraph"><p>A <em>virtual</em> thread:</p></div>
<div class="ulist"><ul><li><p>is a regular <code>Thread</code></p></li><li><p>low memory footprint (stack + bytes)</p></li><li><p>small switching cost</p></li><li><p>scheduled by the Java runtime</p></li><li><p>executes on platform thread</p></li><li><p>waits in memory<br>
(no platform thread blocked)</p></li></ul></div></div></section><section id="_exceptions"><h2>Exceptions</h2><div class="slide-content"><div class="dlist"><dl><dt class="hdlist1">Pinning: </dt><dd><div class="ulist"><ul><li><p>a <em>pinned</em> VT will block the PT</p></li><li><p>caused by object monitors,<br>
native calls, class initialization</p></li></ul></div></dd><dt class="hdlist1">Capture: </dt><dd><div class="ulist"><ul><li><p>a <em>captured</em> VT blocks the PT</p></li><li><p>caused by file I/O</p></li></ul></div></dd></dl></div></div></section><section id="_object_monitor_pinning"><h2>Object monitor pinning</h2><div class="slide-content"><div class="paragraph"><p>Object monitor implementation:</p></div>
<div class="ulist"><ul><li><p>was bound to OS threads</p></li><li><p>required deep refactoring<br>
to work with VTs</p></li><li><p>fix ships with JDK 24</p></li></ul></div>
<div class="paragraph"><p>⇝ No more pinning for <code>synchronized</code>.</p></div></div></section><section id="_native_code_pinning"><h2>Native code pinning</h2><div class="slide-content"><div class="paragraph"><p>Cause:</p></div>
<div class="ulist"><ul><li><p>native code works on PT&#8217;s stack</p></li><li><p>switching PTs would wreak havoc</p></li></ul></div>
<div class="paragraph"><p>Fix:</p></div>
<div class="ulist"><ul><li><p>possible in the JVM, but expensive</p></li><li><p>fairly easy to avoid</p></li></ul></div>
<div class="paragraph"><p>⇝ Don&#8217;t call native code, then back to Java, then block.</p></div></div></section><section id="_file_io_capture"><h2>File I/O capture</h2><div class="slide-content"><div class="paragraph"><p>File I/O capture is caused by JVM/OS limitations.</p></div>
<div class="paragraph"><p>Linux <code>io_uring</code> allows async I/O but:</p></div>
<div class="ulist"><ul><li><p>adoption incurrs overhead</p></li><li><p>considerable compared to cached SSD-reads</p></li><li><p>cost/benefit is not good</p></li></ul></div>
<div class="paragraph"><p>⇝ No fix for now.</p></div></div></section><section id="_performance"><h2>Performance</h2><div class="slide-content"><div class="paragraph"><p>Virtual threads aren&#8217;t "faster threads":<br>
Each task takes the same time (same <em>latency</em>).</p></div>
<div class="paragraph"><p>Virtual threads increase <em>throughput</em>:</p></div>
<div class="ulist"><ul><li><p>when workload is not CPU-bound <em>and</em></p></li><li><p>when number of concurrent tasks is high</p></li></ul></div></div></section><section id="_use_cases"><h2>Use Cases</h2><div class="slide-content"><div class="paragraph"><p>Virtual threads are cheap and plentiful:</p></div>
<div class="ulist"><ul><li><p>no pooling necessary</p></li><li><p>allows thread per task</p></li><li><p>allows liberal creation<br>
of threads for subtasks</p></li></ul></div>
<div class="paragraph"><p>⇝ Enables new concurrency programming models.</p></div></div></section><section id="_structured_programming"><h2>Structured programming</h2><div class="slide-content"><div class="ulist"><ul><li><p>prescribes single entry point<br>
and clearly defined exit points</p></li><li><p>influenced languages and runtimes</p></li></ul></div></div></section><section id="_structured_concurrency"><h2>Structured concurrency</h2><div class="slide-content"><div class="quoteblock"><blockquote><div class="paragraph"><p>When the flow of execution splits into multiple concurrent flows, they rejoin in the same code block.</p></div></blockquote></div>
<div class="paragraph"><p>⇝ Threads are short-lived:</p></div>
<div class="ulist"><ul><li><p>start when task begins</p></li><li><p>end on completion</p></li></ul></div>
<div class="paragraph"><p>⇝ Enables parent-child/sibling relationships<br>
  and logical grouping of threads.</p></div></div></section><section id="_structured_concurrency_2"><h2>Structured concurrency</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">void handle(Request request, Response response)
		throws InterruptedException {
	// implicitly short-circuits on error
	try (var scope = StructuredTaskScope.open()) {
		var subtaskA = scope.fork(this::taskA);
		var subtaskB = scope.fork(this::taskB);
		// wait explicitly for success
		// (throws errors if there were any)
		scope.join();

		response.send(subtaskA.get() + subtaskB.get());
	} catch (ExecutionException ex) {
		response.fail(ex);
	}
}</code></pre></div></div></div></section><section id="_completion"><h2>Completion</h2><div class="slide-content"><div class="paragraph"><p>Use <code>Joiner</code> to configure completion:</p></div>
<div class="ulist"><ul><li><p>how are results collected?</p></li><li><p>when are subtasks cancelled?</p></li><li><p>when does <code>join</code> throw?</p></li></ul></div>
<div class="paragraph"><p>Pass to <code>StructuredTaskScope.open(Joiner)</code>.</p></div></div></section><section id="_joiners"><h2>Joiners</h2><div class="slide-content"><div class="paragraph"><p>Existing joiners for heterogeneous results:</p></div>
<div class="ulist"><ul><li><p><code>awaitAllSuccessfulOrThrow()</code>:</p><div class="ulist"><ul><li><p>cancels/throws on first error</p></li><li><p>default behavior of <code>open()</code></p></li></ul></div></li><li><p><code>awaitAll()</code>:</p><div class="ulist"><ul><li><p>never cancels/throws</p></li></ul></div></li></ul></div></div></section><section id="_joiners_2"><h2>Joiners</h2><div class="slide-content"><div class="paragraph"><p>Existing joiners for homogeneous results:</p></div>
<div class="ulist"><ul><li><p><code>allSuccessfulOrThrow()</code>:</p><div class="ulist"><ul><li><p>cancels/throws on first error</p></li><li><p>returns <code>Stream&lt;RESULT&gt;</code></p></li></ul></div></li><li><p><code>anySuccessfulResultOrThrow()</code></p><div class="ulist"><ul><li><p>cancels/throws if all fail</p></li><li><p>returns <code>RESULT</code></p></li></ul></div></li></ul></div></div></section><section id="_structured_concurrency_3"><h2>Structured concurrency</h2><div class="slide-content"><div class="ulist"><ul><li><p>forked tasks are children of the scope<br>
(visible in thread dumps)</p></li><li><p>creates relationship between threads</p></li><li><p>success/failure policy can be defined<br>
across all children</p></li></ul></div></div></section><section id="_sharing_data"><h2>Sharing data</h2><div class="slide-content"><div class="paragraph"><p>With <code>ThreadLocal</code>:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">static final ThreadLocal&lt;Principal&gt; PRINCIPAL =
	new ThreadLocal&lt;&gt;();

public void serve(Request request, Response response) {
	var level = request.isAdmin() ? ADMIN : GUEST;
	var principal = new Principal(level);
	PRINCIPAL.set(principal);
	Application.handle(request, response);
}

// elsewhere
PRINCIPAL.get()</code></pre></div></div></div></section><section id="_sharing_data_2"><h2>Sharing data</h2><div class="slide-content"><div class="paragraph"><p><code>ThreadLocal</code> downsides:</p></div>
<div class="ulist"><ul><li><p>unconstrained mutability</p></li><li><p>unbounded lifetime</p></li><li><p>expensive inheritance</p></li></ul></div>
<div class="paragraph"><p><code>ScopedValues</code> improve on that:</p></div>
<div class="ulist"><ul><li><p>write-once (per thread)</p></li><li><p>clearly scoped</p></li><li><p>free inheritance</p></li></ul></div></div></section><section id="_with_scoped_value"><h2>With scoped value</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">static final ScopedValue&lt;Principal&gt; PRINCIPAL =
	new ScopedValue&lt;&gt;();

public void serve(Request request, Response response) {
	var level = request.isAdmin() ? ADMIN : GUEST;
	var principal = new Principal(level);
	ScopedValue
		.where(PRINCIPAL, principal)
		.run(() -&gt; Application
			.handle(request, response));
}

// elsewhere
PRINCIPAL.get()</code></pre></div></div></div></section><section id="_project_loom_2"><h2>Project Loom</h2><div class="slide-content"><div class="paragraph"><p>Virtual threads:</p></div>
<div class="ulist"><ul><li><p>code is simple to write, debug, profile</p></li><li><p>allows high throughput</p></li></ul></div>
<div class="paragraph"><p>Structured concurrency:</p></div>
<div class="ulist"><ul><li><p>clearer concurrency code</p></li><li><p>simpler failure/success policies</p></li><li><p>better debugging</p></li></ul></div>
<div class="paragraph"><p>Scoped values:</p></div>
<div class="ulist"><ul><li><p>safer, more scalable data sharing</p></li></ul></div></div></section><section id="_timeline_3"><h2>Timeline</h2><div class="slide-content"><div class="paragraph"><p>JDK 21:</p></div>
<div class="ulist"><ul><li><p>virtual threads finalize (<a href="https://openjdk.org/jeps/444">JEP 444</a>)</p></li><li><p>structured concurrency previews (<a href="https://openjdk.org/jeps/453">JEP 453</a>)</p></li><li><p>scoped values preview (<a href="https://openjdk.org/jeps/446">JEP 446</a>)</p></li></ul></div>
<div class="paragraph"><p>JDK 24:</p></div>
<div class="ulist"><ul><li><p>object monitors no longer pin virtual threads (<a href="https://openjdk.org/jeps/491">JEP 491</a>)</p></li><li><p>structured concurrency in 4th preview (<a href="https://openjdk.org/jeps/499">JEP 499</a>)</p></li><li><p>scoped values in 4th preview (<a href="https://openjdk.org/jeps/446">JEP 487</a>)</p></li></ul></div></div></section><section id="_timeline_4"><h2>Timeline</h2><div class="slide-content"><div class="paragraph"><p>Current work:</p></div>
<div class="ulist"><ul><li><p>finalize structured concurrency and<br>
scoped values APIs</p></li><li><p>reduce pinning during class initialization</p></li><li><p>improve lock info in thread dumps</p></li></ul></div>
<div class="paragraph"><p>JDK 25:</p></div>
<div class="ulist"><ul><li><p>structured concurrency in 5th preview (<a href="https://openjdk.org/jeps/499">JEP 499</a>)</p></li><li><p>scoped values 🤷🏾‍♂️</p></li></ul></div></div></section><section id="_deeper_dives_3"><h2>Deeper Dives</h2><div class="slide-content"><div class="ulist"><ul><li><p>📝 <a href="https://inside.java/2021/11/30/on-parallelism-and-concurrency/">On Parallelism and Concurrency</a></p></li><li><p>📝 <a href="https://250bpm.com/blog:71/">Structured Concurrency</a></p></li><li><p>📝 <a href="https://vorpus.org/blog/notes-on-structured-concurrency-or-go-statement-considered-harmful/">Notes on structured concurrency [&#8230;&#8203;]</a></p></li><li><p>🎥 <a href="https://www.youtube.com/watch?v=fq0OEX0XYR8">Modern, Scalable Concurrency for the Java Platform</a><br>
(Sep 2021)</p></li><li><p>🎥 <a href="https://www.youtube.com/watch?v=KG24inClY2M">State of Project Loom with Ron Pressler</a> (Jun 2021)</p></li><li><p>🎥 <a href="https://www.youtube.com/watch?v=lKSSBvRDmTg">Java 19 Virtual Threads - JEP Café #11</a> (Jun 2022)</p></li></ul></div></div></section></section>
<section><section id="_project_leyden" data-background-image="../_images/leyden-7df7a40c.jpg" data-background-size="cover"><h2>Project Leyden</h2><div class="slide-content"><div class="quoteblock"><blockquote><div class="paragraph"><p>Faster startup, shorter time to peak performance, smaller footprint</p></div></blockquote></div><div class="paragraph"><p>Profile:</p></div><div class="ulist"><ul><li><p><a href="https://openjdk.org/projects/leyden/">project</a> /
<a href="https://mail.openjdk.org/mailman/listinfo/leyden-dev">mailing list</a> /
<a href="https://jdk.java.net/leyden">early access builds</a></p></li><li><p>launched May 2022</p></li><li><p>led by Mark Reinhold</p></li></ul></div></div></section><section id="_motivation_3"><h2>Motivation</h2><div class="slide-content"><div class="paragraph"><p>Java has really good peak performance,<br>
but also tends to have:</p></div>
<div class="ulist"><ul><li><p>slow startup time</p></li><li><p>slow warmup time</p></li><li><p>large footprint</p></li></ul></div>
<div class="paragraph"><p>For now, Leyden focusses on startup/warmup.</p></div></div></section><section id="_computation"><h2>Computation</h2><div class="slide-content"><div class="paragraph"><p>Two kinds of computation:</p></div>
<div class="ulist"><ul><li><p>expressed by the program</p></li><li><p>done on behalf of the program, e.g.:</p><div class="ulist"><ul><li><p>class-loading</p></li><li><p>JIT compilation</p></li><li><p>garbage collection</p></li></ul></div></li></ul></div>
<div class="paragraph"><p>For now, Leyden focusses in the latter.</p></div></div></section><section id="_startup_warmup"><h2>Startup &amp; Warmup</h2><div class="slide-content"><div class="paragraph"><p>Early computation on behalf of the program:</p></div>
<div class="ulist"><ul><li><p>class loading</p></li><li><p>callsite linkage</p></li><li><p>constant pool resolution</p></li><li><p>interpretation</p></li><li><p>profile gathering</p></li><li><p>JIT compilation (C1, C2)</p></li></ul></div></div></section><section id="_shifting_computation"><h2>Shifting Computation</h2><div class="slide-content"><div class="paragraph"><p>Java already shifts computation:</p></div>
<div class="ulist"><ul><li><p>compile-time constant folding</p></li><li><p>class loading</p></li><li><p>garbage collection</p></li><li><p>out-of-order execution</p></li></ul></div>
<div class="paragraph"><p>Let&#8217;s shift more computation ahead of time!</p></div>
<div class="paragraph fragment"><p>What computation?</p></div></div></section><section data-background-color="white" data-background-image="../_images/aot-all-the-things-f17e265e.jpg" data-background-size="contain" data-state="empty"></section><section id="_shifting_everything"><h2>Shifting Everything</h2><div class="slide-content"><div class="paragraph"><p>Shift <em>everything</em> ahead of time?</p></div>
<div class="ulist"><ul><li><p>class loading &amp; linking</p></li><li><p>JIT compilation</p></li><li><p>method profiling</p></li><li><p>lambda resolution</p></li><li><p>dead-code elimination</p></li><li><p>&#8230;&#8203;</p></li></ul></div>
<div class="paragraph"><p>But&#8230;&#8203;</p></div></div></section><section id="_dynamic_java"><h2>Dynamic Java</h2><div class="slide-content"><div class="paragraph"><p>Java is highly dynamic:</p></div>
<div class="ulist"><ul><li><p>class loading</p></li><li><p>class redefinition</p></li><li><p>linkage</p></li><li><p>access control</p></li><li><p>method dispatch</p></li><li><p>run-time typing (e.g. casting)</p></li><li><p>introspection</p></li><li><p>JIT compilation, decompilation</p></li></ul></div>
<div class="paragraph fragment"><p>How to AOT everything?</p></div></div></section><section data-background-image="../_images/crystal-ball-76a18290.jpg" data-background-size="cover" data-state="empty"></section><section data-background-image="../_images/training-run-a88dd162.jpg" data-background-size="cover" data-state="empty"></section><section id="_enter_aotcache"><h2>Enter AOTCache</h2><div class="slide-content"><div class="paragraph"><p>Leyden introduces <em>AOTCache</em>:</p></div>
<div class="ulist"><ul><li><p>observe JVM</p></li><li><p>capture decisions in AOTCache<br>
(expansion of <em>CDS Archive</em>)</p></li><li><p>use as "initial state" during future run</p></li><li><p>fall back to live observation/optimization<br>
if necessary and possible</p></li></ul></div></div></section><section id="_aot_workflow"><h2>AOT workflow</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlight"><code class="language-sh" data-lang="sh"># training run (⇝ profile)
$ java -XX:AOTMode=record
       -XX:AOTConfiguration=app.aotconf
       -cp app.jar com.example.App ...
# assembly phase (profile ⇝ AOTCache)
$ java -XX:AOTMode=create
       -XX:AOTConfiguration=app.aotconf
       -XX:AOTCache=app.aot
       -cp app.jar
# production run (AOTCache ⇝ performance)
$ java -XX:AOTCache=app.aot
       -cp app.jar com.example.App ...</code></pre></div></div>
<div class="paragraph"><p>(Open to improvements.)</p></div></div></section><section id="_aot_class_loading_linking"><h2>AOT class loading &amp; linking</h2><div class="slide-content"><div class="paragraph"><p>Introduced by <a href="https://openjdk.org/jeps/483">JEP 483</a>:</p></div>
<div class="quoteblock"><blockquote><div class="paragraph"><p>Improve startup time by making the classes of an application instantly available, in a loaded and linked state, when the HotSpot JVM starts.</p></div></blockquote></div>
<div class="paragraph"><p>Spring PetClinic benchmarks:</p></div>
<div class="ulist"><ul><li><p>up to ~40% startup time reduction</p></li><li><p>AOT cache size of ~130 MB</p></li></ul></div></div></section><section id="_aot_class_loading_linking_2"><h2>AOT class loading &amp; linking</h2><div class="slide-content"><div class="paragraph"><p>Limitation:</p></div>
<div class="ulist"><ul><li><p>same JDK release / hardware / OS</p></li><li><p>consistent class path for training and production</p></li><li><p>consistent module options</p></li><li><p>limited use of JVMTI agents</p></li></ul></div>
<div class="paragraph"><p>Otherwise, AOTCache is ignored.</p></div></div></section><section id="_aot_everything"><h2>AOT everything</h2><div class="slide-content"><div class="paragraph"><p>Leyden&#8217;s early access builds AOT more:</p></div>
<div class="ulist"><ul><li><p>method profiling</p></li><li><p>constant resolution</p></li><li><p>code compilation</p></li><li><p>dynamic proxies</p></li><li><p>reflection data</p></li><li><p>unfound classes</p></li></ul></div>
<div class="paragraph"><p>Benchmarks show ~70% startup time reduction.</p></div></div></section><section id="_beyond_fallback"><h2>Beyond Fallback</h2><div class="slide-content"><div class="paragraph"><p>Most cached data can be:</p></div>
<div class="ulist"><ul><li><p>validated at runtime</p></li><li><p>replaced with more accurate<br>
or better data (e.g. JIT code)</p></li></ul></div>
<div class="paragraph"><p>More optimizations are possible:</p></div>
<div class="ulist"><ul><li><p>if dynamism is constrained</p></li><li><p>if program is constrained</p></li></ul></div></div></section><section id="_constraining_dynamism"><h2>Constraining Dynamism</h2><div class="slide-content"><div class="paragraph"><p>Let developers accept constraints, e.g.:</p></div>
<div class="ulist"><ul><li><p>limited class redefinition</p></li><li><p>closed-world assumption</p></li><li><p>fixed program configuration</p></li></ul></div>
<div class="paragraph"><p>Let Java apply suitable optimizations.</p></div>
<div class="paragraph"><p>⇝ Performance is an emergent property.</p></div></div></section><section id="_project_leyden_2"><h2>Project Leyden</h2><div class="slide-content"><div class="ulist"><ul><li><p>improves Java&#8217;s overall footprint</p></li><li><p>for now: focusses on startup/warmup time<br>
by caching early JVM work</p></li><li><p>in the future: explores stricter constraints<br>
for more aggressive optimization</p></li></ul></div></div></section><section id="_timeline_5"><h2>Timeline</h2><div class="slide-content"><div class="paragraph"><p>JDK 24:</p></div>
<div class="ulist"><ul><li><p>AOT class loading &amp; linking (<a href="https://openjdk.org/jeps/483">JEP 483</a>)</p></li></ul></div>
<div class="paragraph"><p>Current work:</p></div>
<div class="ulist"><ul><li><p>AOT code compilation (<a href="https://openjdk.org/jeps/8335368">JEP draft</a>)</p></li><li><p>AOT method profiling (<a href="https://openjdk.org/jeps/8325147">JEP draft</a>)</p></li><li><p>work towards more limiting constraints</p></li></ul></div></div></section><section id="_deeper_dives_4"><h2>Deeper Dives</h2><div class="slide-content"><div class="ulist"><ul><li><p>📝 <a href="https://openjdk.org/projects/leyden/notes/02-shift-and-constrain">Selectively Shifting and Constraining Computation</a></p></li><li><p>📝 <a href="https://openjdk.org/projects/leyden/notes/05-training-runs">Thoughts on Training Runs</a></p></li><li><p>🎥 <a href="https://www.youtube.com/watch?v=z9XgILeSwzk">A Preview of What&#8217;s Coming in Project Leyden</a> (Oct 2024)</p></li><li><p>🎥 <a href="https://www.youtube.com/watch?v=NlJK5BKXtHI">Project Leyden: Capturing Lightning in a Bottle</a> (Feb 2024)</p></li><li><p>🎥 <a href="https://www.youtube.com/watch?v=OOPSU4LnKg0">Project Leyden Update #JVMLS</a> (August 2024)</p></li></ul></div></div></section></section>
<section><section id="_project_valhalla" data-background-image="../_images/valhalla-6417e07f.jpg" data-background-size="cover"><h2>Project Valhalla</h2><div class="slide-content"><div class="quoteblock"><blockquote><div class="paragraph"><p>Advanced Java VM and Language feature candidates</p></div></blockquote></div><div class="paragraph"><p>Profile:</p></div><div class="ulist"><ul><li><p><a href="https://openjdk.org/projects/valhalla/">project</a> /
<a href="https://wiki.openjdk.org/display/valhalla/Main">wiki</a> /
<a href="http://mail.openjdk.org/mailman/listinfo/valhalla-dev">mailing list</a> /
<a href="http://jdk.java.net/valhalla/">early access builds</a></p></li><li><p>launched July 2014</p></li><li><p>led by Brian Goetz</p></li></ul></div></div></section><section id="_motivation_4"><h2>Motivation</h2><div class="slide-content"><div class="paragraph"><p>Java has a split type system:</p></div>
<div class="ulist"><ul><li><p>primitives</p></li><li><p>classes</p></li></ul></div>
<div class="paragraph"><p>We can only create classes, but:</p></div>
<div class="ulist"><ul><li><p>have identity</p></li><li><p>have references</p></li></ul></div>
<aside class="notes"><div class="ulist"><ul><li><p>split caused by need for numerical performance</p></li><li><p>got worse with generics</p></li><li><p>got weird with (auto-)boxing</p></li><li><p>got worse again with lambdas/streams</p></li></ul></div></aside></div></section><section id="_identity"><h2>Identity</h2><div class="slide-content"><div class="paragraph"><p>All classes come with <em>identity</em>:</p></div>
<div class="ulist"><ul><li><p>extra memory for header</p></li><li><p>mutability</p></li><li><p>locking, synchronization, etc.</p></li></ul></div>
<div class="paragraph"><p>But not all custom types need that!</p></div></div></section><section id="_references"><h2>References</h2><div class="slide-content"><div class="paragraph"><p>All class instances come as <em>references</em>:</p></div>
<div class="ulist"><ul><li><p>memory access indirection</p></li><li><p>nullability</p></li></ul></div>
<div class="paragraph"><p>But not all custom types need that!</p></div></div></section><section id="_project_valhalla_2"><h2>Project Valhalla</h2><div class="slide-content"><div class="paragraph"><p>Valhalla&#8217;s goal is to unify the type system:</p></div>
<div class="ulist"><ul><li><p><em>value types</em> (disavow identity)</p></li><li><p><em>null-restriction</em> + <em>implicit constructors</em><br>
(disavow identity + references)</p></li><li><p><em>universal generics</em> (<code>ArrayList&lt;int&gt;</code>)</p></li><li><p><em>specialized generics</em> (backed by <code>int[]</code>)</p></li></ul></div></div></section><section id="_value_types"><h2>Value types</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">value class ComplexNumber {

	private double real;
	private double imaginary;

	// constructor, etc.
}</code></pre></div></div>
<div class="paragraph"><p>Codes (almost) like a class - exceptions:</p></div>
<div class="ulist"><ul><li><p>class and fields are implcitly final</p></li><li><p>superclasses are limited</p></li></ul></div>
<aside class="notes"><div class="ulist"><ul><li><p>can be records</p></li><li><p>fields, methods, constructors</p></li><li><p>use generics, implement interfaces</p></li><li><p>nested classes, class literals</p></li></ul></div></aside></div></section><section id="_value_type_behavior"><h2>Value type behavior</h2><div class="slide-content"><div class="paragraph"><p>No identity:</p></div>
<div class="ulist"><ul><li><p>some runtime operations throw exceptions</p></li><li><p>"identity" check <code>==</code> compares by state</p></li><li><p><code>null</code> is default value</p></li></ul></div>
<div class="paragraph"><p>Benefits:</p></div>
<div class="ulist"><ul><li><p>guaranteed immutability</p></li><li><p>more expressiveness</p></li><li><p>more optimizations</p></li></ul></div></div></section><section id="_migration_to_value_types"><h2>Migration to value types</h2><div class="slide-content"><div class="quoteblock"><blockquote><div class="paragraph"><p>The JDK (as well as other libraries) has many value-based classes, such as <code>Optional</code> and <code>LocalDateTime</code>. [&#8230;&#8203;]
We plan to migrate many value-based classes in the JDK to value classes.</p></div></blockquote></div></div></section><section id="_getting_rid_of_references"><h2>Getting rid of references</h2><div class="slide-content"><div class="paragraph"><p>In general, value types have references:</p></div>
<div class="ulist"><ul><li><p>allow <code>null</code></p></li><li><p>prevent flattening</p></li></ul></div>
<div class="paragraph"><p>How do we get rid of them?</p></div></div></section><section id="_null_restriction"><h2>Null-restriction</h2><div class="slide-content"><div class="paragraph"><p>Details are in flux, but possibly:</p></div>
<div class="ulist"><ul><li><p>null-restructed variables and fields:</p><div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">// number can't be null
ComplexNumber! number = // ...</code></pre></div></div></li><li><p>implicit constructor marks good <em>default instance</em></p></li></ul></div></div></section><section id="_implicit_constructors"><h2>Implicit constructors</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">value class ComplexNumber {

	private double real;
	private double imaginary;

	// implicitly sets all fields to default values
	public implicit ComplexNumber();

	public ComplexNumber(double r, double i) {
		// ...
	}

	// etc.

}</code></pre></div></div></div></section><section id="_no_references"><h2>No references</h2><div class="slide-content"><div class="paragraph"><p>The just-in-time compiler <em>can</em><br>
inline/flatten variables …</p></div>
<div class="ulist"><ul><li><p>of a value type</p></li><li><p>with implicit constructor</p></li><li><p>that are null-restricted</p></li></ul></div>
<div class="paragraph"><p>Performance comparable to today&#8217;s primitives! 🚀</p></div></div></section><section id="_emergent_performance"><h2>Emergent performance</h2><div class="slide-content"><div class="paragraph"><p>Don&#8217;t create a type <em>in order to</em> get performance.</p></div>
<div class="paragraph"><p>Instead:</p></div>
<div class="ulist"><ul><li><p>"Is the type value-ish?" ⇝ value type</p></li><li><p>"Is all-fields-default usable?" ⇝ implicit constructor</p></li><li><p>"Is no <code>null</code> needed?" ⇝ restrict nullness</p></li></ul></div>
<div class="paragraph"><p>Performance emerges from domain decisions!</p></div></div></section><section id="_universal_generics"><h2>Universal generics</h2><div class="slide-content"><div class="paragraph"><p>When everybody creates their own value classes,<br>
boxing becomes omni-present and very painful!</p></div>
<div class="paragraph"><p>Universal generics allow value classes<br>
as type parameters:</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">List&lt;long&gt; ids = new ArrayList&lt;&gt;();
List&lt;RationalNumber&gt; numbers = new ArrayList&lt;&gt;();</code></pre></div></div></div></section><section id="_specialized_generics"><h2>Specialized generics</h2><div class="slide-content"><div class="paragraph"><p>Healing the rift in the type system is great!</p></div>
<div class="paragraph"><p>But if <code>ArrayList&lt;int&gt;</code> is backed by <code>Object[]</code>,<br>
it will still be avoided in many cases.</p></div>
<div class="paragraph"><p>Specialized generics will fix that:<br>
Generics over primitives will avoid references!</p></div></div></section><section id="_project_valhalla_3"><h2>Project Valhalla</h2><div class="slide-content"><div class="paragraph"><p>Value types, implicit constructors, null-restriction<br>
plus universal and specialized generics:</p></div>
<div class="ulist"><ul><li><p>fewer trade-offs between<br>
design and performance</p></li><li><p>no more manual specializations</p></li><li><p>better performance</p></li><li><p>can express design more clearly</p></li><li><p>more robust APIs</p></li></ul></div>
<div class="paragraph"><p>Makes Java more expressive and performant.</p></div></div></section><section id="_timeline_6"><h2>Timeline</h2><div class="slide-content"><div class="paragraph"><p>🤷🏾‍♂️</p></div>
<div class="paragraph"><p>(All effort is focussed on JEP 401.)</p></div></div></section><section id="_deeper_dives_5"><h2>Deeper Dives</h2><div class="slide-content"><div class="ulist"><ul><li><p><a href="https://openjdk.org/jeps/401">JEP 401</a>: Value Classes and Objects</p></li><li><p><a href="https://openjdk.org/jeps/8316779">JEP draft</a>: Null-restricted Value Types</p></li><li><p><a href="https://openjdk.org/jeps/402">JEP 402</a>: Enhanced Primitive Boxing</p></li><li><p><a href="https://openjdk.org/jeps/8277163">JEP draft</a>: Value Objects</p></li></ul></div></div></section><section id="_deeper_dives_6"><h2>Deeper Dives</h2><div class="slide-content"><div class="ulist"><ul><li><p>📝 State of Valhalla</p><div class="ulist"><ul><li><p><a href="https://openjdk.org/projects/valhalla/design-notes/state-of-valhalla/01-background">Part 1: The Road to Valhalla</a></p></li><li><p><a href="https://openjdk.org/projects/valhalla/design-notes/state-of-valhalla/02-object-model">Part 2: The Language Model</a></p></li><li><p><a href="https://openjdk.org/projects/valhalla/design-notes/state-of-valhalla/03-vm-model">Part 3: The JVM Model</a></p></li></ul></div></li><li><p>🎥 <a href="https://www.youtube.com/watch?v=Dhn-JgZaBWo">Valhalla - Java&#8217;s Epic Refactor</a> (Aug 2021)</p></li></ul></div></div></section></section>
<section><section id="_project_babylon" data-background-image="../_images/babylon-8088924d.jpg" data-background-size="cover"><h2>Project Babylon</h2><div class="slide-content"><div class="quoteblock"><blockquote><div class="paragraph"><p>Extend the reach of Java to foreign programming models such as SQL, differentiable programming, machine learning models, and GPUs</p></div></blockquote></div><div class="paragraph"><p>Profile:</p></div><div class="ulist"><ul><li><p><a href="https://openjdk.org/projects/babylon/">project</a> /
<a href="https://mail.openjdk.org/mailman/listinfo/babylon-dev">mailing list</a> /
<a href="https://github.com/openjdk/babylon">code base</a></p></li><li><p>launched January 2024</p></li><li><p>led by Paul Sandoz</p></li></ul></div></div></section><section id="_motivation_5"><h2>Motivation</h2><div class="slide-content"><div class="paragraph"><p>Java is adjacent to other programmable systems:</p></div>
<div class="ulist"><ul><li><p>GPUs and FPGAs</p></li><li><p>SQL databases</p></li><li><p>differentiable functions</p></li></ul></div>
<div class="paragraph"><p>Allow programming them with Java code.</p></div></div></section><section id="_approach"><h2>Approach</h2><div class="slide-content"><div class="paragraph"><p>Don&#8217;t adapt to each realm in a separate project.</p></div>
<div class="paragraph"><p>Instead:</p></div>
<div class="ulist"><ul><li><p>make Java code accessible</p></li><li><p>provide API to read and transform it</p></li><li><p>let ecosystem provide adaptions</p></li></ul></div></div></section><section id="_code_reflection"><h2>Code Reflection</h2><div class="slide-content"><div class="paragraph"><p>Babylons&#8217;s central mechanism is <em>code reflection</em>:</p></div>
<div class="ulist"><ul><li><p>enhancement of "regular" reflection</p></li><li><p>reaches down <em>into</em> methods/lambdas</p></li><li><p>symbolic representation of (Java) code</p></li></ul></div>
<div class="paragraph"><p>These are called <em>code models</em>.</p></div></div></section><section id="_nih"><h2>NIH?</h2><div class="slide-content"><div class="paragraph"><p>Abstract syntax tree:</p></div>
<div class="ulist"><ul><li><p>constructed during compilation</p></li><li><p>closely aligned with Java grammar</p></li><li><p>too much syntactic info</p></li></ul></div>
<div class="paragraph"><p>Bytecode:</p></div>
<div class="ulist"><ul><li><p>created by compiler</p></li><li><p>specified by JVM Specification</p></li><li><p>too little important info</p></li></ul></div></div></section><section id="_code_models"><h2>Code Models</h2><div class="slide-content"><div class="quoteblock"><blockquote><div class="paragraph"><p>The code model design is heavily influenced by the design of data structures used by many modern compilers to represent code.
These data structures are commonly referred to as Intermediate Representations (IRs).
The design is further influenced by Multi-Level Intermediate Representation (MLIR), a sub-project of the LLVM Compiler Infrastructure project.</p></div></blockquote></div></div></section><section id="_code_models_2"><h2>Code Models</h2><div class="slide-content"><div class="paragraph"><p>Identify code (e.g. with annotation):</p></div>
<div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">@CodeReflection
static double sub(double a, double b) {
   return a - b;
}</code></pre></div></div>
<div class="paragraph"><p>Then:</p></div>
<div class="ulist"><ul><li><p>compiler creates code model</p></li><li><p>stored in class files</p></li><li><p>accessible via reflection API</p></li><li><p>can be transformed by Java code</p></li></ul></div></div></section><section id="_transforming_code_models"><h2>Transforming Code Models</h2><div class="slide-content"><div class="paragraph"><p>"Direct" GPU programming:</p></div>
<div class="ulist"><ul><li><p>transform to GPU kernels (OpenCL C or CUDA C)</p></li><li><p>compile with GPU-specific toolchain</p></li></ul></div>
<div class="paragraph"><p>Triton-style:</p></div>
<div class="ulist"><ul><li><p>offer class <code>Triton</code> with static methods</p></li><li><p>transform to Triton code model</p></li><li><p>compile with Triton toolchain</p></li></ul></div></div></section><section id="_triton"><h2>Triton</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlight"><code class="language-java" data-lang="java">@CodeReflection
static void add_kernel2(
		Ptr x, Ptr y, Ptr result, int n, int size) {
    var pid = Triton.programId(0);
    var block_start = pid * size;
    var range = Triton.arange(0, size);
    var offsets = Triton.add(block_start, range);
    var mask = Triton.compare(
		offsets, n, Triton.CompareKind.LessThan);
    var x = Triton.load(Triton.add(x, offsets), mask);
    var y = Triton.load(Triton.add(y, offsets), mask);
    var output = Triton.add(x, y);
    Triton.store(
		Triton.add(result, offsets), output, mask);
}</code></pre></div></div></div></section><section id="_project_babylon_2"><h2>Project Babylon</h2><div class="slide-content"><div class="ulist"><ul><li><p>introduces code reflection &amp; code models</p></li><li><p>allows their transformation</p></li><li><p>expands Java to foreign programming models</p></li><li><p>spearheads Java-on-GPU efforts (HAT)</p></li></ul></div></div></section><section id="_timeline_7"><h2>Timeline</h2><div class="slide-content"><div class="paragraph"><p>🤷🏾‍♂️</p></div></div></section><section id="_deeper_dives_7"><h2>Deeper Dives</h2><div class="slide-content"><div class="ulist"><ul><li><p>📝 <a href="https://openjdk.org/projects/babylon/articles/code-models">Code Models</a></p></li><li><p>📝 <a href="https://openjdk.org/projects/babylon/articles/triton">Exploring Triton GPU programming for neural networks in Java</a></p></li><li><p>🎥 <a href="https://www.youtube.com/watch?v=6c0DB2kwF_Q">Code Reflection</a> (Aug 2024)</p></li><li><p>🎥 <a href="https://www.youtube.com/watch?v=szGiOvfTPfI">Heterogeneous Accelerator Toolkit</a> (Sep 2024)</p></li><li><p>🎥 <a href="https://www.youtube.com/watch?v=GQLBzrbkiKA">Translating Java to SPIR-V</a> (Aug 2024)</p></li></ul></div></div></section></section>
<section><section id="_project_amber" data-background-image="../_images/amber-a965e7c1.jpg" data-background-size="cover"><h2>Project Amber</h2><div class="slide-content"><div class="quoteblock"><blockquote><div class="paragraph"><p>Smaller, productivity-oriented Java language features</p></div></blockquote></div><div class="paragraph"><p>Profile:</p></div><div class="ulist"><ul><li><p><a href="https://openjdk.org/projects/amber/">project</a> /
<a href="https://wiki.openjdk.org/display/amber/Main">wiki</a> /
<a href="https://mail.openjdk.org/mailman/listinfo/amber-dev">mailing list</a></p></li><li><p>launched March 2017</p></li><li><p>led by Brian Goetz</p></li></ul></div></div></section><section id="_motivation_6"><h2>Motivation</h2><div class="slide-content"><div class="paragraph"><p>Some downsides of Java:</p></div>
<div class="ulist"><ul><li><p>can be cumbersome</p></li><li><p>tends to require boilerplate</p></li><li><p>situational lack of expressiveness</p></li></ul></div>
<div class="paragraph"><p>Amber continuously improves that situation.</p></div></div></section><section id="_delivered"><h2>Delivered</h2><div class="slide-content"><div class="ulist"><ul><li><p>multi-file source launcher ㉒ (<a href="https://openjdk.org/jeps/458">JEP 458</a>)</p></li><li><p>unnamed variables and patterns ㉒ (<a href="https://openjdk.org/jeps/456">JEP 456</a>)</p></li><li><p>patterns in switch ㉑ (<a href="https://openjdk.org/jeps/441">JEP 441</a>)</p></li><li><p>record patterns ㉑ (<a href="https://openjdk.org/jeps/440">JEP 440</a>)</p></li><li><p>sealed types ⑰ (<a href="https://openjdk.org/jeps/409">JEP 409</a>)</p></li><li><p>records ⑯ (<a href="https://openjdk.org/jeps/395">JEP 395</a>)</p></li><li><p>type pattern matching ⑯ (<a href="https://openjdk.org/jeps/394">JEP 394</a>)</p></li><li><p>text blocks ⑮ (<a href="https://openjdk.org/jeps/378">JEP 378</a>)</p></li><li><p>switch expressions ⑭ (<a href="https://openjdk.org/jeps/361">JEP 361</a>)</p></li><li><p>local-variable type inference with <code>var</code> ⑩ (<a href="https://openjdk.org/jeps/286">JEP 286</a>)</p></li></ul></div></div></section><section id="_pattern_matching"><h2>Pattern Matching</h2><div class="slide-content"><div class="paragraph"><p>Amber&#8217;s main thrust is pattern matching:</p></div>
<div class="ulist"><ul><li><p>records</p></li><li><p>sealed types</p></li><li><p>improved switch</p></li><li><p>patterns</p></li></ul></div></div></section><section id="_sum_parts"><h2>Sum &gt; Parts</h2><div class="slide-content"><div class="imageblock"><a class="image" href="https://www.youtube.com/watch?v=5qYJYGvVLg8"><img src="../_images/inside-java-newscast-29-57de241b.png" alt="inside java newscast 29" width="80%"></a></div>
<div class="paragraph"><p>Inside Java Newscast #29</p></div></div></section><section id="_amber_endeavors"><h2>Amber endeavors</h2><div class="slide-content"><div class="paragraph"><p>Other endeavors and conversations:</p></div>
<div class="ulist"><ul><li><p>primitive types in patterns (<a href="https://openjdk.org/jeps/488">JEP 488</a>)</p></li><li><p>simplified main (<a href="https://openjdk.org/jeps/495">JEP 495</a>)</p></li><li><p>flexible constructor bodies (<a href="https://openjdk.org/jeps/492">JEP 492</a>)</p></li><li><p>deconstruction of classes</p></li><li><p>derived record creation ("withers") (<a href="https://openjdk.org/jeps/468">JEP 468</a>)</p></li><li><p>deconstruction assignment (<a href="https://twitter.com/BrianGoetz/status/1599000138793771010">announcement</a>)</p></li><li><p>serialization 2.0 (<a href="https://www.youtube.com/watch?v=fbqAyRJoQO0">talk at Devoxx BE</a>)</p></li><li><p>concise method bodies (<a href="https://openjdk.org/jeps/8209434">JEP draft</a>)</p></li></ul></div></div></section><section id="_string_templates"><h2>String Templates?</h2><div class="slide-content"><div class="imageblock"><a class="image" href="https://www.youtube.com/watch?v=c6L4Ef9owuQ"><img src="../_images/inside-java-newscast-71-96fd302f.jpg" alt="inside java newscast 71" width="80%"></a></div>
<div class="paragraph"><p>Inside Java Newscast #71</p></div></div></section><section id="_project_amber_2"><h2>Project Amber</h2><div class="slide-content"><div class="ulist"><ul><li><p>makes Java more expressive</p></li><li><p>reduces amount of code</p></li><li><p>makes us more productive</p></li></ul></div></div></section><section id="_timeline_8"><h2>Timeline</h2><div class="slide-content"><div class="paragraph"><p>JDK 21:</p></div>
<div class="ulist"><ul><li><p>records &amp; sealed types</p></li><li><p>pattern matching basics</p></li><li><p>text blocks</p></li><li><p>single-file source launcher</p></li></ul></div>
<div class="paragraph"><p>JDK 22:</p></div>
<div class="ulist"><ul><li><p>unnamed patterns</p></li><li><p>multi-file source launcher</p></li></ul></div></div></section><section id="_timeline_9"><h2>Timeline</h2><div class="slide-content"><div class="paragraph"><p>Current work:</p></div>
<div class="ulist"><ul><li><p>simplified main (<a href="https://openjdk.org/jeps/495">JEP 495</a>)</p></li><li><p>flexible constructor bodies (<a href="https://openjdk.org/jeps/492">JEP 492</a>)</p></li><li><p>primitive types in patterns (<a href="https://openjdk.org/jeps/488">JEP 488</a>)</p></li><li><p>deconstruction</p></li></ul></div></div></section><section id="_deeper_dives_8"><h2>Deeper Dives</h2><div class="slide-content"><div class="ulist"><ul><li><p>📝 <a href="https://openjdk.org/projects/amber/design-notes/patterns/pattern-match-object-model">Pattern Matching in the Java Object Model</a></p></li><li><p>🎥 <a href="https://www.youtube.com/watch?v=QrwFrm1R8OY">Java 21 Pattern Matching Tutorial</a> (Sep 2023)</p></li><li><p>🎥 <a href="https://www.youtube.com/watch?v=NNPN5tvjzqA">Java Language Futures: Fall 2024 Edition</a> (Oct 2024)</p></li></ul></div></div></section></section>
<section id="_so_long" data-background-image="../_images/question-mark-9644fc1f.jpg" data-background-size="cover"><h2>So long&#8230;&#8203;</h2><div class="slide-content">
<div style="float: left; width: 45%; margin: 0;">
	<a href="https://www.manning.com/books/the-java-module-system?a_aid=nipa&a_bid=869915cb"><img src="../_images/cover-jms-4e5e400d.png" style="margin: 0;"></a>
	<p style="
		position: fixed;
		margin: -160px 0 0 60px;
		transform: rotate(-8deg);
		font-size: 28pt;
		color: #cc0000;
		text-shadow: 2px 2px 3px #660000;
		font-weight: bold;
		border: 5px solid #cc0000;
		border-radius: 12px;
		background-color: rgba(255,255,255,0.5);
		padding: 2px 8px 7px 4px;
">37% off with<br>code <em>fccparlog</em></p>
	<p><a href="https://www.manning.com/books/the-java-module-system?a_aid=nipa&a_bid=869915cb">bit.ly/the-jms</a></p>
</div>

<h3 style="margin: 0">More</h3>

Slides at <a href="https://slides.nipafx.dev">slides.nipafx.dev</a>
<br>
⇜ Get <a href="https://www.manning.com/books/the-java-module-system?a_aid=nipa&a_bid=869915cb">my book</a>!

<h3 style="margin: 0.5em 0 0">Follow Nicolai</h3>

<a href="https://nipafx.dev">nipafx.dev</a>
<br/>
<a href="https://twitter.com/nipafx"><i class="fab fa-twitter-square"></i></a>
<a href="https://youtube.com/nipafx"><i class="fab fa-youtube-square"></i></a>
<a href="https://twitch.tv/nipafx"><i class="fab fa-twitch"></i></a>
<a href="https://github.com/nipafx"><i class="fab fa-github-square"></i></a>
/nipafx

<h3 style="margin: 0.5em 0 0">Follow Java</h3>

<a href="https://inside.java/">inside.java</a> //
<a href="https://dev.java/">dev.java</a>
<br/>
<a href="https://twitter.com/java"><i class="fab fa-twitter-square"></i></a>
<a href="https://www.youtube.com/java"><i class="fab fa-youtube-square"></i></a>
/java
&nbsp;&nbsp;&nbsp;//&nbsp;&nbsp;&nbsp;
<a href="https://github.com/openjdk"><i class="fab fa-github-square"></i></a>
/openjdk</div></section>
<section id="_image_credits"><h2>Image Credits</h2><div class="slide-content"><div class="ulist"><ul><li><p><a href="https://pxhere.com/en/photo/1247296">amber</a>:
<a href="https://creativecommons.org/publicdomain/zero/1.0/">CC0</a></p></li><li><p><a href="https://commons.wikimedia.org/wiki/File:Pieter_Bruegel_the_Elder_-" class="bare">https://commons.wikimedia.org/wiki/File:Pieter_Bruegel_the_Elder_-</a><em>The_Tower_of_Babel</em>(Vienna)_-_Google_Art_Project.jpg[babylon]:
<a href="https://en.wikipedia.org/wiki/en:Pieter_Bruegel_the_Elder">Pieter Brueghel the Elder</a>,
<a href="https://en.wikipedia.org/wiki/public_domain">public domain</a></p></li><li><p><a href="https://unsplash.com/photos/a-glass-ball-sitting-on-top-of-a-sandy-beach-DV7FtN-yyRM">crystal ball</a>:
<a href="https://unsplash.com/@joshuaworoniecki">Joshua Woroniecki</a>,
<a href="https://unsplash.com/license">Unsplash license</a></p></li><li><p><a href="https://www.flickr.com/photos/bowwowbeach/8638625284">leyden</a>:
<a href="https://www.flickr.com/photos/bowwowbeach/">Steve @ the alligator farm</a>,
<a href="https://creativecommons.org/licenses/by-sa/2.0/">CC BY-SA 2.0</a></p></li><li><p><a href="https://unsplash.com/photos/pgF1IXhdBJM">loom</a>:
<a href="https://unsplash.com/@fancycrave">Fancycrave</a>,
<a href="https://unsplash.com/license">Unsplash license</a></p></li><li><p><a href="https://pixabay.com/photos/panama-panamericana-bridge-4953251/">panama-canal</a>:
<a href="https://pixabay.com/users/ron-01-4710001/">Ron-01</a>,
<a href="https://pixabay.com/service/license/">Pixabay License</a></p></li><li><p><a href="https://unsplash.com/photos/5O6c_pLziXs">super-tree</a>:
<a href="https://unsplash.com/@huchenme">Hu Chen</a>,
<a href="https://unsplash.com/license">Unsplash license</a></p></li><li><p><a href="https://unsplash.com/photos/a-young-girl-running-on-a-track-in-a-park-KH26LC5q9fs">training run</a>:
<a href="https://unsplash.com/@sobe93">Anthony Soberal</a>,
<a href="https://unsplash.com/license">Unsplash license</a></p></li><li><p><a href="https://en.wikipedia.org/wiki/Valhalla#/media/File:Walhall_by_Emil_Doepler.jpg">valhalla</a>:
<a href="https://en.wikipedia.org/wiki/Emil_Doepler">Emil Doepler</a>,
public domain</p></li><li><p><a href="https://www.flickr.com/photos/21496790@N06/5065834411">question-mark</a>:
<a href="http://milosevicmilos.com/">Milos Milosevic</a>,
<a href="https://creativecommons.org/licenses/by/2.0/">CC-BY 2.0</a></p></li></ul></div></div></section></div></div><script src="../_reveal.js/head/js/reveal.js"></script><script>Array.prototype.slice.call(document.querySelectorAll('.slides section')).forEach(function(slide) {
  if (slide.getAttribute('data-background-color')) return;
  // user needs to explicitly say he wants CSS color to override otherwise we might break custom css or theme (#226)
  if (!(slide.classList.contains('canvas') || slide.classList.contains('background'))) return;
  var bgColor = getComputedStyle(slide).backgroundColor;
  if (bgColor !== 'rgba(0, 0, 0, 0)' && bgColor !== 'transparent') {
    slide.setAttribute('data-background-color', bgColor);
    slide.style.backgroundColor = 'transparent';
  }
});

// More info about config & dependencies:
// - https://github.com/hakimel/reveal.js#configuration
// - https://github.com/hakimel/reveal.js#dependencies
Reveal.initialize({
  // Display presentation control arrows
  controls: false,
  // Help the user learn the controls by providing hints, for example by
  // bouncing the down arrow when they first encounter a vertical slide
  controlsTutorial: true,
  // Determines where controls appear, "edges" or "bottom-right"
  controlsLayout: 'bottom-right',
  // Visibility rule for backwards navigation arrows; "faded", "hidden"
  // or "visible"
  controlsBackArrows: 'faded',
  // Display a presentation progress bar
  progress: false,
  // Display the page number of the current slide
  slideNumber: false,
  // Control which views the slide number displays on
  showSlideNumber: 'all',
  // Add the current slide number to the URL hash so that reloading the
  // page/copying the URL will return you to the same slide
  hash: false,
  // Push each slide change to the browser history. Implies `hash: true`
  history: true,
  // Enable keyboard shortcuts for navigation
  keyboard: true,
  // Enable the slide overview mode
  overview: true,
  // Disables the default reveal.js slide layout so that you can use custom CSS layout
  disableLayout: false,
  // Vertical centering of slides
  center: true,
  // Enables touch navigation on devices with touch input
  touch: true,
  // Loop the presentation
  loop: false,
  // Change the presentation direction to be RTL
  rtl: false,
  // See https://github.com/hakimel/reveal.js/#navigation-mode
  navigationMode: 'default',
  // Randomizes the order of slides each time the presentation loads
  shuffle: false,
  // Turns fragments on and off globally
  fragments: true,
  // Flags whether to include the current fragment in the URL,
  // so that reloading brings you to the same fragment position
  fragmentInURL: false,
  // Flags if the presentation is running in an embedded mode,
  // i.e. contained within a limited portion of the screen
  embedded: false,
  // Flags if we should show a help overlay when the questionmark
  // key is pressed
  help: true,
  // Flags if speaker notes should be visible to all viewers
  showNotes: false,
  // Global override for autolaying embedded media (video/audio/iframe)
  // - null: Media will only autoplay if data-autoplay is present
  // - true: All media will autoplay, regardless of individual setting
  // - false: No media will autoplay, regardless of individual setting
  autoPlayMedia: null,
  // Global override for preloading lazy-loaded iframes
  // - null: Iframes with data-src AND data-preload will be loaded when within
  //   the viewDistance, iframes with only data-src will be loaded when visible
  // - true: All iframes with data-src will be loaded when within the viewDistance
  // - false: All iframes with data-src will be loaded only when visible
  preloadIframes: null,
  // Number of milliseconds between automatically proceeding to the
  // next slide, disabled when set to 0, this value can be overwritten
  // by using a data-autoslide attribute on your slides
  autoSlide: 0,
  // Stop auto-sliding after user input
  autoSlideStoppable: true,
  // Use this method for navigation when auto-sliding
  autoSlideMethod: Reveal.navigateNext,
  // Specify the average time in seconds that you think you will spend
  // presenting each slide. This is used to show a pacing timer in the
  // speaker view
  defaultTiming: 120,
  // Specify the total time in seconds that is available to
  // present.  If this is set to a nonzero value, the pacing
  // timer will work out the time available for each slide,
  // instead of using the defaultTiming value
  totalTime: 2700,
  // Specify the minimum amount of time you want to allot to
  // each slide, if using the totalTime calculation method.  If
  // the automated time allocation causes slide pacing to fall
  // below this threshold, then you will see an alert in the
  // speaker notes window
  minimumTimePerSlide: 0,
  // Enable slide navigation via mouse wheel
  mouseWheel: false,
  // Hide cursor if inactive
  hideInactiveCursor: true,
  // Time before the cursor is hidden (in ms)
  hideCursorTime: 5000,
  // Hides the address bar on mobile devices
  hideAddressBar: true,
  // Opens links in an iframe preview overlay
  // Add `data-preview-link` and `data-preview-link="false"` to customise each link
  // individually
  previewLinks: false,
  // Transition style (e.g., none, fade, slide, convex, concave, zoom)
  transition: 'fade',
  // Transition speed (e.g., default, fast, slow)
  transitionSpeed: 'default',
  // Transition style for full page slide backgrounds (e.g., none, fade, slide, convex, concave, zoom)
  backgroundTransition: 'fade',
  // Number of slides away from the current that are visible
  viewDistance: 3,
  // Number of slides away from the current that are visible on mobile
  // devices. It is advisable to set this to a lower number than
  // viewDistance in order to save resources.
  mobileViewDistance: 3,
  // Parallax background image (e.g., "'https://s3.amazonaws.com/hakim-static/reveal-js/reveal-parallax-1.jpg'")
  parallaxBackgroundImage: '../_images/super-tree-55ffde7f.jpg',
  // Parallax background size in CSS syntax (e.g., "2100px 900px")
  parallaxBackgroundSize: '2677px 4011px',
  // Number of pixels to move the parallax background per slide
  // - Calculated automatically unless specified
  // - Set to 0 to disable movement along an axis
  parallaxBackgroundHorizontal: null,
  parallaxBackgroundVertical: null,
  // The display mode that will be used to show slides
  display: 'block',

  // The "normal" size of the presentation, aspect ratio will be preserved
  // when the presentation is scaled to fit different resolutions. Can be
  // specified using percentage units.
  width: 960,
  height: 700,

  // Factor of the display size that should remain empty around the content
  margin: 0.1,

  // Bounds for smallest/largest possible scale to apply to content
  minScale: 0.2,
  maxScale: 1.5,

  // PDF Export Options
  // Put each fragment on a separate page
  pdfSeparateFragments: true,
  // For slides that do not fit on a page, max number of pages
  pdfMaxPagesPerSlide: 1,

  // Optional libraries used to extend on reveal.js
  dependencies: [
      { src: '../_reveal.js/head/plugin/zoom-js/zoom.js', async: true },
      { src: '../_reveal.js/head/plugin/notes/notes.js', async: true }
  ],

  

});</script><script>var dom = {};
dom.slides = document.querySelector('.reveal .slides');

function getRemainingHeight(element, slideElement, height) {
  height = height || 0;
  if (element) {
    var newHeight, oldHeight = element.style.height;
    // Change the .stretch element height to 0 in order find the height of all
    // the other elements
    element.style.height = '0px';
    // In Overview mode, the parent (.slide) height is set of 700px.
    // Restore it temporarily to its natural height.
    slideElement.style.height = 'auto';
    newHeight = height - slideElement.offsetHeight;
    // Restore the old height, just in case
    element.style.height = oldHeight + 'px';
    // Clear the parent (.slide) height. .removeProperty works in IE9+
    slideElement.style.removeProperty('height');
    return newHeight;
  }
  return height;
}

function layoutSlideContents(width, height) {
  // Handle sizing of elements with the 'stretch' class
  toArray(dom.slides.querySelectorAll('section .stretch')).forEach(function (element) {
    // Determine how much vertical space we can use
    var limit = 5; // hard limit
    var parent = element.parentNode;
    while (parent.nodeName !== 'SECTION' && limit > 0) {
      parent = parent.parentNode;
      limit--;
    }
    if (limit === 0) {
      // unable to find parent, aborting!
      return;
    }
    var remainingHeight = getRemainingHeight(element, parent, height);
    // Consider the aspect ratio of media elements
    if (/(img|video)/gi.test(element.nodeName)) {
      var nw = element.naturalWidth || element.videoWidth, nh = element.naturalHeight || element.videoHeight;
      var es = Math.min(width / nw, remainingHeight / nh);
      element.style.width = (nw * es) + 'px';
      element.style.height = (nh * es) + 'px';
    } else {
      element.style.width = width + 'px';
      element.style.height = remainingHeight + 'px';
    }
  });
}

function toArray(o) {
  return Array.prototype.slice.call(o);
}

Reveal.addEventListener('slidechanged', function () {
  layoutSlideContents(960, 700)
});
Reveal.addEventListener('ready', function () {
  layoutSlideContents(960, 700)
});
Reveal.addEventListener('resize', function () {
  layoutSlideContents(960, 700)
});</script></body></html>